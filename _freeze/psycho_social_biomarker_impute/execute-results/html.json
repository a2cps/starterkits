{
  "hash": "27c76c5e3cbd860ee3b7d91327a6dfbe",
  "result": {
    "engine": "knitr",
    "markdown": "---\nauthors:\n  - name: Martin A. Lindquist\n  - name: Briha Ansari\n---\n\n\n\n\n\n# Psychosocial Data Imputation and Biomarker calculations {#sec-psychosocial}\n\nThis document goes over score calculation and missing data imputation for each psychosocial form. The headings in the sidebar help the user navigate to their desired content. The code chunks for each form can be run independently after running @sec-psychosocial-reading in its entirety.\n\n## Read in Data and write functions {#sec-psychosocial-reading}\n\n### Load Libraries\n\n\n\n\n\n\n\n\n\n\n\n### Read in Psycho-social Data\n\nWe will call this psy_soc\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npsy_soc <- read.csv(here(\"data\",\"psychosocial\", \"psychosocial-2024-11-06.csv\")) %>% \n  filter(redcap_event_name == \"baseline_visit_arm_1\")\n```\n:::\n\n\n\n\n\nRemove test records\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntest_records <- c('10000','15000','20000','25000','40000','50000','60000','70000','80000','90000','100000','110000','120000')\n\npsy_soc <- psy_soc%>% \n  filter(!record_id %in% test_records)\n```\n:::\n\n\n\n\n\nCreate a column for cohort type called \"cohort\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npsy_soc <- psy_soc %>% \n  mutate(cohort = case_when(record_id >= 10000 & record_id < 15000 |record_id >= 25000 ~ \"TKA\", TRUE ~ \"Thoracic\" )) \n```\n:::\n\n\n\n\n\n### Read in Data Dictionary\n\nRead in Data dictionary and remove duplicate field name\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npsy_soc_dict <- read_csv(here(\"data\",\"psychosocial\", \"psychosocial-Data-Dictionary-2024-11-06.csv\")) %>% \n  distinct(field_name, .keep_all = TRUE)\n```\n:::\n\n\n\n\n\n### New field name(s):\n\nAdd the field name \"cohort\" to the data dictionary\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create field names\ncohort_new_row <- data.frame(\n  field_name = \"cohort\",\n  field_type = \"Character\",\n  field_note = \"Type of surgical cohort\",\n  select_choices_or_calculations = \"TKA,Thoracic\")\n\n# Add the new row after the last row\n\n\n# TKA\npsy_soc_dict <- psy_soc_dict %>%\n  slice(1:nrow(.)) %>%\n  add_row(.after = nrow(.), !!!cohort_new_row) \n```\n:::\n\n\n\n\n\n### Rules for handling missing data:\n\nIn case of missing data, each form will be handled on a case by case basis using available literature or user guides. For forms with no available user guides:\n\n-   We will impute missing values by replacing missing values with the average score of the completed items for a given subject if less than or equal to 29% of the survey items are missing [@Arrieta2017]\n\n-   For non integer values, we will use the floor value. In other words for a 12 item questionnaire, where 29% = 3.48, we will impute missing values if less than or equal to 3 of 12 items are missing.\n\n-   We will not impute missing items with a yes/no response\n\n-   We will not impute missing values where questions do not assess an underlying latent trait i.e not correlated with other items on a multi-item questionnaire\n\n-   Forms with subject level characteristics will not be imputed\n\n### Drop field names\n\nThere are some forms (opioid_side_effects_and_likeability_v03_side_effec, opioid_and_pain_control_satisfaction_v02_satisfact and patient_global_impression_of_change_pgic) and field names for follow up questions not asked during the baseline visit. We will create a vector of these field names and drop them from the psycho-social data as well as the data dictionary. We will call this subset of the data \"psy_soc1.\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndrop_vars <- c(\"pgicsymptomchangestatval\",\"patient_global_impression_of_change_pgic_complete\",\"gad7_tot_not_sure\",\"gad7_tot_several\",\"gad7_tot_over_half\",\"gad7_tot_every_day\", \"pdqassessdate_dss\" ,\"oms1surgyn\",\"oms1surgrel\",\"oms1relmanipultn___1\",\"oms1relinfection___1\" ,\"oms1relrevision___1\" ,\"oms1relother___1\",\"oms1relothertxt\",\"oms1surgunr\",\"oms1unrotherknee___1\",\"oms1unrsurgother___1\",\"oms1unrother___1\",\"oms1unrothertxt\",\"oms1visityn\",\"oms1relvisit\",\"oms1relvisited___1\",\"oms1relvisitoffice___1\",\"oms1relvisitother___1\",\"oms1relvisitothertxt\",\"oms1unrvisit\",\"oms1unrvisited___1\",\"oms1unrvisitoffice___1\",\"oms1unrvisitother___1\",\"oms1unrvisitothertxt\",\"oms2surgyn\",\"oms2surgrel\" ,\"oms2surgunr\",\"oms2relvisitoffice___1\" ,\"oms2relvisitother___1\",\"oms2relvisitothertxt\",\"oms2unrvisit\",\"oms2unrvisited___1\", \"oms2unrvisitoffice___1\",\"oms2unrvisitother___1\",\"oms2unrvisitothertxt\")   \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npsy_soc1 <- psy_soc %>% \n  select(-all_of(drop_vars))\n```\n:::\n\n\n\n\n\nThe initial data had 521 field names, we now have 456 fields names after removing 65 field names not needed\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndim(psy_soc)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1401  495\n```\n\n\n:::\n\n```{.r .cell-code}\ndim(psy_soc1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1401  454\n```\n\n\n:::\n:::\n\n\n\n\n\n### Forms:\n\nFollowing are the available psycho-social forms and imputation methods used in this workflow:\n\n+-------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+\n| Form Name                                                                                 | How was missing data handled                                                             |\n+===========================================================================================+==========================================================================================+\n| The Brief Pain Inventory v2.3 - Short Form (BPI): General Pain Intensity                  | Indicator for missingness                                                                |\n+-------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+\n| The Brief Pain Inventory v2.3 - Short Form (BPI):Local Pain Intensity                     | BPI user guide                                                                           |\n+-------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+\n| The Brief Pain Inventory v2.3 - Short Form (BPI):pain interference subscore               | BPI user guide                                                                           |\n+-------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+\n| The Brief Pain Inventory v2.3 - Short Form (BPI):Widespread Body Pain (Michigan body map) | Indicator for missingness                                                                |\n+-------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+\n| Knee Injury Osteoarthritis Outcome Score (KOOS-12)                                        | KOOS-12 user guide                                                                       |\n+-------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+\n| Generalized Anxiety Disorder 7 Item (GAD7) Scale Score                                    | Row-wise mean                                                                            |\n+-------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+\n| Patient Health Questionnaire Depression Scale (PHQ) Scored                                | Row-wise mean                                                                            |\n+-------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+\n| Fear avoidance: FABQ                                                                      | Row-wise mean                                                                            |\n+-------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+\n| Pain Catastrophizing Questionnaire (PCS6)                                                 | Row-wise mean                                                                            |\n+-------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+\n| Other Pain Treatments v3 (Other Treatments)                                               | Not imputed: Subject Level Characteristics                                               |\n+-------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+\n| Other Medical Surgical Treatments II v0.5                                                 | Not imputed: Subject Level Characteristics                                               |\n+-------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+\n| Symptom Severity Index v1.0 (SSI)                                                         | Indicator for missingness                                                                |\n+-------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+\n| painDETECT Questionnaire                                                                  | Row-wise mean                                                                            |\n+-------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+\n| PROMIS SF v1.2 - Physical Function 8b                                                     | HealthMeasures Scoring Service                                                           |\n+-------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+\n| PROMIS SF v1.0 - Sleep Disturbance 6a (Sleep I)                                           | HealthMeasures Scoring Service                                                           |\n+-------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+\n| PROMIS SF v1.0 - Fatigue 7a                                                               | HealthMeasures Scoring Service                                                           |\n+-------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+\n| PROMIS SF v2.0 - Emotional Support 6a                                                     | HealthMeasures Scoring Service                                                           |\n+-------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+\n| PROMIS SF v2.0 - Instrumental Support 6a                                                  | HealthMeasures Scoring Service                                                           |\n+-------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+\n| Pain-Sleep Duration (Sleep II)                                                            | Indicator for outliers and missingness                                                   |\n+-------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+\n| Pain Resilience Scale (PRS)                                                               | Row-wise mean                                                                            |\n+-------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+\n| Multidimensional Inventory of Subjective Cognitive Impairment v1.0 (MISCI)                | Row-wise mean                                                                            |\n+-------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+\n| Adverse Childhood Experience Questionnaire (ACE)                                          | Not imputed: Responses in yes/no format                                                  |\n+-------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+\n| TAPS-1                                                                                    | Not imputed: Smoking/substance abuse screener                                            |\n+-------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+\n| TAPS-2                                                                                    | Not imputed: Responses in yes/no format                                                  |\n+-------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+\n| Opioid Use Baseline v1.0 (Opioid Use I)                                                   | Not imputed: Subject Level Characteristics                                               |\n+-------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+\n| Expectation Items                                                                         | Not imputed                                                                              |\n+-------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+\n| Current Opioid Misuse v0.2 (COMM)                                                         | Not imputed: Subject Level Characteristics                                               |\n+-------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+\n| Rapid Assessment of Physical Activity v1.0 (RAPA)                                         | Not imputed: Responses in yes/no format                                                  |\n|                                                                                           |                                                                                          |\n|                                                                                           | Aerobic activity items: scored based on the highest activity answered in the affirmative |\n+-------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+\n| General Sensory Sensitivity v0.2 (GSS-8)                                                  | Not imputed: Responses in yes/no format                                                  |\n+-------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+\n| The Big Five Inventory (BFI-2-S)                                                          | Response to the closest matching item (similar meaning) was used                         |\n+-------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+\n| Self-Administered Comorbidity Questionnaire v4 (SCQ)                                      | Not imputed: Subject Level Characteristics                                               |\n+-------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+\n| Danish Thoracic Surgery Questionnaire v0.2                                                | Row-wise mean                                                                            |\n+-------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------+\n\n### Functions:\n\nWe will create a function called 'applyFilter' that subsets the 'psy_soc1' dataset based on field names that match a specified pattern. The function takes two parameters: 'prefix', for form specific field names and 'test_complete_column' for the form specific variable which indicates if the form was complete i.e 2 . It returns a dataset containing the 'record_id', 'redcap_event_name', 'redcap_data_access_group', and the form specific field names for completed forms.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\napplyFilter <- function(prefix, test_complete_column) {\n  filtered_data <- psy_soc1 %>%\n    select(record_id,guid, redcap_event_name, redcap_data_access_group,cohort, starts_with(prefix), {{ test_complete_column }}) %>%\n    filter({{ test_complete_column }} == 2)\n  \n  return(filtered_data)\n}\n```\n:::\n\n\n\n\n\n## Scoring and Imputation\n\n### The Brief Pain Inventory (BPI)\n\n#### Read in Data:\n\nRead in psy_soc1 dataframe and select field names from the BPI data and keep completed forms, we will call this BPI\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nBPI <- applyFilter(\"BPI\",bpisf_the_brief_pain_inventory_v23_short_form_bpi_complete)\n```\n:::\n\n\n\n\n\n#### Components:\n\nBPI assesses pain and includes information on:\n\n-   Widespread body pain measured by Michigan Body Map\n\n-   General pain intensity measured by Brief pain intensity -whole body pain\n\n-   Local pain intensity measured by Modified BPI -- surgical site pain\n\nSplit BPI: We will subset the BPI data into three datasets according to the above information.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbpi_body_map <- BPI %>% \n   select(record_id,guid,redcap_event_name,redcap_data_access_group,cohort,bpipainanatsiteareatxt,ends_with(\"rate\"),ends_with(\"dur\"),bpisf_the_brief_pain_inventory_v23_short_form_bpi_complete)\n\nbpi_body_pain <- BPI %>% \n   select(record_id,guid,redcap_event_name,redcap_data_access_group,cohort,bpiworstpainratingexclss,bpisf_the_brief_pain_inventory_v23_short_form_bpi_complete)\n\n\nbpi_pain_intrf <- BPI %>% \n   select(record_id,guid,redcap_event_name,redcap_data_access_group,cohort,bpiworstpainratingss,bpipainintfrgnrlactvtyscl,contains(\"intfr\"), contains(\"intrfr\"),bpisf_the_brief_pain_inventory_v23_short_form_bpi_complete )\n```\n:::\n\n\n\n\n\nWe now have three datasets:\n\n-   bpi_body_map for widespread body pain - Michigan Body Map\n\n-   bpi_body_pain for general pain intensity measured by brief pain intensity -whole body pain\n\n-   bpi_pain_intrf for local pain intensity measured by modified BPI -- surgical site pain\n\nInspect Field names: Make sure that the three datasets have the field names of interest\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(bpi_body_map)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"record_id\"                                                 \n [2] \"guid\"                                                      \n [3] \"redcap_event_name\"                                         \n [4] \"redcap_data_access_group\"                                  \n [5] \"cohort\"                                                    \n [6] \"bpipainanatsiteareatxt\"                                    \n [7] \"bpi_mbm_z1_rate\"                                           \n [8] \"bpi_mbm_z2_rate\"                                           \n [9] \"bpi_mbm_z3_rate\"                                           \n[10] \"bpi_mbm_z4_rate\"                                           \n[11] \"bpi_mbm_z5_rate\"                                           \n[12] \"bpi_mbm_z6_rate\"                                           \n[13] \"bpi_mbm_z7_rate\"                                           \n[14] \"bpi_mbm_z8_rate\"                                           \n[15] \"bpi_mbm_z9_rate\"                                           \n[16] \"bpi_mbm_z1_dur\"                                            \n[17] \"bpi_mbm_z2_dur\"                                            \n[18] \"bpi_mbm_z3_dur\"                                            \n[19] \"bpi_mbm_z4_dur\"                                            \n[20] \"bpi_mbm_z5_dur\"                                            \n[21] \"bpi_mbm_z6_dur\"                                            \n[22] \"bpi_mbm_z7_dur\"                                            \n[23] \"bpi_mbm_z8_dur\"                                            \n[24] \"bpi_mbm_z9_dur\"                                            \n[25] \"bpisf_the_brief_pain_inventory_v23_short_form_bpi_complete\"\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(bpi_body_pain)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"record_id\"                                                 \n[2] \"guid\"                                                      \n[3] \"redcap_event_name\"                                         \n[4] \"redcap_data_access_group\"                                  \n[5] \"cohort\"                                                    \n[6] \"bpiworstpainratingexclss\"                                  \n[7] \"bpisf_the_brief_pain_inventory_v23_short_form_bpi_complete\"\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(bpi_pain_intrf)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"record_id\"                                                 \n [2] \"guid\"                                                      \n [3] \"redcap_event_name\"                                         \n [4] \"redcap_data_access_group\"                                  \n [5] \"cohort\"                                                    \n [6] \"bpiworstpainratingss\"                                      \n [7] \"bpipainintfrgnrlactvtyscl\"                                 \n [8] \"bpipainintfrmoodscl\"                                       \n [9] \"bpipainintfrwlkablscl\"                                     \n[10] \"bpipainnrmlwrkintrfrscl\"                                   \n[11] \"bpipainrelationsintrfrscl\"                                 \n[12] \"bpipainsleepintrfrscl\"                                     \n[13] \"bpipainenjoymntintrfrscl\"                                  \n[14] \"bpipainintrfrscore\"                                        \n[15] \"bpisf_the_brief_pain_inventory_v23_short_form_bpi_complete\"\n```\n\n\n:::\n:::\n\n\n\n\n\nAll three datasets have the desired fields names. We will now look at missing data pattern in each dataset:\n\n### Michigan Body Map:\n\nMichigan Body Map records pain intensity and duration for the body region indicated by the subject [@Berardi2022]. The painful body regions can vary from subject to subject, which can result in null values in field names for body regions not indicated by the subject, this explains the data sparsity.\n\n#### Missing Data:\n\nMissing data pattern in bpi_body_map\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngg_miss_upset(bpi_body_map, nsets = n_var_miss(bpi_body_map),order.by= \"degree\", point.size = 1, line.size = 0.25, \n    text.scale = c(0.5))\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\n\n\n\nWe will create a separate field name for each body region and assign a value of 0 if a subject has not selected a body region and has not indicated the duration and intensity of pain for the selected body region i.e. has not experienced any pain in the selected body region, assign 1 if a subject has indicated painful region(s) as well as specified the rate and duration,and 2 if either value (rate or duration) or none of the values are present for the selected body regions or if either value ( rate or duration) is available but the body region is not specified.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbpi_body_map <- bpi_body_map %>%\n  mutate(head_face_jaw =case_when((grepl(\"(a00|a01|a02|a25)\",bpipainanatsiteareatxt)) ~ 1, TRUE ~ 0)) %>% \n  mutate(neck =case_when((grepl(\"a26\",bpipainanatsiteareatxt)) ~ 1, TRUE ~ 0))  %>% \n  mutate(chest_or_breast =case_when((grepl(\"(a03|a04)\",bpipainanatsiteareatxt)) ~ 1, TRUE ~ 0)) %>%\n  mutate(abd_pelvis_groin =case_when((grepl(\"(a13|a14|a15|a16)\",bpipainanatsiteareatxt)) ~ 1, TRUE ~ 0)) %>%\n  mutate(right_shoulder_arm_wrist =case_when((grepl(\"(a28|a05|a07|a09|a11)\",bpipainanatsiteareatxt)) ~ 1, TRUE ~ 0)) %>%\n  mutate(left_shoulder_arm_wrist =case_when((grepl(\"(a27|a06|a08|a10|a12)\",bpipainanatsiteareatxt)) ~ 1, TRUE ~ 0)) %>%\n  mutate(back_buttocks =case_when((grepl(\"(a29|a30|a33|a34)\",bpipainanatsiteareatxt)) ~ 1, TRUE ~ 0)) %>%\n  mutate(right_hip_leg_foot =case_when((grepl(\"(a32|a17|a19|a21|a23)\",bpipainanatsiteareatxt)) ~ 1, TRUE ~ 0)) %>%\n  mutate(left_hip_leg_foot =case_when((grepl(\"(a31|a18|a20|a22|a24)\",bpipainanatsiteareatxt)) ~ 1, TRUE ~ 0)) %>% \n  mutate(head_face_jaw_m = case_when(head_face_jaw ==0 & is.na(bpi_mbm_z1_rate) & is.na(bpi_mbm_z1_dur) ~ 0,\n   head_face_jaw == 1 & !is.na(bpi_mbm_z1_rate) & !is.na(bpi_mbm_z1_dur) ~ 1, TRUE ~ 2)) %>%                                   mutate(neck_m = case_when(neck ==0 & is.na(bpi_mbm_z2_rate) & is.na(bpi_mbm_z2_dur) ~ 0,\n   neck == 1 & !is.na(bpi_mbm_z2_rate) & !is.na(bpi_mbm_z2_dur) ~ 1, TRUE ~ 2)) %>% \n  mutate(chest_or_breast_m = case_when(chest_or_breast ==0 & is.na(bpi_mbm_z3_rate) & is.na(bpi_mbm_z3_dur) ~ 0,\n chest_or_breast == 1 & !is.na(bpi_mbm_z3_rate) & !is.na(bpi_mbm_z3_dur) ~ 1, TRUE ~ 2))  %>% \n  mutate(abd_pelvis_groin_m = case_when(abd_pelvis_groin ==0 & is.na(bpi_mbm_z4_rate) & is.na(bpi_mbm_z4_dur) ~ 0,\n abd_pelvis_groin == 1 & !is.na(bpi_mbm_z4_rate) & !is.na(bpi_mbm_z4_dur) ~ 1, TRUE ~ 2)) %>% \n  mutate(right_shoulder_arm_wrist_m = case_when(right_shoulder_arm_wrist == 0 & is.na(bpi_mbm_z5_rate) & is.na(bpi_mbm_z5_dur) ~ 0,\n right_shoulder_arm_wrist == 1 & !is.na(bpi_mbm_z5_rate) & !is.na(bpi_mbm_z5_dur) ~ 1, TRUE ~ 2)) %>% \n  mutate(left_shoulder_arm_wrist_m = case_when(left_shoulder_arm_wrist == 0 & is.na(bpi_mbm_z6_rate) & is.na(bpi_mbm_z6_dur) ~ 0,\n left_shoulder_arm_wrist == 1 & !is.na(bpi_mbm_z6_rate) & !is.na(bpi_mbm_z6_dur) ~ 1, TRUE ~ 2))   %>% \n  mutate(back_buttocks_m = case_when(back_buttocks == 0 & is.na(bpi_mbm_z7_rate) & is.na(bpi_mbm_z7_dur) ~ 0,\n back_buttocks == 1 & !is.na(bpi_mbm_z7_rate) & !is.na(bpi_mbm_z7_dur) ~ 1, TRUE ~ 2))  %>%\n  mutate(right_hip_leg_foot_m = case_when(right_hip_leg_foot == 0 & is.na(bpi_mbm_z8_rate) & is.na(bpi_mbm_z8_dur) ~ 0,\n right_hip_leg_foot == 1 & !is.na(bpi_mbm_z8_rate) & !is.na(bpi_mbm_z8_dur) ~ 1, TRUE ~ 2)) %>%\n  mutate(left_hip_leg_foot_m = case_when(left_hip_leg_foot == 0 & is.na(bpi_mbm_z9_rate) & is.na(bpi_mbm_z9_dur) ~ 0,\n left_hip_leg_foot == 1 & !is.na(bpi_mbm_z9_rate) & !is.na(bpi_mbm_z9_dur) ~ 1, TRUE ~ 2)) %>% \n  mutate(across(ends_with(\"_m\"), as.factor))%>% \n    relocate(record_id,guid,redcap_event_name,redcap_data_access_group,bpipainanatsiteareatxt,head_face_jaw,head_face_jaw_m,bpi_mbm_z1_rate,bpi_mbm_z1_dur,neck,neck_m,bpi_mbm_z2_rate,bpi_mbm_z2_dur,chest_or_breast,chest_or_breast_m,bpi_mbm_z3_rate,bpi_mbm_z3_dur,abd_pelvis_groin,abd_pelvis_groin_m,bpi_mbm_z4_rate,bpi_mbm_z4_dur,right_shoulder_arm_wrist,right_shoulder_arm_wrist_m,bpi_mbm_z5_rate,bpi_mbm_z5_dur,left_shoulder_arm_wrist,left_shoulder_arm_wrist_m,bpi_mbm_z6_rate,bpi_mbm_z6_dur,back_buttocks,back_buttocks_m,bpi_mbm_z7_rate,bpi_mbm_z7_dur,right_hip_leg_foot,right_hip_leg_foot_m,bpi_mbm_z8_rate,bpi_mbm_z8_dur,left_hip_leg_foot,left_hip_leg_foot_m,bpi_mbm_z9_rate,bpi_mbm_z9_dur) \n```\n:::\n\n\n\n\n\nCalculate number of pain areas for each subject and name it \"number_of_pain_areas\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbody_vector <- c(\"head_face_jaw\",\"neck\",\"chest_or_breast\",\"abd_pelvis_groin\",\"right_shoulder_arm_wrist\",\"left_shoulder_arm_wrist\",\"back_buttocks\",\"right_hip_leg_foot\",\"left_hip_leg_foot\")\n\nbpi_body_map <- bpi_body_map %>% \n  rowwise() %>%\n   mutate(number_of_pain_areas = rowSums(across(all_of(body_vector)), na.rm = TRUE))\n```\n:::\n\n\n\n\n\n#### New field name(s)\n\nAdd new field names for the michigan body map to the data dictionary\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create new field names\n\n#head face Jaw\njawm_new_row <- data.frame(\n  field_name = \"head_face_jaw_m\",\n  form_name = \"bpisf_the_brief_pain_inventory_v23_short_form_bpi\",\n  field_type = \"Factor\",\n  select_choices_or_calculations = \"0, Subject has not selected the head/face/jaw and has not indicated the duration and intensity of pain for the selected body region|1,Subject has indicated painful region as well as specified the rate and duration|2, if either value ( rate and duration) or none of the values are present for the selected body region or if either value ( rate and duration) is available but the body region is not specified\")\n\njaw_new_row <- data.frame(\n  field_name = \"head_face_jaw\",\n  form_name = \"bpisf_the_brief_pain_inventory_v23_short_form_bpi\",\n  field_type = \"numeric\",\n  select_choices_or_calculations = \"0, Subject has not selected head/face/jaw |1,Subject has selected head/face/jaw\")\n\n\n\n#neck\nneckm_new_row <- data.frame(\n  field_name = \"neck_m\",\n  form_name = \"bpisf_the_brief_pain_inventory_v23_short_form_bpi\",\n  field_type = \"Factor\",\n  select_choices_or_calculations = \"0, Subject has not selected neck and has not indicated the duration and intensity of pain for the selected body region|1,Subject has indicated painful region as well as specified the rate and duration|2, if either value ( rate and duration) or none of the values are present for the selected body region or if either value ( rate and duration) is available but the body region is not specified\")\n\nneck_new_row <- data.frame(\n  field_name = \"neck\",\n  form_name = \"bpisf_the_brief_pain_inventory_v23_short_form_bpi\",\n  field_type = \"numeric\",\n  select_choices_or_calculations = \"0, Subject has not selected neck |1,Subject has selected neck\")\n\n\n\n#chest_or_breast\nchest_or_breastm_new_row <- data.frame(\n  field_name = \"chest_or_breast_m\",\n  form_name = \"bpisf_the_brief_pain_inventory_v23_short_form_bpi\",\n  field_type = \"Factor\",\n  select_choices_or_calculations = \"0, Subject has not selected chest_or_breast and has not indicated the duration and intensity of pain for the selected body region|1,Subject has indicated painful region as well as specified the rate and duration|2, if either value ( rate and duration) or none of the values are present for the selected body region or if either value ( rate and duration) is available but the body region is not specified\")\n\nchest_or_breast_new_row <- data.frame(\n  field_name = \"chest_or_breast\",\n  form_name = \"bpisf_the_brief_pain_inventory_v23_short_form_bpi\",\n  field_type = \"numeric\",\n  select_choices_or_calculations = \"0, Subject has not selected chest_or_breast |1,Subject has selected chest_or_breast\")\n\n#abd_pelvis_groin\nabd_pelvis_groinm_new_row <- data.frame(\n  field_name = \"abd_pelvis_groin_m\",\n  form_name = \"bpisf_the_brief_pain_inventory_v23_short_form_bpi\",\n  field_type = \"Factor\",\n  select_choices_or_calculations = \"0, Subject has not selected abd_pelvis_groin and has not indicated the duration and intensity of pain for the selected body region|1,Subject has indicated painful region as well as specified the rate and duration|2, if either value ( rate and duration) or none of the values are present for the selected body region or if either value ( rate and duration) is available but the body region is not specified\")\n\nabd_pelvis_groin_new_row <- data.frame(\n  field_name = \"abd_pelvis_groin\",\n  form_name = \"bpisf_the_brief_pain_inventory_v23_short_form_bpi\",\n  field_type = \"numeric\",\n  select_choices_or_calculations = \"0, Subject has not selected abd_pelvis_groin |1,Subject has selected abd_pelvis_groin\")\n\n\n#right_shoulder_arm_wrist\nright_shoulder_arm_wristm_new_row <- data.frame(\n  field_name = \"right_shoulder_arm_wrist_m\",\n  form_name = \"bpisf_the_brief_pain_inventory_v23_short_form_bpi\",\n  field_type = \"Factor\",\n  select_choices_or_calculations = \"0, Subject has not selected right_shoulder_arm_wrist and has not indicated the duration and intensity of pain for the selected body region|1,Subject has indicated painful region as well as specified the rate and duration|2, if either value ( rate and duration) or none of the values are present for the selected body region or if either value ( rate and duration) is available but the body region is not specified\")\n\nright_shoulder_arm_wrist_new_row <- data.frame(\n  field_name = \"right_shoulder_arm_wrist\",\n  form_name = \"bpisf_the_brief_pain_inventory_v23_short_form_bpi\",\n  field_type = \"numeric\",\n  select_choices_or_calculations = \"0, Subject has not selected right_shoulder_arm_wrist |1,Subject has selected right_shoulder_arm_wrist\")\n\n#left_shoulder_arm_wrist\nleft_shoulder_arm_wristm_new_row <- data.frame(\n  field_name = \"left_shoulder_arm_wrist_m\",\n  form_name = \"bpisf_the_brief_pain_inventory_v23_short_form_bpi\",\n  field_type = \"Factor\",\n  select_choices_or_calculations = \"0, Subject has not selected left_shoulder_arm_wrist and has not indicated the duration and intensity of pain for the selected body region|1,Subject has indicated painful region as well as specified the rate and duration|2, if either value ( rate and duration) or none of the values are present for the selected body region or if either value ( rate and duration) is available but the body region is not specified\")\n\nleft_shoulder_arm_wrist_new_row <- data.frame(\n  field_name = \"left_shoulder_arm_wrist\",\n  form_name = \"bpisf_the_brief_pain_inventory_v23_short_form_bpi\",\n  field_type = \"numeric\",\n  select_choices_or_calculations = \"0, Subject has not selected left_shoulder_arm_wrist |1,Subject has selected left_shoulder_arm_wrist\")\n\n#back_buttocks\nback_buttocksm_new_row <- data.frame(\n  field_name = \"back_buttocks_m\",\n  form_name = \"bpisf_the_brief_pain_inventory_v23_short_form_bpi\",\n  field_type = \"Factor\",\n  select_choices_or_calculations = \"0, Subject has not selected back_buttocks and has not indicated the duration and intensity of pain for the selected body region|1,Subject has indicated painful region as well as specified the rate and duration|2, if either value ( rate and duration) or none of the values are present for the selected body region or if either value ( rate and duration) is available but the body region is not specified\")\n\nback_buttocks_new_row <- data.frame(\n  field_name = \"back_buttocks\",\n  form_name = \"bpisf_the_brief_pain_inventory_v23_short_form_bpi\",\n  field_type = \"numeric\",\n  select_choices_or_calculations = \"0, Subject has not selected back_buttocks |1,Subject has selected back_buttocks\")\n\n#right_hip_leg_foot\nright_hip_leg_footm_new_row <- data.frame(\n  field_name = \"right_hip_leg_foot_m\",\n  form_name = \"bpisf_the_brief_pain_inventory_v23_short_form_bpi\",\n  field_type = \"Factor\",\n  select_choices_or_calculations = \"0, Subject has not selected right_hip_leg_foot and has not indicated the duration and intensity of pain for the selected body region|1,Subject has indicated painful region as well as specified the rate and duration|2, if either value ( rate and duration) or none of the values are present for the selected body region or if either value ( rate and duration) is available but the body region is not specified\")\n\nright_hip_leg_foot_new_row <- data.frame(\n  field_name = \"right_hip_leg_foot\",\n  form_name = \"bpisf_the_brief_pain_inventory_v23_short_form_bpi\",\n  field_type = \"numeric\",\n  select_choices_or_calculations = \"0, Subject has not selected right_hip_leg_foot |1,Subject has selected right_hip_leg_foot\")\n\n#left_hip_leg_foot\nleft_hip_leg_footm_new_row <- data.frame(\n  field_name = \"left_hip_leg_foot_m\",\n  form_name = \"bpisf_the_brief_pain_inventory_v23_short_form_bpi\",\n  field_type = \"Factor\",\n  select_choices_or_calculations = \"0, Subject has not selected left_hip_leg_foot and has not indicated the duration and intensity of pain for the selected body region|1,Subject has indicated painful region as well as specified the rate and duration|2, if either value ( rate and duration) or none of the values are present for the selected body region or if either value ( rate and duration) is available but the body region is not specified\")\n\nleft_hip_leg_foot_new_row <- data.frame(\n  field_name = \"left_hip_leg_foot\",\n  form_name = \"bpisf_the_brief_pain_inventory_v23_short_form_bpi\",\n  field_type = \"numeric\",\n  select_choices_or_calculations = \"0, Subject has not selected left_hip_leg_foot |1,Subject has selected left_hip_leg_foot\")\n\n# number_of_pain_areas\n\npain_areas_new_row <- data.frame(\n  field_name = \"number_of_pain_areas\",\n  form_name = \"bpisf_the_brief_pain_inventory_v23_short_form_bpi\",\n  field_type = \"numeric\",\n  select_choices_or_calculations = \"Sum of pain areas for each subject\")\n\n# Add new rows\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!jawm_new_row, .after = match(\"bpi_mbm_z9_dur\", psy_soc_dict$field_name))\n\n\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!jaw_new_row, .after = match(\"bpi_mbm_z9_dur\", psy_soc_dict$field_name))\n\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!neckm_new_row, .after = match(\"bpi_mbm_z9_dur\", psy_soc_dict$field_name))\n\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!neck_new_row, .after = match(\"bpi_mbm_z9_dur\", psy_soc_dict$field_name))\n\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!chest_or_breastm_new_row, .after = match(\"bpi_mbm_z9_dur\", psy_soc_dict$field_name))\n\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!chest_or_breast_new_row, .after = match(\"bpi_mbm_z9_dur\", psy_soc_dict$field_name))\n\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!abd_pelvis_groinm_new_row, .after = match(\"bpi_mbm_z9_dur\", psy_soc_dict$field_name))\n\n\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!abd_pelvis_groin_new_row, .after = match(\"bpi_mbm_z9_dur\", psy_soc_dict$field_name))\n\n\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!right_shoulder_arm_wristm_new_row, .after = match(\"bpi_mbm_z9_dur\", psy_soc_dict$field_name))\n\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!right_shoulder_arm_wrist_new_row, .after = match(\"bpi_mbm_z9_dur\", psy_soc_dict$field_name))\n\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!left_shoulder_arm_wristm_new_row, .after = match(\"bpi_mbm_z9_dur\", psy_soc_dict$field_name))\n\n\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!left_shoulder_arm_wrist_new_row, .after = match(\"bpi_mbm_z9_dur\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!back_buttocksm_new_row, .after = match(\"bpi_mbm_z9_dur\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!back_buttocks_new_row, .after = match(\"bpi_mbm_z9_dur\", psy_soc_dict$field_name))\n\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!right_hip_leg_footm_new_row, .after = match(\"bpi_mbm_z9_dur\", psy_soc_dict$field_name))\n\n\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!right_hip_leg_foot_new_row, .after = match(\"bpi_mbm_z9_dur\", psy_soc_dict$field_name))\n\n\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!left_hip_leg_footm_new_row, .after = match(\"bpi_mbm_z9_dur\", psy_soc_dict$field_name))\n\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!left_hip_leg_foot_new_row, .after = match(\"bpi_mbm_z9_dur\", psy_soc_dict$field_name))\n\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!pain_areas_new_row, .after = match(\"bpi_mbm_z9_dur\", psy_soc_dict$field_name))\n```\n:::\n\n\n\n\n\n#### Save:\n\nCreate a folder for recoded BPI data and save \"bpi_bpdy_map\" and updated data dictionary as .csv files\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_csv(bpi_body_map,file=here::here(\"data\",\"Psychosocial\",\"Reformatted\",\"reformatted_bpi_body_map.csv\"))\nwrite_csv(psy_soc_dict,file=here::here(\"data\",\"Psychosocial\",\"Reformatted\",\"updated_psy_soc_dictionary.csv\"))\n```\n:::\n\n\n\n\n\n### Brief pain intensity -whole body pain\n\nBrief pain intensity -whole body pain assesses other pain intensity (excluding surgical site) in the last 24 hours.\n\n#### Missing Data:\n\nMissing data pattern in bpi_body_pain\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbpi_body_pain %>% \n  miss_var_summary()\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|variable                                                   | n_miss| pct_miss|\n|:----------------------------------------------------------|------:|--------:|\n|bpiworstpainratingexclss                                   |     44|     3.29|\n|record_id                                                  |      0|        0|\n|guid                                                       |      0|        0|\n|redcap_event_name                                          |      0|        0|\n|redcap_data_access_group                                   |      0|        0|\n|cohort                                                     |      0|        0|\n|bpisf_the_brief_pain_inventory_v23_short_form_bpi_complete |      0|        0|\n\n</div>\n:::\n:::\n\n\n\n\n\nThere are 32 observations (4.12%) with no response to the question i.e null values for the field name \"bpiworstpainratingexclss\". We will create a variable \"body_pain_intensity\" and assign a value of 0 if a subject has not responded to the question, assign 1 if a subject has responded to the question\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbpi_body_pain <- bpi_body_pain %>%\n  mutate(body_pain_intensity = ifelse (is.na(bpiworstpainratingexclss),0,1))\n```\n:::\n\n\n\n\n\nWe will now pass the field name \"bpi_body_pain\" as an argument to the table function to look at the frequencies.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntable(bpi_body_pain$body_pain_intensity,exclude = FALSE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n   0    1 \n  44 1293 \n```\n\n\n:::\n:::\n\n\n\n\n\n#### New field name(s)\n\nAdd the field name \"body_pain_intensity\" to the data dictionary\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create field names\nbp_in_new_row <- data.frame(\n  field_name = \"body_pain_intensity\",\n  form_name = \"bpisf_the_brief_pain_inventory_v23_short_form_bpi\",\n  field_type = \"Factor\",\n  select_choices_or_calculations = \"0, No body pain intensity specified |1, body pain intensity specified\")\n\n# Add the new row \npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!bp_in_new_row, .after = match(\"bpipainintrfrscore\", psy_soc_dict$field_name))\n```\n:::\n\n\n\n\n\n#### Save:\n\nSave \"bpi_body_pain\" and updated data dictionary as .csv files in the folder named \"reformatted_bpi\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_csv(bpi_body_pain,file=here::here(\"data\",\"Psychosocial\",\"Reformatted\",\"reformatted_bpi_body_pain.csv\"))\nwrite_csv(psy_soc_dict,file=here::here(\"data\",\"Psychosocial\",\"Reformatted\",\"updated_psy_soc_dictionary.csv\"))\n```\n:::\n\n\n\n\n\n### Modified BPI -- surgical site pain:\n\nModified BPI -- surgical site pain records pain intensity and interference. The primary outcome is the worst pain intensity at the surgical site i.e field name \"bpiworstpainratingss\" over the past 24 hours,using a scale of 0 to 10. The form also includes the pain interference sub-scale [@cleeland1995], which assesses the level of interference in the subject's daily activities over the past 24 hours [@Berardi2022] due to surgical site pain. Pain interference is scored as the mean of seven interference items, in case of missing data, this mean can still be used if there is a response to at least 4 of 7 items ([BPI user guide](https://www.mdanderson.org/documents/Departments-and-Divisions/Symptom-Research/BPI_UserGuide.pdf)).\n\n#### Missing Data:\n\nMissing data pattern in bpi_pain_intrf if bpiworstpainratingss is not 0\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngg_miss_upset(bpi_pain_intrf %>% \n                filter(bpiworstpainratingss!=0), nsets = n_var_miss(bpi_pain_intrf),order.by= \"degree\", point.size = 1, line.size = 0.25, \n    text.scale = c(0.5))\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-26-1.png){width=672}\n:::\n:::\n\n\n\n\n\nWe will create a variable \"pain_intrf\" and assign a value of 1 if worst pain intensity at the surgical site is available and at least 4 of 7 pain interference item are available, 2 if response to worst pain intensity at the surgical site is available and less than or equal to 3 of 7 pain interference items are available, 3 if there is no response to worst pain intensity at the surgical site but at least 4 out 7 pain interference items are available, 4 if there is no response to worst pain intensity at the surgical site and less than or equal to 3 of 7 pain interference items are available.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbpi_pain_intrf <- bpi_pain_intrf %>% \n  mutate(intrf_not_na = rowSums(!is.na(select(.,\"bpipainintfrgnrlactvtyscl\":\"bpipainenjoymntintrfrscl\")))) %>% \n  mutate(pain_intrf = case_when(!is.na(bpiworstpainratingss) & intrf_not_na >= 4 ~ 1,\n                                !is.na(bpiworstpainratingss) & intrf_not_na <= 3 ~2,\n                                is.na(bpiworstpainratingss) & intrf_not_na >= 4 ~ 3,                                  is.na(bpiworstpainratingss) & intrf_not_na <= 3 ~ 4  ,TRUE~0)) %>% \n  select(-intrf_not_na) %>% \n  as_tibble() %>% \n  mutate(pain_intrf = as.factor(pain_intrf))\n```\n:::\n\n\n\n\n\nWe will create a new field \"new_bpipainintrfrscore\" with pain interference scores for observations that meet the conditions pain_intrf = 1 or pain_intrf = 3.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbpi_pain_intrf <- bpi_pain_intrf %>% \n  mutate(new_bpipainintrfrscore = case_when(pain_intrf == 1 | pain_intrf == 3 ~ bpipainintrfrscore)) \n```\n:::\n\n\n\n\n\nCompare the distributions for bpipainintrfrscore and new_bpipainintrfrscore\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(bpi_pain_intrf$new_bpipainintrfrscore)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's \n 0.0000  0.8571  3.4286  3.5069  5.5714 10.0000      40 \n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(bpi_pain_intrf$bpipainintrfrscore)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's \n 0.0000  0.8571  3.4286  3.4807  5.5714 10.0000      23 \n```\n\n\n:::\n:::\n\n\n\n\n\nWe see that there are more NA values for new_bpipainintrfrscore since this score was calculated for the observation that met the condition of more than or equal to 4 of 7 pain interference responses available.\n\n#### New field name(s)\n\nAdd the field name \"pain_intrf\" and \"new_bpipainintrfrscore\" to the data dictionary\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create field names\npain_intrf_new_row1 <- data.frame(\n  field_name = \"pain_intrf\",\n  form_name = \"bpisf_the_brief_pain_inventory_v23_short_form_bpi\",\n  field_type = \"Factor\",\n  select_choices_or_calculations = \"1,worst pain intensity at the surgical site and atleast 4 of 7 pain intereference items are available|2, worst pain intensity at the surgical site and less than or equal to 3 out 7 pain interference items are available| 3, no response to worst pain intensity at the surgical site but atleast 4 out 7 pain interference items are available |4, no response to worst pain intensity at the surgical site and less than or equal to 3 out 7 pain interference items are available\")\n\n# new row for new_bpipainintrfrscore\npain_intrf_new_row2 <- data.frame(\n  field_name = \"new_bpipainintrfrscore\",\n  form_name = \"bpisf_the_brief_pain_inventory_v23_short_form_bpi\",\n  field_type = \"numeric\",\n  select_choices_or_calculations = \"mean of interference items,if there is a response to atleast 4 of 7 items\")\n\n# Add new rows\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!pain_intrf_new_row1, .after = match(\"bpipainintrfrscore\", psy_soc_dict$field_name)) %>% \n  add_row(!!!pain_intrf_new_row2, .after = match(\"bpipainintrfrscore\", psy_soc_dict$field_name))\n```\n:::\n\n\n\n\n\n#### Save:\n\nSave \"bpi_pain_intrf\" and updated data dictionary as .csv files in the folder named \"reformatted_bpi\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_csv(bpi_pain_intrf,file=here::here(\"data\",\"Psychosocial\",\"Reformatted\",\"reformatted_bpi_pain_intrf.csv\"))\n\nwrite_csv(psy_soc_dict,file=here::here(\"data\",\"Psychosocial\",\"Reformatted\",\"updated_psy_soc_dictionary.csv\"))\n```\n:::\n\n\n\n\n\n### Knee Injury Osteoarthritis Outcome Score (KOOS-12)\n\nKOOS-12 is a 12-item scale that contains three sub scales [@Roos1998]:\n\n-   4 KOOS Pain items\n\n-   4 KOOS Function (Activities of Daily Living and Sport/Recreation) items\n\n-   4 KOOS Quality of Life (QOL) items to assesses knee pain none to extreme).\n\nThere must be a response to at least half of the items in each sub scale to calculate a sub scale score [KOOS calculator](http://www.koos.nu/). These scores are transformed to range from 0 to 100, where 0 represents extreme problems and 100 represents no problems.\n\n#### Read in Data:\n\nRead in psy_soc1 dataframe and select field names from the KOOS-12 data, keeping completed forms will subset to the TKA cohort by default, we will call this koos\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkoos <- applyFilter(\"koos\",knee_injury_osteoarthritis_outcome_score_koos12_complete)\n```\n:::\n\n\n\n\n\n#### Missing Data:\n\nMissing data pattern in koos.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngg_miss_upset(koos, nsets = n_var_miss(koos),order.by= \"degree\", point.size = 1, line.size = 0.25, \n    text.scale = c(0.5))\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-33-1.png){width=672}\n:::\n:::\n\n\n\n\n\nIf at least half of the items are answered for a given subscale, a subscale score can be calculated as follows [KOOS calculator](http://www.koos.nu):\n\n$$\n100-(mean (subscale score) \\times 100 / 4)\n$$\n\nThe mean of all three subscale scores is then used to construct an overall KOOS-12 Summary knee impact score. As with sub scale scores, KOOS-12 summary scores range from 0-100, where 0 represents extreme problems and 100 represents no problems. A Summary impact score is not calculated if any of the three scale scores are missing.\n\nUsing the above equation, we will create three subscale scores:\n\n-   pain_score for 4 KOOS Pain items\n\n-   func_score for 4 KOOS Function (Activities of Daily Living and Sport/Recreation) items\n\n-   qol_score for 4 KOOS Quality of Life (QOL) items.\n\nWe will also create a summary impact score \"pain_summary\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npain <- c(\"koospainfreqscl\",\"koospainwalkflatscl\",\"koospainstairsscl\",                    \"koospainsitlyingscl\")\n\nfunc <- c(\"koosfuncdiffrisesitscl\",\"koosfuncdiffstandscl\",\"koosfuncdiffcarscl\",\"koosfunctwistpivotscl\") \n\nqol <-  c(\"koosqolkneeawarescl\",\"koosqollifestylemodscl\",\"koosqolconfidencescl\",\"koosqolkneedifficultyscl\")\n\nall_koos <- c(\"new_pain_score\",\"new_func_score\",\"new_qol_score\")\n\n\n\nkoos <- koos %>% \n  mutate(pain_not_na = rowSums(!is.na(select(., all_of(pain)))))  %>% \n  mutate(func_not_na = rowSums(!is.na(select(., all_of(func))))) %>%\n  mutate(qol_not_na = rowSums(!is.na(select(., all_of(qol)))))  %>%\n  mutate(new_pain_score = case_when(pain_not_na >= 2 ~ 100 - ((rowMeans(select(., all_of(pain)), na.rm = TRUE)*100)/4))) %>% \n  mutate(new_func_score = case_when(func_not_na >= 2 ~ 100 - ((rowMeans(select(., all_of(func)), na.rm = TRUE)*100)/4))) %>% \n  mutate(new_qol_score = case_when(qol_not_na >= 2 ~100 - ((rowMeans(select(., all_of(qol)), na.rm = TRUE)*100)/4))) %>%\n  mutate(new_pain_summary =rowMeans(select(., all_of(all_koos))))\n```\n:::\n\n\n\n\n\nWe will now check the frequencies of all the scores (new vs. original) after accounting for missing data.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnew_koos <- koos %>% \n  select(c(\"new_qol_score\",\"new_pain_score\",\"new_func_score\",\"new_pain_summary\"))\nold_koos <- koos %>% \n  select(c(\"koospainscoret\",\"koosfunctionscoret\",\"koosqolscoret\",\"koossummaryscore\"))\n```\n:::\n\n\n\n\n\nUpset plot below shows missing scores in the original dataset\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngg_miss_upset(old_koos, nsets = n_var_miss(old_koos),order.by= \"degree\", point.size = 1, line.size = 0.25, \n    text.scale = c(0.5)) \n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-36-1.png){width=672}\n:::\n:::\n\n\n\n\n\nUpset plot below shows missing scores for observation that don't meet the criteria for calculating a scale score i.e. If at least half of the items are answered\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngg_miss_upset(new_koos, nsets = n_var_miss(new_koos),order.by= \"degree\", point.size = 1, line.size = 0.25, \n    text.scale = c(0.5))\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-37-1.png){width=672}\n:::\n:::\n\n\n\n\n\n#### New field name(s)\n\nAdd the field names \"new_qol_score\",\"new_pain_score\", \"new_func_score\" and \"new_pain_summary\" to the data dictionary\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create New field name(s)s\nqol_score_new_row <- data.frame(\n  field_name = \"new_qol_score\",\n  form_name = \"knee_injury_osteoarthritis_outcome_score_koos12\",\n  field_type = \"numeric\",\n  field_label = \"0 represents extreme problems and 100 represents no problems\",\n  field_note = \"If at least half of the items are answered for quality of life subscale, a subscale score can be calculated as follows 100-(mean (quality of life subscale) X 100 / 4\")\n  \nfunc_score_new_row <- data.frame(\n  field_name = \"new_func_score\",\n  form_name = \"knee_injury_osteoarthritis_outcome_score_koos12\",\n  field_type = \"numeric\",\n  field_label = \"0 represents extreme problems and 100 represents no problems\",\n  field_note= \"If at least half of the items are answered for function subscale, a subscale score can be calculated as follows 100-(mean (function subscale) X 100 / 4\")\n  \npain_score_new_row <- data.frame(\n  field_name = \"new_pain_score\",\n  form_name = \"knee_injury_osteoarthritis_outcome_score_koos12\",\n  field_type = \"numeric\",\n  field_label = \"0 represents extreme problems and 100 represents no problems\",\n  field_note= \"If at least half of the items are answered for pain subscale, a subscale score can be calculated as follows 100-(mean (pain subscale) X 100 / 4\")\n  \npain_summary_new_row <- data.frame(\n  field_name = \"new_pain_summary\",\n  form_name = \"knee_injury_osteoarthritis_outcome_score_koos12\",\n  field_type = \"numeric\",\n  field_label = \"0 represents extreme problems and 100 represents no problems\",\n  field_note= \"If all three scale scores are available, The mean of all three subscale scores is then used to construct an overall KOOS-12 Summary knee impact score\")\n\n  \n# Add new rows \n\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!qol_score_new_row, .after = match(\"koosqolscoret\", psy_soc_dict$field_name)) %>% # new qol score\n  add_row(!!!func_score_new_row, .after = match(\"koosfunctionscoret\", psy_soc_dict$field_name)) %>% # new func score\n  add_row(!!!pain_score_new_row, .after = match(\"koospainscoret\", psy_soc_dict$field_name)) # new pain score\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!pain_summary_new_row, .after = match(\"koossummaryscore\", psy_soc_dict$field_name)) # new summary score\n```\n:::\n\n\n\n\n\n#### Save:\n\nSave \"koos\" and updated data dictionary as .csv files in the folder named \"reformatted_koos\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_csv(koos,file=here::here(\"data\",\"Psychosocial\",\"Reformatted\",\"reformatted_koos.csv\"))\nwrite_csv(psy_soc_dict,file=here::here(\"data\",\"Psychosocial\",\"Reformatted\",\"updated_psy_soc_dictionary.csv\"))\n```\n:::\n\n\n\n\n\n### Generalized Anxiety Disorder 7 Item (GAD7) Scale Score\n\nThe GAD-7 is a 7-item likert scale questionnaire that assesses anxiety levels over the last two weeks. The response to each item is rated on a scale of 0 (\"not at all\") to 3 (\"nearly every day\"). A total score is calculated by adding the scores for all the 7 items and ranges from 0 to 21. A greater total score on the GAD-7 reflects higher anxiety levels[@Spitzer2006]. At the end of the questionnaire there is an additional question (\"gad7difficulttowork\") to evaluate the subject's perception about the impact of identified problems on their activities such as work, taking care of things at home, or interacting with others.\n\n#### Read in Data:\n\nRead in psy_soc1 dataframe and select field names from the GAD7 data and keep completed forms, we will call this gad\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngad <- applyFilter(\"gad\",generalized_anxiety_disorder_7_item_gad7_scale_sco_complete)\n```\n:::\n\n\n\n\n\n#### Missing Data:\n\nMissing data pattern in gad. We will exclude \"gad7difficulttowork\" since the response to this field name is conditional on the responses to the rest of the GAD7 items.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngg_miss_upset(gad%>% \n              select(-gad7difficulttowork), nsets = n_var_miss(gad ),order.by= \"degree\", point.size = 1, line.size = 0.25, \n    text.scale = c(0.5))\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-41-1.png){width=672}\n:::\n:::\n\n\n\n\n\nHandling missing data:\n\nIn case of missing values, a total score can still be calculated if responses to 5 of 7 items are available (less than or equal to 29% missing data). The missing responses are first replaced with the average score of the completed items and then a total score is calculated by adding the scores for all the 7 items[@Arrieta2017].\n\nThere are two observations with complete data missing, we will remove these observations. We will create a variable \"gad_diff\" and assign a value of 1 if there is a response to \"gad7difficulttowork\" and less than or equal to 2 GAD items are missing, 2 if there is a response to \"gad7difficulttowork\" and more than 2 GAD items are missing, 3 if there is no response to \"gad7difficulttowork\" and less than or equal to 2 GAD items are missing, 4 if there is no response to \"gad7difficulttowork\" more than 2 GAD items are missing.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngad_vector <- c(\"gad2feelnervscl\",\"gad2notstopwryscl\",\"gad7wrytoomchscl\", \"gad7troubrelxscl\",\"gad7rstlessscl\",\"gad7easyannoyedscl\",\"gad7feelafrdscl\")\n\ngad <- gad %>% \n  mutate(gad_not_na = rowSums(!is.na(select(., all_of(gad_vector))))) %>% \n  mutate(gad_diff = case_when(!is.na(gad7difficulttowork) & gad_not_na >= 5 ~ 1,\n                                !is.na(gad7difficulttowork) & gad_not_na < 5 ~2,\n                                is.na(gad7difficulttowork) & gad_not_na >= 5 ~ 3,                                  is.na(gad7difficulttowork) & gad_not_na < 5 ~ 4  ,TRUE~0)) %>% \n  as_tibble() %>% \n  mutate(gad_diff = as.factor(gad_diff)) %>% \n  filter(gad_not_na !=0)\n```\n:::\n\n\n\n\n\nWe will now replace missing values with the rounded mean of remaining items if gad_diff = 1 or gad_diff = 3 i.e less than or equal to 2 GAD items are missing\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngad_vector <- c(\"gad2feelnervscl\",\"gad2notstopwryscl\",\"gad7wrytoomchscl\", \"gad7troubrelxscl\",\"gad7rstlessscl\",\"gad7easyannoyedscl\",\"gad7feelafrdscl\")\n\ngad <- gad %>% \n filter(gad_not_na != 0) %>% \n  mutate(mean_gad = case_when(gad_diff == 1 | gad_diff == 3 ~ round(rowMeans(select(., all_of(gad_vector)), na.rm = TRUE)))) %>% \n  mutate(across(all_of(gad_vector), ~if_else(is.na(.),mean_gad, .))) %>% \n  mutate(imputed_gad_score = case_when(gad_diff == 1 | gad_diff == 3 ~ rowSums(select(., all_of(gad_vector)), na.rm = TRUE)))\n```\n:::\n\n\n\n\n\nCheck missingness pattern after imputation\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngg_miss_upset(gad%>% \n              select(-gad7difficulttowork,-mean_gad,-imputed_gad_score), nsets = n_var_miss(gad ),order.by= \"degree\", point.size = 1, line.size = 0.25, \n    text.scale = c(0.5))\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-44-1.png){width=672}\n:::\n:::\n\n\n\n\n\ncheck distributions of gad scores before (gad7totscore) and after imputation (imputed_gad_score)\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n gad_plot <- gad %>% \n  filter( between(gad_not_na,5,6)) %>% \n  select(guid,gad7totscore,imputed_gad_score) %>% \n  pivot_longer(cols =c(\"gad7totscore\",\"imputed_gad_score\"), values_to = \"score\",names_to = \"score_name\") \n\n  ggplot(gad_plot, aes(x=score_name,y=score, fill=score_name)) +\n  geom_violin(alpha=.25)\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-45-1.png){width=672}\n:::\n:::\n\n\n\n\n\nRemove intermediate field names not needed\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngad<- gad %>% \n  select(-gad_not_na,-mean_gad)\n```\n:::\n\n\n\n\n\n#### New field name(s)\n\nAdd the field names \"gad_diff\" and \"imputed_gad_score\"to the data dictionary\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create field names\ngad_diff_new_row <- data.frame(\n  field_name = \"gad_diff\",\n  form_name = \"generalized_anxiety_disorder_7_item_gad7_scale_sco\",\n  field_type = \"factor\",\n  select_choices_or_calculations = \"1, if there is a response to gad7difficulttowork and less than or equal to 2 GAD items are missing|2, if there is a response to gad7difficulttowork and more than 2 GAD items are missing|3,if there is no response to gad7difficulttowork and less than or equal to 2 GAD items are missing|4,if there is no response to gad7difficulttowork more 2 GAD items are missing\" )\n  \ngad_score_new_row <- data.frame(\n  field_name = \"imputed_gad_score\",\n  form_name = \"generalized_anxiety_disorder_7_item_gad7_scale_sco\",\n  field_type = \"numeric\",\n  field_label = \" A total score ranges from 0 to 21. A greater total score on the GAD-7 reflects higher anxiety levels\",\n  field_note= \"The missing responses are first replaced with the average score of the completed items and then a total score is calculated by adding the scores for all the 7 items\")\n\n  \n# Adding new rows to the data dictionary\n# adding gad_diff\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!gad_diff_new_row, .after = match(\"gad7difficulttowork\", psy_soc_dict$field_name))\n\n# imputed gad score score\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!gad_score_new_row, .after = match(\"gad7difficulttowork\", psy_soc_dict$field_name))\n```\n:::\n\n\n\n\n\n#### Save:\n\nSave \"gad\" and updated data dictionary as .csv files in the folder named \"reformatted_gad\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_csv(gad,file = here::here(\"data\",\"Psychosocial\",\"Reformatted\",\"reformatted_gad.csv\"))\nwrite_csv(psy_soc_dict,file=here::here(\"data\",\"Psychosocial\",\"Reformatted\",\"updated_psy_soc_dictionary.csv\"))\n```\n:::\n\n\n\n\n\n### Patient Health Questionnaire Depression Scale (PHQ) Scored\n\nThe PHQ is a 8-item likert scale questionnaire that assesses depression levels over the last two weeks. The response to each item is rated on a scale of 0 (\"not at all\") to 3 (\"nearly every day\"). The total score is calculated by adding the scores for all the 8 items. A score greater than 10 on PHQ indicates major depressive disorder[@Kroenke2009].\n\n#### Read in Data:\n\nRead in psy_soc1 dataframe and select field names from the PHQ data and keep completed forms, we will call phq\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nphq <- applyFilter(\"phq\",patient_health_questionnaire_depression_scale_phq_complete)\n```\n:::\n\n\n\n\n\n#### Missing Data:\n\nMissing data pattern in phq.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngg_miss_upset(phq, nsets = n_var_miss(phq),order.by= \"degree\", point.size = 1, line.size = 0.25, \n    text.scale = c(0.5))\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-50-1.png){width=672}\n:::\n:::\n\n\n\n\n\nHandling missing data:\n\nIn case of missing values, a total score can still be calculated if responses to 6 of 8 items are available (less than or equal to 29% missing data). The missing responses are first replaced with the average score of the completed items and then a total score is calculated by adding the scores for all the 8 items[@Arrieta2017].\n\nNone of the observations have complete data missing. We will create a variable \"phq_diff\" and assign a value of 1 if there is a response to more than or equal to 6 of 8 PHQ items and 0 if there is a response to less than 6 of 8 PHQ items.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nphq_vector <- c(\"phqlitintrstscore\",\"phqdeprssnscore\",\"phqsleepimpairscore\",\"phqtirdlittleenrgyscore\",\"phqabnrmldietscore\",\"phqflngfailrscore\",\"phqconcntrtnimprmntscore\",\"phqmovmntspchimprmntscore\")\n\n\nphq <- phq %>% \n  mutate(phq_not_na = rowSums(!is.na(select(., all_of(phq_vector)))))  %>% \n  mutate(phq_diff = case_when(phq_not_na >= 6 ~ 1\n                              ,TRUE~0)) %>% \n                             as_tibble() %>% \n  mutate(phq_diff = as.factor(phq_diff))\n```\n:::\n\n\n\n\n\nWe will now replace missing values with the rounded mean of remaining items if phq_diff = 1 i.e if less than or equal to 2 PHQ items are missing and calculate the total score by taking a sum of all the items.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nphq <- phq %>% \n  mutate(mean_phq = case_when(phq_diff == 1 ~ round(rowMeans(select(., all_of(phq_vector)), na.rm = TRUE)))) %>% \n  mutate(across(all_of(phq_vector), ~if_else(is.na(.),mean_phq, .))) %>% \n  mutate(imputed_phq_score = case_when(phq_diff == 1  ~ rowSums(select(., all_of(phq_vector)), na.rm = TRUE)))\n```\n:::\n\n\n\n\n\nCheck missingness pattern after imputation\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngg_miss_upset(phq %>% \n                select(-mean_phq,-imputed_phq_score), nsets = n_var_miss(phq),order.by= \"degree\", point.size = 1, line.size = 0.25, \n    text.scale = c(0.5))\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-53-1.png){width=672}\n:::\n:::\n\n\n\n\n\ncheck distributions of phq scores before (phqtotalscore) and after imputation (imputed_phq_score)\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n phq_plot <- phq %>% \n  filter( between(phq_not_na,6,8)) %>% \n  select(guid,phqtotalscore,imputed_phq_score) %>% \n  pivot_longer(cols =c(\"phqtotalscore\",\"imputed_phq_score\"), values_to = \"score\",names_to = \"score_name\") \n\n  ggplot(phq_plot, aes(x=score_name,y=score, fill=score_name)) +\n  geom_violin(alpha=.25)\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-54-1.png){width=672}\n:::\n:::\n\n\n\n\n\nRemove intermediate field names not needed\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nphq<- phq %>% \n  select(-phq_not_na,-mean_phq)\n```\n:::\n\n\n\n\n\n#### New field name(s)\n\nAdd the field names \"phq_diff\" and \"imputed_phq_score\"to the data dictionary\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create field names\nphq_diff_new_row <- data.frame(\n  field_name = \"phq_diff\",\n  form_name = \"patient_health_questionnaire_depression_scale_phq\",\n  field_type = \"factor\",\n  select_choices_or_calculations = \"1, if there is a response to more than or equal to 6 of 8 PHQ items|0,if there is a response to less than 6 of 8 PHQ items\")\n  \nphq_score_new_row <- data.frame(\n  field_name = \"imputed_phq_score\",\n  form_name = \"patient_health_questionnaire_depression_scale_phq\",\n  field_type = \"numeric\",\n  field_label = \"A greater than 10 total score on the PHQ indicates major depressive disorder \",\n  field_note= \"The missing responses are first replaced with the average score of the completed items and then a total score is calculated by adding the scores for all the 8 items\")\n  \n\n  \n# Add new rows\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!phq_diff_new_row, .after = match(\"phqtotalscore\", psy_soc_dict$field_name)) # new summary score\n\n\n# imputed phq score \npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!phq_score_new_row, .after = match(\"phq_diff\", psy_soc_dict$field_name)) # new summary score\n```\n:::\n\n\n\n\n\n#### Save:\n\nSave \"phq\" and updated data dictionary as .csv files in the folder named \"reformatted_phq\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_csv(phq,file = here::here(\"data\",\"Psychosocial\",\"Reformatted\",\"reformatted_phq.csv\"))\nwrite_csv(psy_soc_dict,file=here::here(\"data\",\"Psychosocial\",\"Reformatted\",\"updated_psy_soc_dictionary.csv\"))\n```\n:::\n\n\n\n\n\n### Fear-Avoidance Beliefs Questionnaire v0.3 (FABQ)\n\nThe FABQ is a 4-item questionnaire that assesses fear avoidance behavior. The response to each item ranges from 0 (completely disagree) to 6 (completely agree)[@Waddell1993]. A total score is calculated by adding the scores for all the items and ranges from 0-24. A higher score indicates a higher degree of fear-avoidance belief.\n\n#### Read in Data:\n\nRead in psy_soc1 dataframe and select field names from the FABQ data and keep completed forms, we will call FABQ\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfabq <- applyFilter(\"fabq\",fearavoidance_beliefs_questionnaire_v03_fabq_complete)\n```\n:::\n\n\n\n\n\n#### Missing Data:\n\nMissing data pattern in fabq.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngg_miss_upset(fabq, nsets = n_var_miss(fabq),order.by= \"degree\", point.size = 1, line.size = 0.25, \n    text.scale = c(0.5))\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-59-1.png){width=672}\n:::\n:::\n\n\n\n\n\nHandling missing data:\n\nIn case of missing values, a total score can be calculated if responses to 3 of 4 items are available (less than or equal to 29% missing data). The missing responses are first replaced with the average score of the completed items and then a total score is calculated by adding the scores for all the 4 items[@Arrieta2017].\n\nWe will create a variable \"fabq_diff\" and assign a value of 1 if there is a response to more than or equal to 3 of 4 FABQ items and 0 if there is a response to less than 3 of 4 FABQ items.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfabq_vector <- c(\"fabqphysclactvtywrsscl\",\"fabqphysclactvtybckhrmscl\",\"fabqphysactvtyshldntdoscl\",\"fabqphysactvtycnntdoscl\")\n\nfabq <- fabq %>% \n  mutate(fabq_not_na = rowSums(!is.na(select(., all_of(fabq_vector))))) %>%  \n  mutate(fabq_diff = case_when(fabq_not_na >= 3 ~ 1\n                              ,TRUE~0)) %>% \n                             as_tibble() %>% \n  mutate(fabq_diff = as.factor(fabq_diff))\n```\n:::\n\n\n\n\n\nWe will now replace missing values with the rounded mean of remaining items if fabq_diff = 1 i.e if less than or equal to 1 FABQ item is missing and calculate the total score by taking a sum of all the items.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfabq <- fabq %>% \n  mutate(raw_fabq_score = rowSums(select(., all_of(fabq_vector)), na.rm = TRUE)) %>% \n  mutate(mean_fabq = case_when(fabq_diff == 1 ~ round(rowMeans(select(., all_of(fabq_vector)), na.rm = TRUE)))) %>% \n mutate(across(all_of(fabq_vector), ~if_else(is.na(.),mean_fabq, .))) %>% \n  mutate(imputed_fabq_score = case_when(fabq_diff == 1  ~ rowSums(select(., all_of(fabq_vector)), na.rm = TRUE)))\n```\n:::\n\n\n\n\n\nCheck missingness pattern after imputation\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngg_miss_upset(fabq, nsets = n_var_miss(fabq),order.by= \"degree\", point.size = 1, line.size = 0.25, \n    text.scale = c(0.5))\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-62-1.png){width=672}\n:::\n:::\n\n\n\n\n\ncheck distributions of fabq scores before (raw_fabq_score) and after imputation (imputed_fabq_score)\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n fabq_plot <- fabq %>% \n  filter(between(fabq_not_na,3,4)) %>% \n  select(guid,raw_fabq_score,imputed_fabq_score) %>% \n  pivot_longer(cols =c(\"raw_fabq_score\",\"imputed_fabq_score\"), values_to = \"score\",names_to = \"score_name\") \n\n  ggplot(fabq_plot, aes(x=score_name,y=score, fill=score_name)) +\n  geom_violin(alpha=.25)\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-63-1.png){width=672}\n:::\n:::\n\n\n\n\n\nRemove intermediate field names not needed\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfabq <- fabq %>% \n  select(-fabq_not_na,-mean_fabq)\n```\n:::\n\n\n\n\n\n#### New field name(s)\n\nAdd the field names \"fabq_diff\" and \"imputed_fabq_score\" to the data dictionary\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create field names\nfabq_diff_new_row <- data.frame(\n  field_name = \"fabq_diff\",\n  form_name = \"fearavoidance_beliefs_questionnaire_v03_fabq\",\n  field_type = \"factor\",\n  select_choices_or_calculations = \"1, if there is a response to more than or equal to 3 of 4 FABQ items|0, if there is a response to less than 3 of 4 FABQ items\")\n  \nfabq_score_new_row <- data.frame(\n  field_name = \"imputed_fabq_score\",\n  form_name = \"fearavoidance_beliefs_questionnaire_v03_fabq\",\n  field_type = \"numeric\",\n  field_label = \"A higher score indicates a higher degree of fear-avoidance beliefs\",\n  field_note= \"The missing responses are first replaced with the average score of the completed items and then a total score is calculated by adding the scores for all 4 items\")\n  \n\n\n\n# Adding new rows to the data dictionary\n# adding fabq_diff\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!fabq_diff_new_row, .after = match(\"fabqphysclactvtybckhrmscl\", psy_soc_dict$field_name))\n\n# imputed fabq score\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!fabq_score_new_row, .after = match(\"fabqphysclactvtybckhrmscl\", psy_soc_dict$field_name))\n```\n:::\n\n\n\n\n\n#### Save:\n\nSave \"fabq\" and updated data dictionary as .csv files in the folder named \"reformatted_fabq\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_csv(fabq,file=here::here(\"data\",\"Psychosocial\",\"Reformatted\",\"reformatted_fabq.csv\"))\nwrite_csv(psy_soc_dict,file=here::here(\"data\",\"Psychosocial\",\"Reformatted\",\"updated_psy_soc_dictionary.csv\"))\n```\n:::\n\n\n\n\n\n### Pain Catastrophizing Scale (PCS6)\n\nThe PCS-6 comprises six questions, each item is rated on a scale of 0 to 4, where 0 indicates \"not at all\" and 4 indicates \"all the time.\" The questionnaire also measures three sub-scales that evaluate rumination, magnification, and helplessness. A total score is calculated by adding the scores for all the 6 items and ranges from 0-24, the three sub scale scores can be calculated seperately as well[@Darnall2017a][@McWilliams2015]. A higher score indicates higher degree catastrophizing.\n\n#### Read in Data:\n\nRead in psy_soc1 dataframe and select field names from the PCS-6 data and keep completed forms, we will call \"pcs\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npcs <- applyFilter(\"pcq\",pain_catastrophizing_questionnaire_pcs6_complete)\n```\n:::\n\n\n\n\n\n#### Missing Data:\n\nMissing data pattern in pcs.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngg_miss_upset(pcs %>% \n                select(-pcqtotalscoreval), nsets = n_var_miss(pcs),order.by= \"degree\", point.size = 1, line.size = 0.25, \n    text.scale = c(0.5))\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-68-1.png){width=672}\n:::\n:::\n\n\n\n\n\nHandling missing data:\n\nIn case of missing values, a total score can still be calculated if responses to 5 of 6 items are available (0.29 x 6 = 1.74). The missing responses are first replaced with the average score of the completed items and then a total score is calculated by adding the scores for all the 6 items(refer to section 1.c).\n\nTwo of the the observations have complete data missing, we will remove these observations. We will create a variable \"pcs_diff\" and assign a value of 1 if there is a response to more than or equal to 5 of 6 PCS items and 0 if there is a response to less than 5 of 6 PCS items.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npcs_vector <- c(\"pcqpainawfulovrwhlmscl\",\"pcqfeelcantwithstandscl\",\"pcqafraidpainworsescl\",\"pcqhurtscl\",\"pcqpainstopscl\",\"pcqseriousscl\")\n\n\npcs <- pcs %>% \n  mutate(pcs_not_na = rowSums(!is.na(select(., all_of(pcs_vector))))) %>% \n  mutate(pcs_diff = case_when(pcs_not_na >= 5 ~ 1\n                              ,TRUE~0)) %>% \n                             as_tibble() %>% \n  mutate(pcs_diff = as.factor(pcs_diff)) %>% \n  filter(pcs_not_na != 0)\n```\n:::\n\n\n\n\n\nWe will now replace missing values with the rounded mean of remaining items if pcs_diff = 1 i.e if 1 pcs item is missing, and calculate the total score by taking a sum of all the items.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npcs <- pcs %>% \n  mutate(raw_pcs_score = rowSums(select(., all_of(pcs_vector)), na.rm = TRUE)) %>% \n  mutate(mean_pcs = case_when(pcs_diff == 1 ~ round(rowMeans(select(., all_of(pcs_vector)), na.rm = TRUE)))) %>% \n  mutate(across(all_of(pcs_vector), ~if_else(is.na(.),mean_pcs, .))) %>% \n  mutate(imputed_pcs_score = case_when(pcs_diff == 1  ~ rowSums(select(., all_of(pcs_vector)), na.rm = TRUE)))\n```\n:::\n\n\n\n\n\nCheck missingness pattern after imputation\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngg_miss_upset(pcs %>% \n                select(-pcqtotalscoreval,-raw_pcs_score,-imputed_pcs_score), nsets = n_var_miss(pcs),order.by= \"degree\", point.size = 1, line.size = 0.25, \n    text.scale = c(0.5))\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-71-1.png){width=672}\n:::\n:::\n\n\n\n\n\ncheck distributions of PCS scores before (raw_pcs_score) and after imputation (imputed_pcs_score)\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n pcs_plot <- pcs %>% \n  filter(between(pcs_not_na,5,6)) %>% \n  select(guid,raw_pcs_score,imputed_pcs_score) %>% \n  pivot_longer(cols =c(\"raw_pcs_score\",\"imputed_pcs_score\"), values_to = \"score\",names_to = \"score_name\") \n\n  ggplot(pcs_plot, aes(x=score_name,y=score, fill=score_name)) +\n  geom_violin(alpha=.25)\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-72-1.png){width=672}\n:::\n:::\n\n\n\n\n\nRemove intermediate field names not needed\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npcs <- pcs %>% \n  select(-pcs_not_na,-mean_pcs,-raw_pcs_score)\n```\n:::\n\n\n\n\n\n#### New field name(s)\n\nAdd the field names \"pcs_diff\" and \"imputed_pcs_score\"to the data dictionary\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create field names\npcs_diff_new_row <- data.frame(\n  field_name = \"pcs_diff\",\n  form_name = \"pain_catastrophizing_questionnaire_pcs6\",\n  field_type = \"factor\",\n  select_choices_or_calculations = \"1, if there is a response to more than or equal to 5 of 6 PCS items|0, if there is a response to less than 5 of 6 PCS items\")\n  \npcs_score_new_row <- data.frame(\n  field_name = \"imputed_pcs_score\",\n  form_name = \"pain_catastrophizing_questionnaire_pcs6\",\n  field_type = \"numeric\",\n  field_label = \"A higher score indicates a higher degree of catastrophizing\",\n  field_note= \"The missing responses are first replaced with the average score of the completed items and then a total score is calculated by adding the scores for all the items\")\n\n# adding pcs_diff\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!pcs_diff_new_row, .after = match(\"pcqtotalscoreval\", psy_soc_dict$field_name))\n\n# imputed pcs score\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!pcs_score_new_row, .after = match(\"pcqtotalscoreval\", psy_soc_dict$field_name))  \n```\n:::\n\n\n\n\n\n#### Save:\n\nSave \"pcs\" and updated data dictionary as .csv files in the folder named \"reformatted_pcs\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_csv(pcs,file=here::here(\"data\",\"Psychosocial\",\"Reformatted\",\"reformatted_pcs.csv\"))\nwrite_csv(psy_soc_dict,file=here::here(\"data\",\"Psychosocial\",\"Reformatted\",\"updated_psy_soc_dictionary.csv\"))\n```\n:::\n\n\n\n\n\n### Symptom Severity Index v1.0 (SSI)\n\nThe SSI measures the severity of fatigue, cognitive dysfunction, and unrefreshed sleep over the past week using a Likert scale from 0 (no problem) to 3 (severe). If the sum of the scores of fatigue, waking unrefreshed, and cognitive symptoms is more than 0, an additional question (ssi_chronicyn) related to the duration of symptoms is asked. The questionnaire also comprises three additional questions for the history of lower abdomen pain, depression, and headache for at least three months (yes/no). The symptom severity scale (SSS) score is calculated by summing up the scores of fatigue, waking unrefreshed, and cognitive symptoms, which range from 0 to 9, and the sum (0-3) of additional symptoms experienced in the past six months. The final total score can be between 0 and 12.[@wolfe2016].\n\n#### Read in Data:\n\nRead in psy_soc1 dataframe and select field names from the SSI data and keep completed forms, we will call \"ssi\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nssi <- applyFilter(\"ssi\",symptom_severity_index_v10_ssi_complete)\n```\n:::\n\n\n\n\n\n#### Missing Data:\n\nMissing data pattern in SSI, we will exclude \"ssi_chronicyn\" since the response to this field name is conditional on the sum of fatigue, waking unrefreshed, and cognitive symptom scores being more than 0.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngg_miss_upset(ssi %>% \n                select(-ssi_chronicyn), nsets = n_var_miss(ssi),order.by= \"degree\", point.size = 1, line.size = 0.25, \n    text.scale = c(0.5))\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-77-1.png){width=672}\n:::\n:::\n\n\n\n\n\nHandling missing data:\n\nMissing values for fatigue, cognitive dysfunction, or unrefreshed sleep cannot be imputed using row wise means since 28% X 3 = 0.87, resulting in the floor value for non integer values being 0. Additionally we will not impute missing values for history of lower abdomen pain, depression, and headache for at least three months (yes/no)(refer section 1.c).\n\nScoring:\n\nWe will calculate:\n\n-   A summed score for fatigue, cognitive dysfunction, or unrefreshed sleep if responses to all three items are available, ranging from 0-9, we will name this \"ssi_symp_score\"\n\n-   A summed score for history of lower abdomen pain, depression, and headache for at least three months (yes/no), ranging from 0-3, we will name this \"ssi_hist_score\"\n\n-   Finally we will calculate a total summed score ranging from 0-12 if responses to all items are available, we will name this \"ssi_total_score\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nssi_symptoms <- c(\"ssi_fatigue\",\"ssi_cognitive\",\"ssi_tired\")\nssi_history <- c(\"ssi_abdpainyn\",\"ssi_depressyn\",\"ssi_headacheyn\")\nssi_all <- c(\"ssi_symp_score\",\"ssi_hist_score\")\n\nssi <- ssi %>% \n  mutate(ssi_symp_score = rowSums(select(., all_of(ssi_symptoms)), na.rm = FALSE))  %>% \n  mutate(ssi_hist_score = rowSums(select(., all_of(ssi_history)), na.rm = FALSE)) %>% \n  mutate(ssi_total_score = rowSums(select(., all_of(ssi_all)), na.rm = FALSE))     \n```\n:::\n\n\n\n\n\nWe will now create a field name \"ssi_diff\", and assign a value of 0 if both ssi_symp_score and ssi_hist_score are missing, 1 if only ssi_symp_score is available, 2 if only ssi_hist_score is available and 3 if both scores and invariably the total score is available. If the sum of the scores of fatigue, waking unrefreshed, and cognitive symptoms is more than 0, an additional question (ssi_chronicyn) related to the duration of symptoms is asked. We will create a field name \"ssi_missing_chronic\" and assign a value of 0 if \"ssi_symp_score\" \\> 0 and \"ssi_chronicyn\" is missing, of 1 if \"ssi_symp_score\" \\> 0 and \"ssi_chronicyn\" is not missing, 2 if \"ssi_sym_score\" = 0 or \"ssi_sym_score\" is missing and \"ssi_chronicyn\" is missing.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nssi <- ssi %>% \n  mutate(ssi_diff = case_when(is.na(ssi_symp_score) & is.na(ssi_hist_score) ~0,\n                            !is.na(ssi_symp_score) & is.na(ssi_hist_score)~1,\n                            is.na(ssi_symp_score) & !is.na(ssi_hist_score)~2,\n                            TRUE~3)) %>%\n  mutate(ssi_missing_chronic = case_when(ssi_symp_score > 0 & !is.na(ssi_chronicyn) ~1,\n                            ssi_symp_score > 0 & is.na(ssi_chronicyn)~0,\n                            TRUE~2)) %>% \n  mutate(ssi_diff = as.factor(ssi_diff)) %>% \n  mutate(ssi_missing_chronic=as.factor(ssi_missing_chronic))\n```\n:::\n\n\n\n\n\n#### New field name(s)\n\nAdd the field names \"ssi_symp_score\", \"ssi_hist_score\", \"ssi_total_score\", \"ssi_diff\", and \"ssi_missing_chronic\" to the data dictionary.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create field names\nssi_symp_score_new_row <- data.frame(\n  field_name = \"ssi_symp_score\",\n  form_name = \"symptom_severity_index_v10_ssi\",\n  field_type = \"numeric\",\n  field_label = \"Total score ranges from 0 to 9\",\n  field_note= \"Summed score for fatigue, cognitive dysfunction, or unrefreshed sleep if responses to all three items are available\")\n  \nssi_hist_score_new_row <- data.frame(\n  field_name = \"ssi_hist_score\",\n  form_name = \"symptom_severity_index_v10_ssi\",\n  field_type = \"numeric\",\n  field_label = \"Total score ranges from 0 to 3\",\n  field_note= \"Summed score for history of lower abdomen pain, depression, and headache for at least three months (yes/no)\")\n\nssi_total_score_new_row <- data.frame(\n  field_name = \"ssi_total_score\",\n  form_name = \"symptom_severity_index_v10_ssi\",\n  field_type = \"numeric\",\n  field_label = \"Total score ranges from 0 to 12\",\n  field_note= \"Summed score of all the items if responses to all items are available\")\n\n\nssi_diff_new_row <- data.frame(\n  field_name = \"ssi_diff\",\n  form_name = \"symptom_severity_index_v10_ssi\",\n  field_type = \"factor\",\n  select_choices_or_calculations = \"0, if both ssi_symp_score and ssi_hist_score are missing, 1 if only ssi_symp_score is available|2, if only ssi_hist_score is available | 3, if both scores and invariably the total score is available\")\n\nssi_missing_chronic_new_row <- data.frame(\n  field_name = \"ssi_missing_chronic\",\n  form_name = \"symptom_severity_index_v10_ssi\",\n  field_type = \"factor\",\n  select_choices_or_calculations = \"0 if ssi_symp_score > 0 and ssi_chronicyn is missing| 1 if ssi_symp_score > 0 and ssi_chronicyn is not missing,2 if ssi_sym_score = 0 or is missing and ssi_chronicyn is missing\")\n\n\n# adding new rows\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!ssi_symp_score_new_row, .after = match(\"ssi_headacheyn\", psy_soc_dict$field_name))\n\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!ssi_hist_score_new_row, .after = match(\"ssi_headacheyn\", psy_soc_dict$field_name))  \n\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!ssi_total_score_new_row, .after = match(\"ssi_headacheyn\", psy_soc_dict$field_name))  \n\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!ssi_diff_new_row, .after = match(\"ssi_headacheyn\", psy_soc_dict$field_name))  \n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!ssi_missing_chronic_new_row, .after = match(\"ssi_headacheyn\", psy_soc_dict$field_name))  \n```\n:::\n\n\n\n\n\n#### Save:\n\nSave \"ssi\" and updated data dictionary as .csv files in the folder named \"reformatted_ssi\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_csv(ssi,file=here::here(\"data\",\"Psychosocial\",\"Reformatted\",\"reformatted_ssi.csv\"))\nwrite_csv(psy_soc_dict,file=here::here(\"data\",\"Psychosocial\",\"Reformatted\",\"updated_psy_soc_dictionary.csv\"))\n```\n:::\n\n\n\n\n\n### Pain Detect Questionnaire (PD-Q)\n\nThe PD-Q consists of seven question to evaluate neuropathic pain, followed by two additional questions that focus on pain patterns to differentiate between neuropathic and nociceptive pain.\n\nEach item in the initial seven questions is rated on a scale of 0 to 5, where 0 indicates \"never\" and 5 indicates \"very strongly.\" The total score is calculated by summing up the scores of the initial seven questions, which can range from 0 to 35, plus the sum of additional two questions. The final total score can be between 0 and 38[@Freynhagen2006].\n\n#### Read in Data:\n\nRead in psy_soc1 dataframe and select field names from the PD-Q data and keep completed forms, we will call \"pdq\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npdq <- applyFilter(\"pd\",pain_detect_questionnaire_pdq_complete)\n```\n:::\n\n\n\n\n\n#### Missing Data:\n\nMissing data pattern in pdq: Subjects with a total score of 0 on the initial 7 questions may not have responses to the questions related to pain patterns. We will account for this when visualizing missing data pattern.\n\nThere are rows where the sum of initial seven questions is 0 and there are responses to \"pdqpaincourse\" and \"pdradiateregions\". Create a dataset \"pdq_zero\" and fill in missing values with \"99\" for the questions related to pain pattern (\"pdqpaincourse\" and \"pdradiateregions\") if the sum of initial seven questions is 0 and if responses to \"pdqpaincourse\" and \"pdradiateregions\" are not available\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npdq_seven <- c(\"pdburnsens\",\"pdtinglsens\",\"pdlttouch\",\"pdsudpanatt\",\"pdbathwtr\",\"pdnumb\", \"pdslightpress\")\npdq_zero <- pdq %>% \n  mutate(pdq_seven_score = rowSums(select(., all_of(pdq_seven)), na.rm = TRUE))%>%\n  mutate(pdqpaincourse=case_when(pdq_seven_score==0 & is.na(pdqpaincourse) ~99,TRUE~pdqpaincourse,\n         )) %>% \n mutate(pdradiateregions=case_when(pdq_seven_score==0 & is.na(pdradiateregions)~99,TRUE~pdradiateregions,\n         )) \n```\n:::\n\n\n\n\n\nVisualize missing data after accounting for missing responses to pdqpaincourse\" and \"pdradiateregions\" if the sum of total score of the initial 7 items is 0.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngg_miss_upset(pdq_zero, nsets = n_var_miss(pdq_zero),order.by= \"degree\", point.size = 1, line.size = 0.25, \n    text.scale = c(0.5))\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-84-1.png){width=672}\n:::\n:::\n\n\n\n\n\nHandling missing data:\n\nMissing values for the initial neuropathic pain related seven question can be imputed if the responses to 5 of 7 items are available (less than or equal to 29% missing data). The missing responses are first replaced with the average score of the completed items and then a total score is calculated by adding the scores for all the seven items. We will not impute missing values \"pdqpaincourse\" and \"pdradiateregions\" since these two follow up questions focus on pain patterns to differentiate between neuropathic and nociceptive pain (refer section 1.c).\n\nWe will create a variable \"pdq_diff\" and assign a value of 1 if there is a response to more than or equal to 5 of 7 Pdq items and 0 if there is a response to less than 5 of 7 Pdq items.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npdq_seven <- c(\"pdburnsens\",\"pdtinglsens\",\"pdlttouch\",\"pdsudpanatt\",\"pdbathwtr\",\"pdnumb\", \"pdslightpress\")\npdq <- pdq %>% \n  mutate(pdq_not_na = rowSums(!is.na(.[,pdq_seven]))) %>% \n  mutate(pdq_diff = case_when(pdq_not_na >= 5 ~ 1\n                              ,TRUE~0)) %>% \n                             as_tibble() %>% \n  mutate(pdq_diff = as.factor(pdq_diff))\n```\n:::\n\n\n\n\n\nWe will now replace missing values with the rounded mean of remaining items if pdq_diff = 1 and calculate a score by taking a sum of the 7 neuropathic pain related items, we will call this \"imputed_pdq_score.\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npdq <- pdq %>% \n  mutate(raw_pdq_score = rowSums(select(., all_of(pdq_seven)), na.rm = TRUE)) %>% \n  mutate(mean_pdq = case_when(pdq_diff == 1 ~ round(rowMeans(select(., all_of(pdq_seven)), na.rm = TRUE)))) %>% \n  mutate(across(all_of(pdq_seven), ~if_else(is.na(.),mean_pdq, .))) %>% \n  mutate(imputed_pdq_score = case_when(pdq_diff == 1  ~ rowSums(select(., all_of(pdq_seven)), na.rm = TRUE)))\n```\n:::\n\n\n\n\n\nCheck missingness pattern after imputation\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npdq_zero_imputed <- pdq_zero %>% \n  mutate(pdq_not_na = rowSums(!is.na(.[,pdq_seven]))) %>% \n  mutate(pdq_diff = case_when(pdq_not_na >= 5 ~ 1\n                              ,TRUE~0)) %>% \n                             as_tibble() %>% \n  mutate(pdq_diff = as.factor(pdq_diff)) %>% \n  mutate(mean_pdq = case_when(pdq_diff == 1 ~ round(rowMeans(select(., all_of(pdq_seven)), na.rm = TRUE)))) %>% \n  mutate(across(all_of(pdq_seven), ~if_else(is.na(.),mean_pdq, .))) %>% \n  select(-pdq_seven_score,-pdq_diff,-pdq_not_na,-mean_pdq)\n  \ngg_miss_upset(pdq_zero_imputed, nsets = n_var_miss(pdq_zero_imputed),order.by= \"degree\", point.size = 1, line.size = 0.25, \n    text.scale = c(0.5))\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-87-1.png){width=672}\n:::\n:::\n\n\n\n\n\ncheck distributions of PDQ scores before (raw_pdq_score) and after imputation (imputed_pdq_score)\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n pdq_plot <- pdq %>% \n  filter(between(pdq_not_na,5,7)) %>% \n  select(guid,raw_pdq_score,imputed_pdq_score) %>% \n  pivot_longer(cols =c(\"raw_pdq_score\",\"imputed_pdq_score\"), values_to = \"score\",names_to = \"score_name\") \n\n  ggplot(pdq_plot, aes(x=score_name,y=score, fill=score_name)) +\n  geom_violin(alpha=.25)\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-88-1.png){width=672}\n:::\n:::\n\n\n\n\n\nRemove intermediate field names not needed\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npdq <- pdq %>% \n  select(-pdq_not_na,-mean_pdq,-raw_pdq_score)\n```\n:::\n\n\n\n\n\n#### Scoring:\n\n**The scoring for pain behavior pattern (**pdqpaincourse) **and the pain radiation (**pdradiateregions) is as follows[@Freynhagen2006]\\[PainDETECT.pdf\\](https://www.oregon.gov/oha/HPA/dsi-pmc/PainCareToolbox/PainDETECT.pdf):\n\n![](images/Screen%20Shot%202023-08-18%20at%202.59.07%20PM%203-02.png)\n\n-   First we will recode values for \"pdqpaincourse\" and \"pdradiateregions\" according to the above table\n\n-   We will then combine \"pdqpaincourse\", \"pdradiateregions\" scores and the \"imputed_pdq_score\" to get the total score.\n\nRecode values for \"pdqpaincourse\" and \"pdradiateregions\", we will call these \"pdqpaincourse_recoded\" and \"pdradiateregions_recoded\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npdq <- pdq %>% \n  mutate(pdqpaincourse_recoded = case_when(pdqpaincourse==1~0,\n          pdqpaincourse==2~-1,\n          pdqpaincourse==3~1,\n          pdqpaincourse==4~1,TRUE~pdqpaincourse)) %>% \n  mutate(pdradiateregions_recoded = case_when(pdradiateregions==0~0,\n          pdradiateregions==1~2,TRUE~pdradiateregions))\n```\n:::\n\n\n\n\n\nCombine \"pdqpaincourse_recoded\", \"pdradiateregions_recoded\" scores and the \"imputed_pdq_score\" to get the total score if all three scores are available, we will call this \"pd_neuro_total_score\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npd_neuro <- c(\"pdqpaincourse_recoded\",\"pdradiateregions_recoded\",\"imputed_pdq_score\")\npdq <- pdq %>% \n  mutate(pd_neuro_total_score = rowSums(select(., all_of(pd_neuro)), na.rm = FALSE))  %>% \n  mutate(pdqpaincourse_recoded = as.factor(pdqpaincourse_recoded)) %>% \n  mutate(pdradiateregions_recoded = as.factor(pdradiateregions_recoded ))\n```\n:::\n\n\n\n\n\n#### New field name(s)\n\nAdd the field names \"pdq_diff\",\"pdqpaincourse_recoded\",\"pdradiateregions_recoded\",\"imputed_pdq_score\", and \"pd_neuro_total_score\" to the data dictionary\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create field names\npdq_diff_new_row <- data.frame(\n  field_name = \"pdq_diff\",\n  form_name = \"pain_detect_questionnaire_pdq\",\n  field_type = \"factor\",\n  select_choices_or_calculations = \"1, if there is a response to more than or equal to 5 of 7 PDQ neuropathic pain related items| 0, if there is a response to less than 5 of 7 items\")\n  \npdq_score_new_row <- data.frame(\n  field_name = \"imputed_pdq_score\",\n  form_name = \"pain_detect_questionnaire_pdq\",\n  field_type = \"numeric\",\n  field_label = \"Sum of the 7 neuropathic pain related items by replacing missing values with the rounded mean of remaining items if pdq_diff = 1\")\n\npdq_course_new_row <- data.frame(\n  field_name = \"pdqpaincourse_recoded\",\n  form_name = \"pain_detect_questionnaire_pdq\",\n  field_type = \"factor\",\n  select_choices_or_calculations = \"0,Persistent pain with slight fluctuations|-1,Persistent pain with pain attacks|1,Pain attacks without pain between them|1,Pain attacks with pain between them\")\n\n\npdq_radiate_new_row <- data.frame(\n  field_name = \"pdradiateregions_recoded\",\n  form_name = \"pain_detect_questionnaire_pdq\",\n  field_type = \"factor\",\n  select_choices_or_calculations = \"0,No Radiating pains|2,Radiating pains\")\n\npdq_neuro_score_new_row <- data.frame(\n  field_name = \"pd_neuro_total_score\",\n  form_name = \"pain_detect_questionnaire_pdq\",\n  field_type = \"numeric\",\n  field_label = \"Sum of pdqpaincourse_recoded,pdradiateregions_recoded and the imputed_pdq_score if all three scores are available\")\n\n\n\n\n# adding rows\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!pdq_diff_new_row, .after = match(\"pdradiateregions\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!pdq_score_new_row, .after = match(\"pdradiateregions\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!pdq_course_new_row, .after = match(\"pdradiateregions\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!pdq_radiate_new_row, .after = match(\"pdradiateregions\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!pdq_neuro_score_new_row, .after = match(\"pdradiateregions\", psy_soc_dict$field_name))\n```\n:::\n\n\n\n\n\n#### Save:\n\nSave \"pdq\" and updated data dictionary as .csv files in the folder named \"reformatted_pdq\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_csv(pdq,file=here::here(\"data\",\"Psychosocial\",\"Reformatted\",\"reformatted_pdq.csv\"))\nwrite_csv(psy_soc_dict,file=here::here(\"data\",\"Psychosocial\",\"Reformatted\",\"updated_psy_soc_dictionary.csv\"))\n```\n:::\n\n\n\n\n\n### Patient-Reported Outcomes Measurement Information System (PROMIS)\n\nPROMIS instruments are based on item response theory (IRT), where the responses to a set of items measure a latent trait[@cella2010]. PROMIS instruments can be scored accurately using the HealthMeasures Scoring Service found [here](https://www.assessmentcenter.net/ac_scoringservice). The A2PCS uses the following PROMIS instruments:\n\n| Form Name                                       |\n|-------------------------------------------------|\n| PROMIS SF v1.2 - Physical Function 8b           |\n| PROMIS SF v1.0 - Sleep Disturbance 6a (Sleep I) |\n| PROMIS SF v1.0 - Fatigue 7a                     |\n| PROMIS SF v2.0 - Emotional Support 6a           |\n| PROMIS SF v2.0 - Instrumental Support 6a        |\n\n### Pain-Sleep Duration (Sleep II)\n\nThe Sleep II form measures the average number of hours and minutes of sleep each night during the past month[@Buysse1989].\n\n#### Read in Data:\n\nRead in psy_soc1 dataframe and select field names from the Sleep Duration data and keep completed forms, we will call \"sleep_dur\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsleep_dur <- applyFilter(\"sleep\",painsleep_duration_sleep_ii_complete) %>% \n  retype()\n```\n:::\n\n\n\n\n\n#### Outliers:\n\nMissing values for hours and minutes of sleep cannot be imputed. We will check the distribution of hours and minutes of sleep and check for outliers\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow = c(1,1))\nboxplot(sleep_dur$sleepnighthourmindurhrs,\n         ylab = \"Sleep Hours\"\n)\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-95-1.png){width=672}\n:::\n\n```{.r .cell-code}\nboxplot(sleep_dur$sleepnighthourmindurmins,\n         ylab = \"Sleep Minutes\"\n)\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-95-2.png){width=672}\n:::\n:::\n\n\n\n\n\nWe will create a variable \"sleep_outlier_hours\" and assign a value of 0 if \"sleepnighthourmindurhrs\" is missing and \"sleepnighthourmindurmins\" is available, 1 if \"sleepnighthourmindurhrs\" is less than or equal to 23 (within range) and 2 if \"sleepnighthourmindurhrs\" is more than 23, and 4 if both \"sleepnighthourmindurhrs\" and \"sleepnighthourmindurmins\" are missing. We will not assign a value for missing \"sleepnighthourmindurmins\" for this variable since most people report sleep in hours, unless both \"sleepnighthourmindurhrs\" and \"sleepnighthourmindurmins\" are missing.\n\nWe will also create a variable \"sleep_outlier_mins\" and assign a value of 1 if \"sleepnighthourmindurmins\" is less than or equal to 59 (within range) and 2 if \"sleepnighthourmindurmins\" is more than 59 (out of range), and 3 if \"sleepnighthourmindurmins\" is missing.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsleep_dur <- sleep_dur %>% \n  mutate(sleep_outlier_hours = case_when(is.na(sleepnighthourmindurhrs) & !is.na (sleepnighthourmindurmins) ~ 0,\n  sleepnighthourmindurhrs <= 23 ~1,\n  sleepnighthourmindurhrs > 23 ~ 2,\n  is.na(sleepnighthourmindurhrs) & is.na (sleepnighthourmindurmins) ~4)) %>% \n  mutate(sleep_outlier_hours=as.factor(sleep_outlier_hours))\n\nsleep_dur <- sleep_dur %>% \n  mutate(sleep_outlier_mins = case_when(\n  sleepnighthourmindurmins <= 59 ~1,\n  sleepnighthourmindurmins > 59 ~ 2, TRUE ~ 3)) %>% \n  mutate(sleep_outlier_mins=as.factor(sleep_outlier_mins))\n```\n:::\n\n\n\n\n\n#### New field name(s)\n\nAdd the field names \"sleep_outlier_hours\" and \"sleep_outlier_mins\" to the data dictionary\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create field names\nsleep_hour_new_row <- data.frame(\n  field_name = \"sleep_outlier_hours\",\n  form_name = \"painsleep_duration_sleep_ii\",\n  field_type = \"factor\",\n  select_choices_or_calculations = \"0, if sleepnighthourmindurhrs is missing and sleepnighthourmindurmins is available|1 if sleepnighthourmindurhrs is less than or equal to 23 (within range)|2,if sleepnighthourmindurhrs is more than 23 | 4, if both sleepnighthourmindurhrs and sleepnighthourmindurmins are missing\")\n  \nsleep_mins_new_row <- data.frame(\n  field_name = \"sleep_outlier_mins\",\n  form_name = \"painsleep_duration_sleep_ii\",\n  field_type = \"factor\",\n  select_choices_or_calculations = \"1 if sleepnighthourmindurmins is less than or equal to 59 (within range)|2, if sleepnighthourmindurmins is more than 59 (out of range)| 3 if sleepnighthourmindurmins is missing\")\n\n\n# adding rows\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!sleep_hour_new_row, .after = match(\"sleepnighthourmindur\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!sleep_mins_new_row, .after = match(\"sleepnighthourmindur\", psy_soc_dict$field_name))\n```\n:::\n\n\n\n\n\n#### Save:\n\nSave \"sleep_dur\" and updated data dictionary as .csv files in the folder named \"reformatted_sleep_dur\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_csv(sleep_dur,file=here::here(\"data\",\"Psychosocial\",\"Reformatted\",\"reformatted_sleep_dur.csv\"))\nwrite_csv(psy_soc_dict,file=here::here(\"data\",\"Psychosocial\",\"Reformatted\",\"updated_psy_soc_dictionary.csv\"))\n```\n:::\n\n\n\n\n\n### Pain Resilience Scale (PRS)\n\nPRS is a 14-item scale that measures resilience during intense or prolonged pain[@Slepian2016].\n\nEach item is rated on a scale of 0 to 4, where 0 indicates \"not at all\" and 4 indicates \"all the time.\" The total score is calculated by summing up all 14 items, which can range from 0 to 56. Higher scores indicate greater pain related resilience. PRS also contains two sub scales[@Slepian2016]\n\n-   Behavioral Perseverance = sum of items 1-5\n\n-   Cognitive/Affective positivity = sum of items 6-14\n\n#### Read in Data:\n\nRead in psy_soc1 dataframe and select field names from the PRS forms and keep completed forms, we will call this \"prs\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprs <- applyFilter(\"prs\",pain_resilience_scale_prs_complete)\n```\n:::\n\n\n\n\n\n#### Behavioral Perseverance (items 1-5): Handling missing data and scoring\n\nMissing data pattern in Behavioral Perseverance.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngg_miss_upset(prs %>% \n                select(prsbackoutscl,prsworkgoalsscl,prspushthroughscl,prscontworkscl,prsstayactivescl), nsets = n_var_miss(prs),order.by= \"degree\", point.size = 1, line.size = 0.25, \n    text.scale = c(0.5))\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-100-1.png){width=672}\n:::\n:::\n\n\n\n\n\nMissing values can be imputed if the responses to 4 of 5 items are available (less than or equal to 29% missing data).\n\nThe missing responses are first replaced with the average score of the completed items and then a total score is calculated by adding the scores for all the seven items\n\nWe will create a variable \"prs_bhv_diff\" and assign a value of 1 if there is a response to more than or equal to 4 of 5 behavioral perseverance items and 0 if there is a response to less than 4 of 5 items.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprs_bhv_five <- c(\"prsbackoutscl\",\"prsworkgoalsscl\",\"prspushthroughscl\",\"prscontworkscl\",\"prsstayactivescl\")\n\n\nprs <- prs %>% \n mutate(prs_bhv_not_na = rowSums(!is.na(select(., all_of(prs_bhv_five)))))  %>% \n  mutate(prs_bhv_diff = case_when(prs_bhv_not_na >= 4 ~ 1\n                              ,TRUE~0)) %>% \n                             as_tibble() %>% \n  mutate(prs_bhv_diff = as.factor(prs_bhv_diff))\n```\n:::\n\n\n\n\n\nWe will now replace missing values with the rounded mean of remaining items if prs_bhv_diff = 1 and calculate a behavioral perseverance score by taking a sum of 5 associated item, we will call this \"imputed_bhv_score.\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprs <- prs %>% \n  mutate(raw_bhv_score = rowSums(select(., all_of(prs_bhv_five)), na.rm = TRUE)) %>% \n  mutate(mean_bhv_prs = case_when(prs_bhv_diff == 1 ~ round(rowMeans(select(., all_of(prs_bhv_five)), na.rm = TRUE)))) %>% \n  mutate(across(all_of(prs_bhv_five), ~if_else(is.na(.),mean_bhv_prs, .))) %>% \n  mutate(imputed_bhv_score = case_when(prs_bhv_diff == 1  ~ rowSums(select(., all_of(prs_bhv_five)), na.rm = TRUE)))\n```\n:::\n\n\n\n\n\nCheck missingness pattern after imputation\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngg_miss_upset(prs %>% \n                select(prsbackoutscl,prsworkgoalsscl,prspushthroughscl,prscontworkscl,prsstayactivescl), nsets = n_var_miss(prs),order.by= \"degree\", point.size = 1, line.size = 0.25, \n    text.scale = c(0.5))\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-103-1.png){width=672}\n:::\n:::\n\n\n\n\n\ncheck distributions of behavioral perseverance scores before (raw_bhv_score) and after imputation (imputed_bhv_score)\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n prs_bhv_plot <- prs %>% \n  filter(between(prs_bhv_not_na,4,5)) %>% \n  select(guid,raw_bhv_score,imputed_bhv_score) %>% \n  pivot_longer(cols =c(\"raw_bhv_score\",\"imputed_bhv_score\"), values_to = \"score\",names_to = \"score_name\") \n\n  ggplot(prs_bhv_plot, aes(x=score_name,y=score, fill=score_name)) +\n  geom_violin(alpha=.25)\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-104-1.png){width=672}\n:::\n:::\n\n\n\n\n\nRemove intermediate field names not needed\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprs <- prs %>% \n  select(-prs_bhv_not_na,-mean_bhv_prs,-raw_bhv_score)\n```\n:::\n\n\n\n\n\n#### Cognitive/Affective positivity: Handling missing data and scoring\n\nMissing Data Pattern\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngg_miss_upset(prs %>% \n                select(prsfocuspositivescl,prsposattitudescl,prsnotaffecthappyscl,prsfindjoyscl,prshopefulscl,prsnotgetdownscl,prsnotupsetscl,prsavoidnegativescl,prsstayrelaxscl), nsets = n_var_miss(prs),order.by= \"degree\", point.size = 1, line.size = 0.25, \n    text.scale = c(0.5))\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-106-1.png){width=672}\n:::\n:::\n\n\n\n\n\nMissing values can be imputed if the responses to 7 of 9 items are available (less than or equal to 29% missing data).\n\nThe missing responses are first replaced with the average score of the completed items and then a total score is calculated by adding the scores for all the seven items\n\nWe will create a variable \"prs_cog_diff\" and assign a value of 1 if there is a response to more than or equal to 7 of 9 Cognitive/Affective positivity items and 0 if there is a response to less than 7 of 9 items.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprs_cog_nine <- c(\"prsfocuspositivescl\",\"prsposattitudescl\",\"prsnotaffecthappyscl\",\"prsfindjoyscl\",\"prshopefulscl\",\"prsnotgetdownscl\",\"prsnotupsetscl\",\"prsavoidnegativescl\",\"prsstayrelaxscl\")\n\n\nprs <- prs %>% \n  mutate(prs_cog_not_na = rowSums(!is.na(.[,prs_cog_nine]))) %>% \n  mutate(prs_cog_diff = case_when(prs_cog_not_na >= 7 ~ 1\n                              ,TRUE~0)) %>% \n                             as_tibble() %>% \n  mutate(prs_cog_diff = as.factor(prs_cog_diff))\n```\n:::\n\n\n\n\n\nWe will now replace missing values with the rounded mean of remaining items if prs_cog_diff = 1 and calculate a Cognitive/Affective positivity score by taking a sum of 9 associated item, we will call this \"imputed_prs_cog_score.\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprs <- prs %>% \n  mutate(raw_prs_cog_score = rowSums(select(., all_of(prs_cog_nine)), na.rm = TRUE)) %>% \n  mutate(mean_cog_prs = case_when(prs_cog_diff == 1 ~ round(rowMeans(select(., all_of(prs_cog_nine)), na.rm = TRUE)))) %>% \n  mutate(across(all_of(prs_cog_nine), ~if_else(is.na(.),mean_cog_prs, .))) %>% \n  mutate(imputed_prs_cog_score = case_when(prs_cog_diff == 1  ~ rowSums(select(., all_of(prs_cog_nine)), na.rm = TRUE)))\n```\n:::\n\n\n\n\n\nCheck missingness pattern after imputation\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngg_miss_upset(prs %>% \n                select(prsfocuspositivescl,prsposattitudescl,prsnotaffecthappyscl,prsfindjoyscl,prshopefulscl,prsnotgetdownscl,prsnotupsetscl,prsavoidnegativescl,prsstayrelaxscl), nsets = n_var_miss(prs),order.by= \"degree\", point.size = 1, line.size = 0.25, \n    text.scale = c(0.5))\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-109-1.png){width=672}\n:::\n:::\n\n\n\n\n\nCheck distributions Cognitive/Affective positivity scores before (raw_prs_cog_score) and after imputation (imputed_prs_cog_score)\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n prs_cog_plot <- prs %>% \n  filter(between(prs_cog_not_na,7,9)) %>% \n  select(guid,raw_prs_cog_score,imputed_prs_cog_score) %>% \n  pivot_longer(cols =c(\"raw_prs_cog_score\",\"imputed_prs_cog_score\"), values_to = \"score\",names_to = \"score_name\") \n\n  ggplot(prs_cog_plot, aes(x=score_name,y=score, fill=score_name)) +\n  geom_violin(alpha=.25)\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-110-1.png){width=672}\n:::\n:::\n\n\n\n\n\nRemove intermediate field names not needed\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprs <- prs %>% \n  select(-prs_cog_not_na,-mean_cog_prs,-raw_prs_cog_score)\n```\n:::\n\n\n\n\n\n#### Total PRS Score: Handling missing data and scoring\n\nMissing data pattern in prs.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngg_miss_upset(prs %>% \n                select(prsbackoutscl,prsworkgoalsscl,prspushthroughscl,prscontworkscl,prsstayactivescl,prsfocuspositivescl,prsposattitudescl,prsnotaffecthappyscl,prsfindjoyscl,prshopefulscl,prsnotgetdownscl,prsnotupsetscl,prsavoidnegativescl,prsstayrelaxscl), nsets = n_var_miss(prs),order.by= \"degree\", point.size = 1, line.size = 0.25, \n    text.scale = c(0.5))\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-112-1.png){width=672}\n:::\n:::\n\n\n\n\n\nHandling missing data for total PRS score:\n\nMissing values can be imputed if the responses to 10 of 14 items are available (less than or equal to 29% missing data).\n\nSince the correlation between Behavioral Perseverance and Cognitive/Affective positivity is 0.76[@Slepian2016] average score of the completed items can be used to impute missing values.\n\n![](images/Screen%20Shot%202023-08-22%20at%2011.57.31%20AM%203-01.png)\n\nThe missing responses are first replaced with the average score of the completed items and then a total score is calculated by adding the scores for all the seven items\n\nWe will create a variable \"prs_diff\" and assign a value of 1 if there is a response to more than or equal to 10 of 14 PRS items and 0 if there is a response to less than 10 of 14 PRS items.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprs_fourteen <- c(\"prsbackoutscl\",\"prsworkgoalsscl\",\"prspushthroughscl\",\"prscontworkscl\",\"prsstayactivescl\",\"prsfocuspositivescl\",\"prsposattitudescl\",\"prsnotaffecthappyscl\",\"prsfindjoyscl\",\"prshopefulscl\",\"prsnotgetdownscl\",\"prsnotupsetscl\",\"prsavoidnegativescl\",\"prsstayrelaxscl\")\n\n\nprs <- prs %>% \n  mutate(prs_not_na = rowSums(!is.na(.[,prs_fourteen]))) %>% \n  mutate(prs_diff = case_when(prs_not_na >= 10 ~ 1\n                              ,TRUE~0)) %>% \n                             as_tibble() %>% \n  mutate(prs_diff = as.factor(prs_diff))\n```\n:::\n\n\n\n\n\nWe will now replace missing values with the rounded mean of remaining items if prs_diff = 1 and calculate a total score by taking a sum of all fourteen items, we will call this \"imputed_prs_score.\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprs <- prs %>% \n  mutate(raw_prs_score = rowSums(select(., all_of(prs_fourteen)), na.rm = TRUE)) %>% \n  mutate(mean_prs = case_when(prs_diff == 1 ~ round(rowMeans(select(., all_of(prs_fourteen)), na.rm = TRUE)))) %>% \n  mutate(across(all_of(prs_fourteen), ~if_else(is.na(.),mean_prs, .))) %>% \n  mutate(imputed_prs_score = case_when(prs_diff == 1  ~ rowSums(select(., all_of(prs_fourteen)), na.rm = TRUE)))\n```\n:::\n\n\n\n\n\nCheck missingness pattern after imputation\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngg_miss_upset(prs %>% \n                select(-ends_with(\"score\"),-mean_prs,prs_not_na,-prs_diff,-pain_resilience_scale_prs_complete), nsets = n_var_miss(prs),order.by= \"degree\", point.size = 1, line.size = 0.25, \n    text.scale = c(0.5))\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-115-1.png){width=672}\n:::\n:::\n\n\n\n\n\ncheck distributions of total PRS scores before (raw_prs_score) and after imputation (imputed_prs_score)\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n prs_plot <- prs %>% \n  filter(between(prs_not_na,10,14)) %>% \n  select(guid,raw_prs_score,imputed_prs_score) %>% \n  pivot_longer(cols =c(\"raw_prs_score\",\"imputed_prs_score\"), values_to = \"score\",names_to = \"score_name\") \n\n  ggplot(prs_plot, aes(x=score_name,y=score, fill=score_name)) +\n  geom_violin(alpha=.25)\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-116-1.png){width=672}\n:::\n:::\n\n\n\n\n\nRemove intermediate field names not needed\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprs <- prs %>% \n  select(-prs_not_na,-mean_prs,-raw_prs_score)\n```\n:::\n\n\n\n\n\n#### New field name(s)\n\nAdd the following field names to the data dictionary:\n\n\"prs_diff\",\"prs_cog_diff\",\"prs_bhv_diff\",\"imputed_bhv_score\",\"imputed_prs_cog_score\",\"imputed_prs_score\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create field names\nprs_diff_new_row <- data.frame(\n  field_name = \"prs_diff\",\n  form_name = \"pain_resilience_scale_prs\",\n  field_type = \"factor\",\n  select_choices_or_calculations = \"1,if there is a response to more than or equal to 10 of 14 PRS items | 0, if there is a response to less than 10 of 14 items\")\n\nprs_cog_diff_new_row <- data.frame(\n  field_name = \"prs_cog_diff\",\n  form_name = \"pain_resilience_scale_prs\",\n  field_type = \"factor\",\n  select_choices_or_calculations = \"1, if there is a response to more than or equal to 7 of 9 Cognitive/Affective positivity related items | 0, if there is a response to less than 7 of 9 items\")\n\nprs_bhv_diff_new_row <- data.frame(\n  field_name = \"prs_bhv_diff\",\n  form_name = \"pain_resilience_scale_prs\",\n  field_type = \"factor\",\n  select_choices_or_calculations = \"1,If there is a response to more than or equal to 4 of 5 behavioral perseverance related items| 0, if there is a response to less than 4 of 5 items\")\n\n\nprs_score_new_row <- data.frame(\n  field_name = \"imputed_prs_score\",\n  form_name = \"pain_resilience_scale_prs\",\n  field_type = \"numeric\",\n  field_label = \"sum of all  fourteen PRS items. Replacing missing values with the rounded mean of remaining items if prs_diff = 1\")\n\nprs_cog_score_new_row <- data.frame(\n  field_name = \"imputed_prs_cog_score\",\n  form_name = \"pain_resilience_scale_prs\",\n  field_type = \"numeric\",\n  field_label = \"sum of all  nine Cognitive/Affective positivity items. Replacing missing values with the rounded mean of remaining items if prs_cog_diff = 1\")\n\nprs_bhv_score_new_row <- data.frame(\n  field_name = \"imputed_bhv_score\",\n  form_name = \"pain_resilience_scale_prs\",\n  field_type = \"numeric\",\n  field_label = \"sum of five behavioral perseverance items. Replacing missing values with the rounded mean of remaining items if prs_bhv_diff = 1\")\n\n\n# adding rows\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!prs_diff_new_row, .after = match(\"prscognitivescore\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!prs_cog_diff_new_row, .after = match(\"prscognitivescore\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!prs_bhv_diff_new_row, .after = match(\"prscognitivescore\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!prs_score_new_row, .after = match(\"prscognitivescore\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!prs_cog_score_new_row, .after = match(\"prscognitivescore\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!prs_bhv_score_new_row, .after = match(\"prscognitivescore\", psy_soc_dict$field_name))\n```\n:::\n\n\n\n\n\n#### Save:\n\nSave \"prs\" and updated data dictionary as .csv files in the folder named \"reformatted_prs\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_csv(prs,file=here::here(\"data\",\"Psychosocial\",\"Reformatted\",\"reformatted_prs.csv\"))\nwrite_csv(psy_soc_dict,file=here::here(\"data\",\"Psychosocial\",\"Reformatted\",\"updated_psy_soc_dictionary.csv\"))\n```\n:::\n\n\n\n\n\n### Multidimensional Inventory of Subjective Cognitive Impairment v1.0 (MISCI)\n\nMultidimensional Inventory of Subjective Cognitive Impairment (MISCI) is used to evaluate cognitive function in Fibromyalgia patients. The MISCI comprises ten items based on a Likert scale ranging from 1-5. The initial six items evaluate perceived cognitive abilities and are positively phrased, while the remaining four items assess cognitive difficulties and are negatively phrased. Therefore, items 7-10 should be reverse-coded before being added to the responses of the other items to calculate the total score. The total score can range from 10-50, where higher scores indicate better perceived cognitive functioning [@kratz2015].\n\n#### Read in Data:\n\nRead in psy_soc1 dataframe and select field names from the MISCI form and keep completed forms, we will call \"misci\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmisci <- applyFilter(\"misci\",multidimensional_inventory_of_subjective_cognitive_complete)\n```\n:::\n\n\n\n\n\nWe will reverse code the last four items which assess cognitive difficulties. For example, cognitive difficulty related question such as \"trouble planning out steps of a task\" is rated on a scale of 1 to 5 where 1 is \"never\" and 5 is \"very often\". We will reverse code this to indicate 5 as \"never\" and 1 as \"very often\". The structure will look as follows:\n\n| Original | Reverse coded |\n|----------|---------------|\n| 1        | 5             |\n| 2        | 4             |\n| 3        | 3             |\n| 4        | 2             |\n| 5        | 1             |\n\nReverse code last 4 items: We can accomplish this by subtracting the original values from 6.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmisci <- misci %>% \n  mutate(miscishiftactivscl_reverse = 6-miscishiftactivscl) %>% \n  mutate(misciplanningscl_reverse = 6-misciplanningscl) %>% \n  mutate(misciexpressscl_reverse = 6-misciexpressscl) %>% \n  mutate(miscirightwordsscl_reverse = 6-miscirightwordsscl) \n```\n:::\n\n\n\n\n\n#### **Missing Data**\n\nMissing data pattern in \"misci\".\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmisci_ten <- c(\"miscithinkclrscl\",\"miscimindsharpscl\",\"miscirememberscl\",\"miscilearnscl\",\"misciconcentratescl\",\"misciattentionscl\",\"miscishiftactivscl_reverse\",\"misciplanningscl_reverse\",\"misciexpressscl_reverse\",\"miscirightwordsscl_reverse\") \n\ngg_miss_upset(misci %>% \n                select(all_of(misci_ten)), nsets = n_var_miss(misci),order.by= \"degree\", point.size = 1, line.size = 0.25, \n    text.scale = c(0.5))\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-122-1.png){width=672}\n:::\n:::\n\n\n\n\n\nMissing values can be imputed if the responses to 8 of 10 items are available (less than or equal to 29% missing data).\n\nWe will create a variable \"misci_diff\" and assign a value of 1 if there is a response to more than or equal to 8 of 10 items and 0 if there is a response to less than 8 of 10 items. The missing responses are first replaced with the average score of the completed items and then a total score is calculated by adding the scores for all the ten items.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmisci <- misci %>% \n  mutate(misci_not_na = rowSums(!is.na(.[,misci_ten]))) %>% \n  mutate(misci_diff = case_when(misci_not_na >= 8 ~ 1\n                              ,TRUE~0)) %>% \n                             as_tibble() %>% \n  mutate(misci_diff = as.factor(misci_diff))\n```\n:::\n\n\n\n\n\nWe will now replace missing values with the rounded mean of remaining items if misci_diff = 1 and calculate the total score by taking a sum of all ten items, we will call this \"imputed_misci_score.\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmisci <- misci %>% \n  mutate(raw_misci_score = rowSums(select(., all_of(misci_ten)), na.rm = TRUE)) %>%\n  mutate(mean_misci = case_when(misci_diff == 1 ~ round(rowMeans(select(., all_of(misci_ten)), na.rm = TRUE)))) %>% \n  mutate(across(all_of(misci_ten), ~if_else(is.na(.),mean_misci, .))) %>% \n  mutate(imputed_misci_score = case_when(misci_diff == 1  ~ rowSums(select(., all_of(misci_ten)), na.rm = TRUE))) \n```\n:::\n\n\n\n\n\nCheck missingness pattern after imputation\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngg_miss_upset(misci %>% \n                select(all_of(misci_ten)), nsets = n_var_miss(misci),order.by= \"degree\", point.size = 1, line.size = 0.25, \n    text.scale = c(0.5))\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-125-1.png){width=672}\n:::\n:::\n\n\n\n\n\ncheck distributions of misci total scores before (raw_misci_score) and after imputation (imputed_misci_score)\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n misci_plot <- misci %>% \n  filter(misci_diff==1) %>% \n  select(guid,raw_misci_score,imputed_misci_score) %>% \n  pivot_longer(cols =c(\"raw_misci_score\",\"imputed_misci_score\"), values_to = \"score\",names_to = \"score_name\") \n\n  ggplot( misci_plot, aes(x=score_name,y=score, fill=score_name)) +\n  geom_violin(alpha=.25)\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-126-1.png){width=672}\n:::\n:::\n\n\n\n\n\nRemove intermediate field names not needed\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmisci <- misci %>% \n  select(-misci_not_na,-mean_misci,-raw_misci_score)\n```\n:::\n\n\n\n\n\n#### New field name(s)\n\nAdd the following field names to the data dictionary:\n\n\"misci_diff\", \"imputed_misci_score\", \"miscishiftactivscl_reverse\", \"misciplanningscl_reverse\", \"misciexpressscl_reverse\" and \"miscirightwordsscl_reverse\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create field names\n\nmisci_diff_new_row <- data.frame(\n  field_name = \"misci_diff\",\n  form_name = \"multidimensional_inventory_of_subjective_cognitive\",\n  field_type = \"factor\",\n  select_choices_or_calculations = \"1, if there is a response to more than or equal to 8 of 10 MISCI items | 0, if there is a response to less than 8 of 10 items\")\n\n\nmisci_score_new_row <- data.frame(\n  field_name = \"imputed_misci_score\",\n  form_name = \"multidimensional_inventory_of_subjective_cognitive\",\n  field_type = \"numeric\",\n  field_label = \"sum of all ten misci items. Replacing missing values with the rounded mean of remaining items if misci_diff = 1\")\n\nmiscishiftactivscl_reverse_new_row <- data.frame(\n  field_name = \"miscishiftactivscl_reverse\",\n  form_name = \"multidimensional_inventory_of_subjective_cognitive\",\n  field_type = \"numeric\",\n  field_label = \"reverse coded miscishiftactivscl\")\n\nmisciplanningscl_reverse_new_row <- data.frame(\n  field_name = \"misciplanningscl_reverse\",\n  form_name = \"multidimensional_inventory_of_subjective_cognitive\",\n  field_type = \"numeric\",\n  field_label = \"reverse coded misciplanningscl\")\n\nmisciexpressscl_reverse_new_row <- data.frame(\n  field_name = \"misciexpressscl_reverse\",\n  form_name = \"multidimensional_inventory_of_subjective_cognitive\",\n  field_type = \"numeric\",\n  field_label = \"reverse coded misciexpressscl\")\n\nmiscirightwordsscl_reverse_new_row <- data.frame(\n  field_name = \"miscirightwordsscl_reverse\",\n  form_name = \"multidimensional_inventory_of_subjective_cognitive\",\n  field_type = \"numeric\",\n  field_label = \"reverse coded miscirightwordsscl\")\n\n\n# adding rows\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!misci_diff_new_row, .after = match(\"miscitotalscore\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!misci_score_new_row, .after = match(\"miscitotalscore\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!miscishiftactivscl_reverse_new_row, .after = match(\"miscitotalscore\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!misciplanningscl_reverse_new_row, .after = match(\"miscitotalscore\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>%  \n  add_row(!!!misciexpressscl_reverse_new_row, .after = match(\"miscitotalscore\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!miscirightwordsscl_reverse_new_row, .after = match(\"miscitotalscore\", psy_soc_dict$field_name))\n```\n:::\n\n\n\n\n\n#### Save:\n\nSave \"misci\" and updated data dictionary as .csv files in the folder named \"reformatted_misci\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_csv(misci,here(\"data\",\"Psychosocial\",\"Reformatted\",\"reformatted_misci.csv\"))\nwrite_csv(psy_soc_dict,file=here::here(\"data\",\"Psychosocial\",\"Reformatted\",\"updated_psy_soc_dictionary.csv\"))\n```\n:::\n\n\n\n\n\n### The Big Five Inventory (BFI-2-S)\n\nThe BFI-2-S is is used to evaluate five personality domains and 15 specific facet traits within the five domains. Altogether, the BFI-2-S comprises thirty items based on a Likert scale ranging from 1-5, where 1 is \"disagree strongly\" and 5 is \"agree strongly\". Some items are negatively phrased and should be reverse coded for scoring [@soto2017].\n\nFollowing table shows the five domains and the specific facet traits:\n\n+-------------------------------------------+------------------------------------------+\n| Domains (bold) and domain specific facets | Items (R: Items should be reverse coded) |\n+===========================================+==========================================+\n| **Extraversion**                          |                                          |\n+-------------------------------------------+------------------------------------------+\n| Sociability                               | 1R, 16                                   |\n+-------------------------------------------+------------------------------------------+\n| Assertiveness                             | 6, 21R                                   |\n+-------------------------------------------+------------------------------------------+\n| Energy Level                              | 11, 26R                                  |\n+-------------------------------------------+------------------------------------------+\n| **Agreeableness**                         |                                          |\n+-------------------------------------------+------------------------------------------+\n| Compassion                                | 2, 17R                                   |\n+-------------------------------------------+------------------------------------------+\n| Respectfulness                            | 7R, 22                                   |\n+-------------------------------------------+------------------------------------------+\n| Trust                                     | 12, 27R                                  |\n+-------------------------------------------+------------------------------------------+\n| **Conscientiousness**                     |                                          |\n+-------------------------------------------+------------------------------------------+\n| Organization                              | 3R, 18                                   |\n+-------------------------------------------+------------------------------------------+\n| Productiveness                            | 8R, 23                                   |\n+-------------------------------------------+------------------------------------------+\n| Responsibility                            | 13, 28R                                  |\n+-------------------------------------------+------------------------------------------+\n| **Negative Emotionality**                 |                                          |\n+-------------------------------------------+------------------------------------------+\n| Anxiety                                   | 4, 19R                                   |\n+-------------------------------------------+------------------------------------------+\n| Depression                                | 9, 24R                                   |\n+-------------------------------------------+------------------------------------------+\n| Emotional Volatility                      | 14R, 29                                  |\n+-------------------------------------------+------------------------------------------+\n| **Open-Mindedness**                       |                                          |\n+-------------------------------------------+------------------------------------------+\n| Aesthetic Sensitivity                     | 5, 20R                                   |\n+-------------------------------------------+------------------------------------------+\n| Intellectual Curiosity                    | 10R, 25                                  |\n+-------------------------------------------+------------------------------------------+\n| Creative Imagination                      | 15, 30R                                  |\n+-------------------------------------------+------------------------------------------+\n\n#### Read in Data:\n\nRead in psy_soc1 dataframe and select field names from the BFI-2-S form and keep completed forms, we will call this \"bfi\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbfi <- applyFilter(\"bfi\",the_big_five_inventory_bfi2s_complete)\n```\n:::\n\n\n\n\n\nWe will reverse code the items denoted by \"R\" in the table. For example, Sociability related question such as \"Tends to be quiet\" is rated on a scale of 1 to 5 where 1 is \"Disagree strongly\" and 5 is \"Agree strongly\". We will reverse code this to indicate 5 as \"Disagree strongly\" and 1 as \"Agree strongly\". The structure will look as follows:\n\n| Original | Reverse coded |\n|----------|---------------|\n| 1        | 5             |\n| 2        | 4             |\n| 3        | 3             |\n| 4        | 2             |\n| 5        | 1             |\n\nReverse code the items denoted by \"R\": We can accomplish this by subtracting the original values from 6.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n bfi <- bfi %>%\n  mutate(\n    across(\n      .cols = c(\n        bfi2squietscl,\n        bfi2stakechargescl,\n        bfi2slessactivescl,\n        bfi2suncaringscl,\n        bfi2srudescl,\n        bfi2sfaultwithothersscl,\n        bfi2sdisorganizedscl,\n        bfi2sdifficultstartscl,\n        bfi2scarelessscl,\n        bfi2srelaxedscl,\n        bfi2ssecurescl,\n        bfi2sstableemotionscl,\n        bfi2sfewartinterestscl,\n        bfi2sllittleinterestscl,\n        bfi2slittlecreativityscl\n      ),\n      .fns = \\(x) 6 - x,\n      .names = \"{.col}_reverse\"\n  ))\n\n# credit: P.Sadil  \n```\n:::\n\n\n\n\n\n#### Extraversion\n\n##### **Missing Data**\n\nMissing data pattern in Extraversion domain specific items.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nextra_vector <- c(\"bfi2squietscl_reverse\",\"bfi2soutgoingscl\",\"bfi2sdominantscl\",\"bfi2stakechargescl_reverse\",\"bfi2senergyscl\",\"bfi2slessactivescl_reverse\") \n\ngg_miss_upset(bfi %>% \n                select(all_of(extra_vector)), nsets = n_var_miss(bfi),order.by= \"degree\", point.size = 1, line.size = 0.25, \n    text.scale = c(0.5))\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-132-1.png){width=672}\n:::\n:::\n\n\n\n\n\nScale score is calculated by taking the mean of the domain specific items. We will calculate raw scale score (without imputed items)\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbfi <- bfi %>% \n  mutate(raw_extraversion_score = round(rowMeans(select(., all_of(extra_vector)), na.rm = TRUE)))\n```\n:::\n\n\n\n\n\nFor missing items, response to the closest item can be used. For instance if \"Tends to be quiet\" is missing, the value from \"Is outgoing, sociable\" can be used to replace the missing value or vice versa [Berkeley personality lab](https://www.ocf.berkeley.edu/~johnlab/bfi.htm).\n\nReplace missing items with the closest matching item.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbfi <- bfi %>% \n  mutate(bfi2squietscl_reverse = ifelse(is.na(bfi2squietscl_reverse),bfi2soutgoingscl, bfi2squietscl_reverse),\n    bfi2soutgoingscl = ifelse(is.na(bfi2soutgoingscl),bfi2squietscl_reverse,bfi2soutgoingscl)) %>% \nmutate(bfi2sdominantscl = ifelse(is.na(bfi2sdominantscl),bfi2stakechargescl_reverse, bfi2sdominantscl),\n    bfi2stakechargescl_reverse = ifelse(is.na(bfi2stakechargescl_reverse),bfi2sdominantscl,bfi2stakechargescl_reverse))%>% \nmutate(bfi2senergyscl = ifelse(is.na(bfi2senergyscl),bfi2slessactivescl_reverse, bfi2senergyscl),\n    bfi2slessactivescl_reverse = ifelse(is.na(bfi2slessactivescl_reverse),bfi2senergyscl,bfi2slessactivescl_reverse))\n```\n:::\n\n\n\n\n\nCheck missingness pattern after imputation\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngg_miss_upset(bfi %>% \n                select(all_of(extra_vector)), nsets = n_var_miss(bfi),order.by= \"degree\", point.size = 1, line.size = 0.25, \n    text.scale = c(0.5))\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-135-1.png){width=672}\n:::\n:::\n\n\n\n\n\nWe will now calculate the imputed scale score\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbfi <- bfi %>% \n  mutate(imputed_extraversion_score = round(rowMeans(select(., all_of(extra_vector)), na.rm = TRUE)))\n```\n:::\n\n\n\n\n\ncheck distributions of extraversion scores before (raw_extraversion_score) and after imputation (imputed_extraversion_score)\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbfi_ext_plot <- bfi %>% \n  select(guid,raw_extraversion_score,imputed_extraversion_score) %>% \n  pivot_longer(cols =c(\"raw_extraversion_score\",\"imputed_extraversion_score\"), values_to = \"score\",names_to = \"score_name\") %>% \n   mutate(score_name= as.factor(score_name)) %>% \n   mutate(score= as.factor(score)) %>% \n   group_by(score_name,score) %>% \n  count() %>% \n  ungroup %>% \n  rename(score_count = n)\n\nggplot(bfi_ext_plot, aes(x =score, y= score_count,fill=score_name)) + \n    geom_bar(position=\"dodge\", stat=\"identity\") +\n    theme(axis.text.x = element_text(angle = 70, vjust = 0.5, hjust=1))   \n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-137-1.png){width=672}\n:::\n:::\n\n\n\n\n\nRemove intermediate field names not needed\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbfi <- bfi %>% \n  select(-raw_extraversion_score)\n```\n:::\n\n\n\n\n\n#### **Agreeableness**\n\n##### **Missing Data**\n\nMissing data pattern in agreeableness domain specific items.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nagree_vector <- c(\"bfi2scompassionatescl\",\"bfi2suncaringscl_reverse\",\"bfi2srudescl_reverse\",\"bfi2srespectfulscl\",\"bfi2sassumingbestscl\",\"bfi2sfaultwithothersscl_reverse\") \n\ngg_miss_upset(bfi %>% \n                select(all_of(agree_vector)), nsets = n_var_miss(bfi),order.by= \"degree\", point.size = 1, line.size = 0.25, \n    text.scale = c(0.5))\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-139-1.png){width=672}\n:::\n:::\n\n\n\n\n\nScale score is calculated by taking the mean of the domain specific items. We will calculate raw scale score (without imputed items)\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbfi <- bfi %>% \n  mutate(raw_agreeableness_score = round(rowMeans(select(., all_of(agree_vector)), na.rm = TRUE)))\n```\n:::\n\n\n\n\n\nFor missing items, response to the closest item can be used [Berkeley personality lab](https://www.ocf.berkeley.edu/~johnlab/bfi.htm).\n\nReplace missing items with the closest matching item.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbfi <- bfi %>% \n  mutate(bfi2scompassionatescl = ifelse(is.na(bfi2scompassionatescl),bfi2suncaringscl_reverse, bfi2scompassionatescl),\n    bfi2suncaringscl_reverse = ifelse(is.na(bfi2suncaringscl_reverse),bfi2scompassionatescl,bfi2suncaringscl_reverse)) %>%\nmutate(bfi2srudescl_reverse = ifelse(is.na(bfi2srudescl_reverse),bfi2srespectfulscl, bfi2srudescl_reverse),\n    bfi2srespectfulscl = ifelse(is.na(bfi2srespectfulscl),bfi2srudescl_reverse,bfi2srespectfulscl))%>%\nmutate(bfi2sassumingbestscl = ifelse(is.na(bfi2sassumingbestscl),bfi2sfaultwithothersscl_reverse, bfi2sassumingbestscl),\n    bfi2sfaultwithothersscl_reverse = ifelse(is.na(bfi2sfaultwithothersscl_reverse),bfi2sassumingbestscl,bfi2sfaultwithothersscl_reverse))\n```\n:::\n\n\n\n\n\nCheck missingness pattern after imputation\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngg_miss_upset(bfi %>% \n                select(all_of(agree_vector)), nsets = n_var_miss(bfi),order.by= \"degree\", point.size = 1, line.size = 0.25, \n    text.scale = c(0.5))\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-142-1.png){width=672}\n:::\n:::\n\n\n\n\n\nWe will now calculate the imputed scale score\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbfi <- bfi %>% \n  mutate(imputed_agreeableness_score = round(rowMeans(select(., all_of(agree_vector)), na.rm = TRUE)))\n```\n:::\n\n\n\n\n\ncheck distributions of agreeableness scores before (raw_agreeableness_score) and after imputation (imputed_agreeableness_score)\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n bfi_agree_plot <- bfi %>% \n  select(guid,raw_agreeableness_score,imputed_agreeableness_score) %>% \n  pivot_longer(cols =c(\"raw_agreeableness_score\",\"imputed_agreeableness_score\"), values_to = \"score\",names_to = \"score_name\") %>% \n   mutate(score_name= as.factor(score_name)) %>% \n   mutate(score= as.factor(score)) %>% \n   group_by(score_name,score) %>% \n  count() %>% \n  ungroup %>% \n  rename(score_count = n)\n\nggplot(bfi_agree_plot, aes(x =score, y= score_count,fill=score_name)) + \n    geom_bar(position=\"dodge\", stat=\"identity\") +\n    theme(axis.text.x = element_text(angle = 70, vjust = 0.5, hjust=1))   \n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-144-1.png){width=672}\n:::\n:::\n\n\n\n\n\nRemove intermediate field names not needed\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbfi <- bfi %>% \n  select(-raw_agreeableness_score)\n```\n:::\n\n\n\n\n\n#### **Conscientiousness**\n\n##### **Missing Data**\n\nMissing data pattern in conscientiousness domain specific items.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncons_vector <- c(\"bfi2sdisorganizedscl_reverse\",\"bfi2stidyscl\",\"bfi2sdifficultstartscl_reverse\",\"bfi2spersistentscl\",\"bfi2sreliablescl\",\"bfi2scarelessscl_reverse\") \n\ngg_miss_upset(bfi %>% \n                select(all_of(cons_vector)), nsets = n_var_miss(bfi),order.by= \"degree\", point.size = 1, line.size = 0.25, \n    text.scale = c(0.5))\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-146-1.png){width=672}\n:::\n:::\n\n\n\n\n\nScale score is calculated by taking the mean of the domain specific items. We will calculate raw scale score (without imputed items)\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbfi <- bfi %>% \n  mutate(raw_cons_score = round(rowMeans(select(., all_of(cons_vector)), na.rm = TRUE)))\n```\n:::\n\n\n\n\n\nFor missing items response to the closest item can be used.[Berkeley personality lab](https://www.ocf.berkeley.edu/~johnlab/bfi.htm).\n\nReplace missing items with the closest matching item.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbfi <- bfi %>% \n  mutate(bfi2sdisorganizedscl_reverse = ifelse(is.na(bfi2sdisorganizedscl_reverse),bfi2stidyscl,bfi2sdisorganizedscl_reverse),\nbfi2stidyscl = ifelse(is.na(bfi2stidyscl),bfi2sdisorganizedscl_reverse,bfi2stidyscl)) %>% \n  mutate(bfi2sdifficultstartscl_reverse = ifelse(is.na(bfi2sdifficultstartscl_reverse),bfi2spersistentscl, bfi2sdifficultstartscl_reverse),\nbfi2spersistentscl = ifelse(is.na(bfi2spersistentscl),bfi2sdifficultstartscl_reverse,bfi2spersistentscl))%>% \n  mutate(bfi2sreliablescl = ifelse(is.na(bfi2sreliablescl),bfi2scarelessscl_reverse, bfi2sreliablescl),\nbfi2scarelessscl_reverse = ifelse(is.na(bfi2scarelessscl_reverse),bfi2sreliablescl,bfi2scarelessscl_reverse))\n```\n:::\n\n\n\n\n\nCheck missingness pattern after imputation\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngg_miss_upset(bfi %>% \n                select(all_of(cons_vector)), nsets = n_var_miss(bfi),order.by= \"degree\", point.size = 1, line.size = 0.25, \n    text.scale = c(0.5))\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-149-1.png){width=672}\n:::\n:::\n\n\n\n\n\nWe will now calculate the imputed scale score\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbfi <- bfi %>% \n  mutate(imputed_cons_score = round(rowMeans(select(., all_of(cons_vector)), na.rm = TRUE)))\n```\n:::\n\n\n\n\n\nCheck distributions of conscientiousness scores before (raw_cons_score) and after imputation (imputed_cons_score)\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n bfi_cons_plot <- bfi %>% \n  select(guid,raw_cons_score,imputed_cons_score) %>% \n  pivot_longer(cols =c(\"raw_cons_score\",\"imputed_cons_score\"), values_to = \"score\",names_to = \"score_name\") %>% \n   mutate(score_name= as.factor(score_name)) %>% \n   mutate(score= as.factor(score)) %>% \n   group_by(score_name,score) %>% \n  count() %>% \n  ungroup %>% \n  rename(score_count = n)\n\nggplot(bfi_cons_plot, aes(x =score, y= score_count,fill=score_name)) + \n    geom_bar(position=\"dodge\", stat=\"identity\") +\n    theme(axis.text.x = element_text(angle = 70, vjust = 0.5, hjust=1))   \n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-151-1.png){width=672}\n:::\n:::\n\n\n\n\n\nRemove intermediate field names not needed\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbfi <- bfi %>% \n  select(-raw_cons_score)\n```\n:::\n\n\n\n\n\n#### **Negative Emotionality**\n\n##### **Missing Data**\n\nMissing data pattern in negative emotionality domain specific items.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nemotion_vector <- c(\"bfi2sworriesscl\",\"bfi2srelaxedscl_reverse\",\"bfi2sdepressedscl\",\"bfi2ssecurescl_reverse\",\"bfi2stemperamentalscl\",\"bfi2sstableemotionscl_reverse\")\n\ngg_miss_upset(bfi %>% \n                select(all_of(emotion_vector)), nsets = n_var_miss(bfi),order.by= \"degree\", point.size = 1, line.size = 0.25, \n    text.scale = c(0.5))\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-153-1.png){width=672}\n:::\n:::\n\n\n\n\n\nScale score is calculated by taking the mean of the domain specific items. We will calculate raw scale score (without imputed items)\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbfi <- bfi %>% \n  mutate(raw_emotional_score = round(rowMeans(select(., all_of(emotion_vector)), na.rm = TRUE)))\n```\n:::\n\n\n\n\n\nFor missing items response to the closest item can be used [Berkeley personality lab](https://www.ocf.berkeley.edu/~johnlab/bfi.htm).\n\nReplace missing items with the closest matching item.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbfi <- bfi %>% \n  mutate(bfi2sworriesscl = ifelse(is.na(bfi2sworriesscl),bfi2srelaxedscl_reverse, bfi2sworriesscl),\n    bfi2srelaxedscl_reverse = ifelse(is.na(bfi2srelaxedscl_reverse),bfi2sworriesscl,bfi2srelaxedscl_reverse))%>% \nmutate(bfi2sdepressedscl = ifelse(is.na(bfi2sdepressedscl),bfi2ssecurescl_reverse, bfi2sdepressedscl),\n    bfi2ssecurescl_reverse = ifelse(is.na(bfi2ssecurescl_reverse),bfi2sdepressedscl,bfi2ssecurescl_reverse))%>% \nmutate(bfi2stemperamentalscl = ifelse(is.na(bfi2stemperamentalscl),bfi2sstableemotionscl_reverse, bfi2stemperamentalscl),\n bfi2sstableemotionscl_reverse = ifelse(is.na(bfi2sstableemotionscl_reverse),bfi2stemperamentalscl,bfi2sstableemotionscl_reverse))\n```\n:::\n\n\n\n\n\nCheck missingness pattern after imputation\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngg_miss_upset(bfi %>% \n                select(all_of(emotion_vector)), nsets = n_var_miss(bfi),order.by= \"degree\", point.size = 1, line.size = 0.25, \n    text.scale = c(0.5))\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-156-1.png){width=672}\n:::\n:::\n\n\n\n\n\nWe will now calculate the imputed scale score\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbfi <- bfi %>% \n  mutate(imputed_emotional_score = round(rowMeans(select(., all_of(emotion_vector)), na.rm = TRUE)))\n```\n:::\n\n\n\n\n\nCheck distributions negative emotionality scores before (raw_emotional_score) and after imputation (imputed_emotional_score).\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n bfi_emo_plot <- bfi %>% \n  select(guid,raw_emotional_score,imputed_emotional_score) %>% \n  pivot_longer(cols =c(\"raw_emotional_score\",\"imputed_emotional_score\"), values_to = \"score\",names_to = \"score_name\") %>% \n   mutate(score_name= as.factor(score_name)) %>% \n   mutate(score= as.factor(score)) %>% \n   group_by(score_name,score) %>% \n  count() %>% \n  ungroup %>% \n  rename(score_count = n)\n\nggplot(bfi_emo_plot, aes(x =score, y= score_count,fill=score_name)) + \n    geom_bar(position=\"dodge\", stat=\"identity\") +\n    theme(axis.text.x = element_text(angle = 70, vjust = 0.5, hjust=1))   \n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-158-1.png){width=672}\n:::\n:::\n\n\n\n\n\nRemove intermediate field names not needed\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbfi <- bfi %>% \n  select(-raw_emotional_score)\n```\n:::\n\n\n\n\n\n#### **Open-Mindedness**\n\n##### **Missing Data**\n\nMissing data pattern in open-mindedness domain specific items.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nopen_vector <- c(\"bfi2sfascinatedscl\",\"bfi2sfewartinterestscl_reverse\",\n                \"bfi2sllittleinterestscl_reverse\",\"bfi2sthinkerscl\",\"bfi2soriginalscl\",\"bfi2slittlecreativityscl_reverse\")\n\ngg_miss_upset(bfi %>% \n                select(all_of(open_vector)), nsets = n_var_miss(bfi),order.by= \"degree\", point.size = 1, line.size = 0.25, \n    text.scale = c(0.5))\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-160-1.png){width=672}\n:::\n:::\n\n\n\n\n\nScale score is calculated by taking the mean of the domain specific items. We will calculate raw scale score (without imputed items)\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbfi <- bfi %>% \n  mutate(raw_open_score = round(rowMeans(select(., all_of(open_vector)), na.rm = TRUE)))\n```\n:::\n\n\n\n\n\nFor missing items response to the closest item can be used.[Berkeley personality lab](https://www.ocf.berkeley.edu/~johnlab/bfi.htm).\n\nReplace missing items with the closest matching item.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbfi <- bfi %>% \n  mutate(bfi2sfascinatedscl = ifelse(is.na(bfi2sfascinatedscl),bfi2sfewartinterestscl_reverse,bfi2sfascinatedscl),\n  bfi2sfewartinterestscl_reverse = ifelse(is.na(bfi2sfewartinterestscl_reverse),bfi2sfascinatedscl,bfi2sfewartinterestscl_reverse)) %>% \nmutate(bfi2sllittleinterestscl_reverse = ifelse(is.na(bfi2sllittleinterestscl_reverse),bfi2sthinkerscl, bfi2sllittleinterestscl_reverse),\nbfi2sthinkerscl = ifelse(is.na(bfi2sthinkerscl),bfi2sllittleinterestscl_reverse,bfi2sthinkerscl))%>% \nmutate(bfi2soriginalscl = ifelse(is.na(bfi2soriginalscl),bfi2slittlecreativityscl_reverse,bfi2soriginalscl),\nbfi2slittlecreativityscl_reverse = ifelse(is.na(bfi2slittlecreativityscl_reverse),bfi2soriginalscl,bfi2slittlecreativityscl_reverse))\n```\n:::\n\n\n\n\n\nCheck missingness pattern after imputation\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngg_miss_upset(bfi %>% \n                select(all_of(open_vector)), nsets = n_var_miss(bfi),order.by= \"degree\", point.size = 1, line.size = 0.25, \n    text.scale = c(0.5))\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-163-1.png){width=672}\n:::\n:::\n\n\n\n\n\nWe will now calculate the imputed scale score\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbfi <- bfi %>% \n  mutate(imputed_open_score = round(rowMeans(select(., all_of(open_vector)), na.rm = TRUE)))\n```\n:::\n\n\n\n\n\nCheck distributions of open-mindedness scores before (raw_open_score) and after imputation (imputed_open_score)\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n bfi_open_plot <- bfi %>% \n  select(guid,raw_open_score,imputed_open_score) %>% \n  pivot_longer(cols =c(\"raw_open_score\",\"imputed_open_score\"), values_to = \"score\",names_to = \"score_name\") %>% \n   mutate(score_name= as.factor(score_name)) %>% \n   mutate(score= as.factor(score)) %>% \n   group_by(score_name,score) %>% \n  count() %>% \n  ungroup %>% \n  rename(score_count = n)\n\nggplot(bfi_open_plot, aes(x =score, y= score_count,fill=score_name)) + \n    geom_bar(position=\"dodge\", stat=\"identity\") +\n    theme(axis.text.x = element_text(angle = 70, vjust = 0.5, hjust=1))   \n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-165-1.png){width=672}\n:::\n:::\n\n\n\n\n\nRemove intermediate field names not needed\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbfi <- bfi %>% \n  select(-raw_open_score)\n```\n:::\n\n\n\n\n\n#### New field name(s)\n\nAdd the following field names to the data dictionary:\n\n\"imputed_extraversion_score\", \"imputed_agreeableness_score\", \"imputed_cons_score\", \"imputed_emotional_score\", \"imputed_open_score\", \"bfi2squietscl_reverse\", \"bfi2stakechargescl_reverse\", \"bfi2slessactivescl_reverse\", \"bfi2suncaringscl_reverse\", \"bfi2srudescl_reverse\", \"bfi2sfaultwithothersscl_reverse\", \"bfi2sdisorganizedscl_reverse\", \"bfi2sdifficultstartscl_reverse\", \"bfi2scarelessscl_reverse\", \"bfi2srelaxedscl_reverse\", \"bfi2ssecurescl_reverse\", \"bfi2sstableemotionscl_reverse\", \"bfi2sfewartinterestscl_reverse\", \"bfi2sllittleinterestscl_reverse\", and \"bfi2slittlecreativityscl_reverse\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create field names\n\nextra_score_new_row <- data.frame(\n  field_name = \"imputed_extraversion_score\",\n  form_name = \"the_big_five_inventory_bfi2s\",\n  field_type = \"numeric\",\n  field_label = \"Mean of Extraversion domain items. Replacing missing values with the value of the closest matching item (similar meaning)\")\n\n\nagree_score_new_row <- data.frame(\n  field_name = \"imputed_agreeableness_score\",\n  form_name = \"the_big_five_inventory_bfi2s\",\n  field_type = \"numeric\",\n  field_label = \"Mean of Agreeableness domain items. Replacing missing values with the value of the closest matching item (similar meaning)\")\n\ncons_score_new_row <- data.frame(\n  field_name = \"imputed_cons_score\",\n  form_name = \"the_big_five_inventory_bfi2s\",\n  field_type = \"numeric\",\n  field_label = \"Mean of conscientiousness domain items. Replacing missing values with the value of the closest matching item (similar meaning)\")\n\n\nemo_score_new_row <- data.frame(\n  field_name = \"imputed_emotional_score\",\n  form_name = \"the_big_five_inventory_bfi2s\",\n  field_type = \"numeric\",\n  field_label = \"Mean of negative emotionality domain items. Replacing missing values with the value of the closest matching item (similar meaning)\")\n\n\nopen_score_new_row <- data.frame(\n  field_name = \"imputed_open_score\",\n  form_name = \"the_big_five_inventory_bfi2s\",\n  field_type = \"numeric\",\n  field_label = \"Mean of open-mindedness domain items. Replacing missing values with the value of the closest matching item (similar meaning)\")\n\n\nbfi2squietscl_new_row <- data.frame(\n  field_name = \"bfi2squietscl_reverse\",\n  form_name = \"the_big_five_inventory_bfi2s\",\n  field_type = \"numeric\",\n  field_label = \"reverse coded bfi2squietscl\")\n\n\nbfi2stakechargescl_new_row <- data.frame(\n  field_name = \"bfi2stakechargescl_reverse\",\n  form_name = \"the_big_five_inventory_bfi2s\",\n  field_type = \"numeric\",\n  field_label = \"reverse coded bfi2stakechargescl\")\n\n\nbfi2slessactivescl_new_row <- data.frame(\n  field_name = \"bfi2slessactivescl_reverse\",\n  form_name = \"the_big_five_inventory_bfi2s\",\n  field_type = \"numeric\",\n  field_label = \"reverse coded bfi2slessactivescl\")\n\n\nbfi2suncaringscl_new_row <- data.frame(\n  field_name = \"bfi2suncaringscl_reverse\",\n  form_name = \"the_big_five_inventory_bfi2s\",\n  field_type = \"numeric\",\n  field_label = \"reverse coded bfi2suncaringscl\")\n\nbfi2srudescl_new_row <- data.frame(\n  field_name = \"bfi2srudescl_reverse\",\n  form_name = \"the_big_five_inventory_bfi2s\",\n  field_type = \"numeric\",\n  field_label = \"reverse coded bfi2srudescl\")\n\n\nbfi2sfaultwithothersscl_new_row <- data.frame(\n  field_name = \"bfi2sfaultwithothersscl_reverse\",\n  form_name = \"the_big_five_inventory_bfi2s\",\n  field_type = \"numeric\",\n  field_label = \"reverse coded bfi2sfaultwithothersscl\")\n\n\nbfi2sdisorganizedscl_new_row <- data.frame(\n  field_name = \"bfi2sdisorganizedscl_reverse\",\n  form_name = \"the_big_five_inventory_bfi2s\",\n  field_type = \"numeric\",\n  field_label = \"reverse coded bfi2sdisorganizedscl\")\n\nbfi2sdifficultstartscl_new_row <- data.frame(\n  field_name = \"bfi2sdifficultstartscl_reverse\",\n  form_name = \"the_big_five_inventory_bfi2s\",\n  field_type = \"numeric\",\n  field_label = \"reverse coded bfi2sdifficultstartscl\")\n\n\nbfi2scarelessscl_new_row <- data.frame(\n  field_name = \"bfi2scarelessscl_reverse\",\n  form_name = \"the_big_five_inventory_bfi2s\",\n  field_type = \"numeric\",\n  field_label = \"reverse coded bfi2scarelessscl\")\n\n\nbfi2srelaxedscl_new_row <- data.frame(\n  field_name = \"bfi2srelaxedscl_reverse\",\n  form_name = \"the_big_five_inventory_bfi2s\",\n  field_type = \"numeric\",\n  field_label = \"reverse coded bfi2srelaxedscl\")\n\n\nbfi2ssecurescl_new_row <- data.frame(\n  field_name = \"bfi2ssecurescl_reverse\",\n  form_name = \"the_big_five_inventory_bfi2s\",\n  field_type = \"numeric\",\n  field_label = \"reverse coded bfi2ssecurescl\")\n\n\nbfi2sstableemotionscl_new_row <- data.frame(\n  field_name = \"bfi2sstableemotionscl_reverse\",\n  form_name = \"the_big_five_inventory_bfi2s\",\n  field_type = \"numeric\",\n  field_label = \"reverse coded bfi2sstableemotionscl\")\n\n\nbfi2sfewartinterestscl_reverse_new_row <- data.frame(\n  field_name = \"bfi2sfewartinterestscl_reverse\",\n  form_name = \"the_big_five_inventory_bfi2s\",\n  field_type = \"numeric\",\n  field_label = \"reverse coded bfi2sfewartinterestscl\")\n\nbfi2sllittleinterestscl_reverse_new_row <- data.frame(\n  field_name = \"bfi2sllittleinterestscl_reverse\",\n  form_name = \"the_big_five_inventory_bfi2s\",\n  field_type = \"numeric\",\n  field_label = \"reverse coded bfi2sllittleinterestscl\")\n\nbfi2slittlecreativityscl_reverse_new_row <- data.frame(\n  field_name = \"bfi2slittlecreativityscl_reverse\",\n  form_name = \"the_big_five_inventory_bfi2s\",\n  field_type = \"numeric\",\n  field_label = \"reverse coded bfi2slittlecreativityscl\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# adding rows\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!extra_score_new_row, .after = match(\"bfi2slittlecreativityscl\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!agree_score_new_row, .after = match(\"bfi2slittlecreativityscl\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!cons_score_new_row, .after = match(\"bfi2slittlecreativityscl\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!emo_score_new_row, .after = match(\"bfi2slittlecreativityscl\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>%  \n  add_row(!!!open_score_new_row, .after = match(\"bfi2slittlecreativityscl\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!bfi2squietscl_new_row, .after = match(\"bfi2slittlecreativityscl\", psy_soc_dict$field_name))\n\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!bfi2stakechargescl_new_row, .after = match(\"bfi2slittlecreativityscl\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!bfi2slessactivescl_new_row, .after = match(\"bfi2slittlecreativityscl\", psy_soc_dict$field_name))\n\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!bfi2suncaringscl_new_row, .after = match(\"bfi2slittlecreativityscl\", psy_soc_dict$field_name))\n\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!bfi2srudescl_new_row, .after = match(\"bfi2slittlecreativityscl\", psy_soc_dict$field_name))\n\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!bfi2sfaultwithothersscl_new_row, .after = match(\"bfi2slittlecreativityscl\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!bfi2sdisorganizedscl_new_row, .after = match(\"bfi2slittlecreativityscl\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!bfi2sdifficultstartscl_new_row, .after = match(\"bfi2slittlecreativityscl\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!bfi2scarelessscl_new_row, .after = match(\"bfi2slittlecreativityscl\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!bfi2srelaxedscl_new_row, .after = match(\"bfi2slittlecreativityscl\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!bfi2ssecurescl_new_row, .after = match(\"bfi2slittlecreativityscl\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!bfi2sstableemotionscl_new_row, .after = match(\"bfi2slittlecreativityscl\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!bfi2sfewartinterestscl_reverse_new_row, .after = match(\"bfi2slittlecreativityscl\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!bfi2sllittleinterestscl_reverse_new_row, .after = match(\"bfi2slittlecreativityscl\", psy_soc_dict$field_name))\n\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!bfi2slittlecreativityscl_reverse_new_row, .after = match(\"bfi2slittlecreativityscl\", psy_soc_dict$field_name))\n```\n:::\n\n\n\n\n\n#### Save:\n\nSave \"bfi\" and updated data dictionary as .csv files in the folder named \"reformatted_bfi\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_csv(bfi,file=here::here(\"data\",\"Psychosocial\",\"Reformatted\",\"reformatted_bfi.csv\"))\nwrite_csv(psy_soc_dict,file=here::here(\"data\",\"Psychosocial\",\"Reformatted\",\"updated_psy_soc_dictionary.csv\"))\n```\n:::\n\n\n\n\n\n### Danish Thoracic Surgery Questionnaire v0.2\n\nThe Danish Thoracic Surgery Questionnaire comprises 17 items to assess functional impairment experienced post thoracotomy. each item is rated on a scale of 0 to 4, where 0 indicates no impairment due to pain and 4 indicates complete impairement due to pain. There is an additional indicator \"I never do this activity\" for each item. The total score is calculated as the sum of all seventeen items[@ringsted2013][@bayman2017]\n\n#### Read in Data:\n\nRead in psy_soc1 dataframe and select field names from the The Danish Thoracic Surgery Questionnaire data and keep completed forms. Keeping completed forms will subset to the thoracotomy cohort by default, we will call \"dts\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndts <- applyFilter(\"dts\",danish_thoracic_surgery_questionnaire_v02_complete)\n```\n:::\n\n\n\n\n\n#### Missing Data:\n\nMissing data pattern in dts.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngg_miss_upset(dts, nsets = n_var_miss(dts),order.by= \"degree\", point.size = 1, line.size = 0.25, \n    text.scale = c(0.5))\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-171-1.png){width=672}\n:::\n:::\n\n\n\n\n\nHandling missing data:\n\nIn case of missing values, a total score can be calculated if responses to 13 of 17 items are available (0.29 x 17 = 4.93). The missing responses are first replaced with the average score of the completed items and then a total score is calculated by adding the scores for all the 17 items(refer to section 1.c).\n\nWe will create a variable \"dts_diff\" and assign a value of 1 if there is a response to more than or equal to 13 of 17 DTS items and 0 if there is a response to less than 13 of 17 DTS items.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndts_vector <- c(\"dtsrunningscl\",\"dtscarryingscl\", \"dtswashingscl\",\"dtscleaningscl\",\"dtswalkingscl\" , \"dtsstairsscl\",\"dtskneelingscl\",\"dtsstandingscl\",\"dtsoutofbedscl\",\"dtsswimmingscl\",\"dtscyclingscl\",\"dtsdrivingscl\",\"dtslyingopsidescl\",\"dtscoughingscl\",\"dtssittingscl\",\"dtswatchtvscl\",\"dtssleepscl\")\n\ndts <- dts %>% \n  mutate(dts_not_na = rowSums(!is.na(.[,dts_vector]))) %>% \n  mutate(dts_diff = case_when(dts_not_na >= 13 ~ 1\n                              ,TRUE~0)) %>% \n                             as_tibble() %>% \n  mutate(dts_diff = as.factor(dts_diff))\n```\n:::\n\n\n\n\n\nWe will now replace missing values with the rounded mean of remaining items if dts_diff = 1 i.e if 13 of 17 items are available and calculate the total score by taking a sum of all the items. We will exclude responses indicated by a \"96\" i.e. \"I never do this activity\" from all calculations.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndts <- dts %>% \n mutate(raw_dts_score = rowSums(select(., all_of(dts_vector)) * (select(., all_of(dts_vector)) != 96), na.rm = TRUE)) %>% \n  mutate(\n    mean_dts = case_when(\n      dts_diff == 1 ~ round(rowMeans(select(., all_of(dts_vector)) * (select(., all_of(dts_vector)) != 96), na.rm = TRUE)))) %>% \n  mutate(across(all_of(dts_vector), ~if_else(is.na(.),mean_dts, .))) %>% \n  mutate(imputed_dts_score = case_when(dts_diff == 1  ~ rowSums(select(., all_of(dts_vector)) * (select(., all_of(dts_vector)) != 96), na.rm = TRUE)))\n```\n:::\n\n\n\n\n\nCheck missingness pattern after imputation\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngg_miss_upset(dts %>% \n                select(-imputed_dts_score,-mean_dts), nsets = n_var_miss(dts),order.by= \"degree\", point.size = 1, line.size = 0.25, \n    text.scale = c(0.5))\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-174-1.png){width=672}\n:::\n:::\n\n\n\n\n\nCheck distributions of DTS scores before (raw_dts_score) and after imputation (imputed_dts_score)\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n dts_plot <- dts %>% \n  filter(between(dts_not_na,13,17)) %>% \n  select(guid,raw_dts_score,imputed_dts_score) %>% \n  pivot_longer(cols =c(\"raw_dts_score\",\"imputed_dts_score\"), values_to = \"score\",names_to = \"score_name\") \n\n  ggplot(dts_plot, aes(x=score_name,y=score, fill=score_name)) +\n  geom_violin(alpha=.25)\n```\n\n::: {.cell-output-display}\n![](psycho_social_biomarker_impute_files/figure-html/unnamed-chunk-175-1.png){width=672}\n:::\n:::\n\n\n\n\n\nRemove intermediate field names not needed\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndts <- dts %>% \n  select(-dts_not_na,-mean_dts,raw_dts_score)\n```\n:::\n\n\n\n\n\n#### New field name(s):\n\nAdd the field names \"dts_diff\" and \"imputed_dts_score\"to the data dictionary\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create field names\ndts_diff_new_row <- data.frame(\n  field_name = \"dts_diff\",\n  form_name = \"danish_thoracic_surgery_questionnaire_v02\",\n  field_type = \"factor\",\n  select_choices_or_calculations = \"1, if there is a response to more than or equal to 13 of 17 DTS items|0, if there is a response to less than 13 of 16 DTS items\")\n  \ndts_score_new_row <- data.frame(\n  field_name = \"imputed_dts_score\",\n  form_name = \"danish_thoracic_surgery_questionnaire_v02\",\n  field_type = \"numeric\",\n  field_label = \"A higher score indicates a higher degree of functional impairment due to pain\",\n  field_note= \"The missing responses are first replaced with the average score of the completed items and then a total score is calculated by adding the scores for all the items, responses indicated by 96 were excluded from the total score\")\n\n# adding fabq_diff\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!dts_diff_new_row, .after = match(\"dtssleepscl\", psy_soc_dict$field_name))\n\n# imputed fabq score\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!dts_score_new_row, .after = match(\"dtssleepscl\", psy_soc_dict$field_name))  \n```\n:::\n\n\n\n\n\n#### Save:\n\nSave \"dts\" and updated data dictionary as .csv files in the folder named \"reformatted_dts\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_csv(dts,file=here::here(\"data\",\"Psychosocial\",\"Reformatted\",\"reformatted_dts.csv\"))\nwrite_csv(psy_soc_dict,file=here::here(\"data\",\"Psychosocial\",\"Reformatted\",\"updated_psy_soc_dictionary.csv\"))\n```\n:::\n\n\n\n\n\n### Rapid Assessment of Physical Activity v1.0 (RAPA)\n\nThe Rapid Assessment of Physical Activity Questionnaire comprises 9 items to assess physical activity in subject over 50 years of age. The first 7 items measure aerobic activity and the last 2 items measure strength/flexibility. Each item has a yes/no response [@topolski_rapid_2006]. Here we well compute aerobic activity score based on the highest affirmative response.\n\n#### Read in Data:\n\nRead in psy_soc1 dataframe and select field names from the RAPA and keep completed forms, we will call \"rapa\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrapa <- applyFilter(\"rapa\",rapid_assessment_of_physical_activity_v10_rapa_complete) %>% \n  retype()\n```\n:::\n\n\n\n\n\nMissing values cannot be imputed, we well compute aerobic activity score based on the highest affirmative response.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrapa <- rapa %>% \n  mutate(\n    rapa_rarly1 = case_when(\n      rapa_rarly == 1 ~ 1, \n      TRUE ~ rapa_rarly\n    ),\n    rapa_light1 = case_when(\n      rapa_light == 1 ~ 2, \n      TRUE ~ rapa_light\n    ),\n    rapa_lightweekly1 = case_when(\n      rapa_lightweekly == 1 ~ 3, \n      TRUE ~ rapa_lightweekly\n    ),\n    rapa_mod1 = case_when(\n      rapa_mod == 1 ~ 4, \n      TRUE ~ rapa_mod\n    ),\n    rapa_vig1 = case_when(\n      rapa_vig == 1 ~ 4, \n      TRUE ~ rapa_vig\n    ),\n    rapa_modweekly1 = case_when(\n      rapa_modweekly == 1 ~ 5, \n      TRUE ~ rapa_modweekly\n    ),\n    rapa_vigweekly1 = case_when(\n      rapa_vigweekly == 1 ~ 5, \n      TRUE ~ rapa_vigweekly\n    ),\n    rapa_aerobic_score = pmax(rapa_rarly1, rapa_light1, rapa_lightweekly1, rapa_mod1, rapa_vig1, rapa_modweekly1, rapa_vigweekly1, na.rm = TRUE)\n  ) %>%\n  mutate(rapa_aerobic_category = case_when(rapa_aerobic_score==1 ~ \"sedentary\",\n                                 rapa_aerobic_score==2 ~ \"underactive\",\n                                 rapa_aerobic_score==3 ~\"underactive_regular-light_activities\",\n                                 rapa_aerobic_score==4 ~ \"underactive_regular\",\n                                 rapa_aerobic_score==5 ~\"active\",\n                                 rapa_aerobic_score==0 ~\"answered_no_to_all_aerobic_items\",\n                                 TRUE~ NA)) %>% \n   mutate(rapa_aerobic_category= as.factor(rapa_aerobic_category)) \n```\n:::\n\n\n\n\n\nWe will create a variable \"rapa_aerobic_missing\" and assign a value of 1 if \"rapa_aerobic_score\" is missing and 0 if \"rapa_aerobic_score\" is available\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrapa <- rapa %>% \n  mutate(rapa_aerobic_missing = case_when(is.na(rapa_aerobic_score ) ~ 1, TRUE ~ 0))\n```\n:::\n\n\n\n\n\nCheck number of missing aerobic score\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntable(rapa$rapa_aerobic_missing)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n   0    1 \n1360    2 \n```\n\n\n:::\n:::\n\n\n\n\n\n#### New field name(s)\n\nAdd the field names \"rapa_aerobic_score\" and \"rapa_aerobic_missing\" to the data dictionary\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create field names\naerobic_score_new_row <- data.frame(\n  field_name = \"rapa_aerobic_score\",\n  form_name = \"rapid_assessment_of_physical_activity_v10_rapa\",\n  field_type = \"numeric\",\n  select_choices_or_calculations = \"0, if answered_no_to_all_aerobic_itemse|1,Sedentary|2,Underactive|3, Underactive_regular-light_activities|4,Underactive_regular|5,Active\")\n\naerobic_category_new_row <- data.frame(\n  field_name = \"rapa_aerobic_category\",\n  form_name = \"rapid_assessment_of_physical_activity_v10_rapa\",\n  field_type = \"Factor\",\n  select_choices_or_calculations = \"if answered_no_to_all_aerobic_itemse|Sedentary|Underactive|Underactive_regular-light_activities|Underactive_regular|Active\")\n  \naerobic_missing_new_row <- data.frame(\n  field_name = \"rapa_aerobic_missing\",\n  form_name = \"rapid_assessment_of_physical_activity_v10_rapa\",\n  field_type = \"numeric\",\n  select_choices_or_calculations = \"1 if rapa_aerobic_score is missing|0, if rapa_aerobic_score is not missing\")\n#################\n\nrapa1_new_row <- data.frame(\n  field_name = \"rapa_rarly1\",\n  form_name = \"rapid_assessment_of_physical_activity_v10_rapa\",\n  field_type = \"numeric\",\n  field_label= \" recoded as 1 if subject's highest affirmative response for aerobic activity related  questions\")\n\nrapa2_new_row <- data.frame(\n  field_name = \"rapa_light1\",\n  form_name = \"rapid_assessment_of_physical_activity_v10_rapa\",\n  field_type = \"numeric\",\n  field_label= \"recoded as 2 if subject's highest affirmative response for aerobic activity related  questions\")\n\nrapa3_new_row <- data.frame(\n  field_name = \"rapa_lightweekly1\",\n  form_name = \"rapid_assessment_of_physical_activity_v10_rapa\",\n  field_type = \"numeric\",\n  field_label= \"recoded as 3 if subject's highest affirmative response for aerobic activity related  questions\")\n\nrapa4_new_row <- data.frame(\n  field_name = \"rapa_mod1\",\n  form_name = \"rapid_assessment_of_physical_activity_v10_rapa\",\n  field_type = \"numeric\",\n  field_label= \"recoded as 4 if subject's highest affirmative response for aerobic activity related  questions\")\n\nrapa5_new_row <- data.frame(\n  field_name = \"rapa_vig1\",\n  form_name = \"rapid_assessment_of_physical_activity_v10_rapa\",\n  field_type = \"numeric\",\n  field_label= \"recoded as 4 if subject's highest affirmative response for aerobic activity related questions\")\n\nrapa6_new_row <- data.frame(\n  field_name = \"rapa_modweekly1\",\n  form_name = \"rapid_assessment_of_physical_activity_v10_rapa\",\n  field_type = \"numeric\",\n  field_label= \"recoded as 5 if subject's highest affirmative response for aerobic activity related  questions\")\n\nrapa7_new_row <- data.frame(\n  field_name = \"rapa_vigweekly1\",\n  form_name = \"rapid_assessment_of_physical_activity_v10_rapa\",\n  field_type = \"numeric\",\n  field_label= \"recoded as 5 if subject's highest affirmative response for aerobic activity related  questions\")\n\n\n####\n# adding rows\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!aerobic_score_new_row, .after = match(\"rapa_2score\", psy_soc_dict$field_name))\n\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!aerobic_category_new_row, .after = match(\"rapa_2score\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!aerobic_missing_new_row, .after = match(\"rapa_2score\", psy_soc_dict$field_name))\n\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!rapa1_new_row, .after = match(\"rapa_2score\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!rapa2_new_row, .after = match(\"rapa_2score\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!rapa3_new_row, .after = match(\"rapa_2score\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!rapa4_new_row, .after = match(\"rapa_2score\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!rapa5_new_row, .after = match(\"rapa_2score\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!rapa6_new_row, .after = match(\"rapa_2score\", psy_soc_dict$field_name))\n\npsy_soc_dict <- psy_soc_dict %>% \n  add_row(!!!rapa7_new_row, .after = match(\"rapa_2score\", psy_soc_dict$field_name))\n```\n:::\n\n\n\n\n\n#### Save:\n\nSave \"rapa\" and updated data dictionary as .csv files in the folder named \"reformatted_rapa\"\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_csv(rapa,file=here::here(\"data\",\"Psychosocial\",\"Reformatted\",\"reformatted_rapa.csv\"))\nwrite_csv(psy_soc_dict,file=here::here(\"data\",\"Psychosocial\",\"Reformatted\",\"updated_psy_soc_dictionary.csv\"))\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}