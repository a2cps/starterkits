{
  "hash": "6ea6d959037771b75dcf903bca81e0ad",
  "result": {
    "engine": "knitr",
    "markdown": "# Genetic Variant Data {#sec-snps}\n\nThis page provides considerations for A2CPS projects that involve the Genetic Variant data.\n\n![](https://upload.wikimedia.org/wikipedia/commons/f/ff/DNA_double_helix_%2813081113544%29.jpg){width=500px}\n<!-- This file is licensed under the Creative Commons Attribution 2.0 Generic license. -->\n\nGenetic variant data captures individual variation in the human genome with single-nucleotide resolution. Our released SNP array data includes 690,126 genetic loci across all 22 autosomes, the X / Y (sex) chromosomes, and mitochondrial DNA for 1375 participants. At each locus, there is a more common \"reference\" (REF) allele and a less common \"alternate\" (ALT) allele, also referred to as the major and minor alleles, respectively. Because humans are diploid, we carry two copies of each chromosome, and thus two alleles at each locus, which may be both REF, both ALT, or one of each (heterozygous). This data enables researchers to examine allele-level variation across the genome at precisely selected sites for each participant. Below, we expand with more granularity how to work with these data, and the quality control measures that were used to create them. Notably, we also used the quality controlled data to impute whole genome sequences using TOPMed's Imputation Server, information that is included in the \"Imputed Genomics\" starter kit.\n\n---\n\n## Starting Project\n\n### Locate Data\n\nOn TACC, the data are stored underneath the releases. For example, data release `v2.1.0` is underneath\n\n```bash\n/corral-secure/projects/A2CPS/products/consortium-data/pre-surgery-release-2-1-0/omics/gene_variants\n```\n\nThe genetic variant data are underneath the `omics/gene_variants` folder\n\n```bash\n$ ls /corral-secure/projects/A2CPS/products/consortium-data/pre-surgery-release-2-1-0/omics/gene_variants\n2025-06-02_UCSD_GV_Genotypes_Runlists_1-5_QC_freeze2.bed\n2025-06-02_UCSD_GV_Genotypes_Runlists_1-5_QC_freeze2.bim\n2025-06-02_UCSD_GV_Genotypes_Runlists_1-5_QC_freeze2.fam\n2025-06-02_UCSD_GV_Genotypes_Runlists_1-5_QC_freeze2_Imputed_Genomics.bed\n2025-06-02_UCSD_GV_Genotypes_Runlists_1-5_QC_freeze2_Imputed_Genomics.bim\n2025-06-02_UCSD_GV_Genotypes_Runlists_1-5_QC_freeze2_Imputed_Genomics.fam\n2025-06-02_UCSD_GV_Genotypes_Runlists_1-5_QC_freeze2_Imputed_Genomics.log\n2025-06-02_UCSD_GV_Genotypes_Runlists_1-5_QC_freeze2.log\n2025-06-02_UCSD_GV_Genotypes_Runlists_1-5_QC_freeze2.nosex\n2025-06-02_UCSD_GV_Genotypes_Runlists_1-5_QC_freeze2_PCA_Ind_Info.csv\n```\n\nThese files are in the [PLINK](https://www.cog-genomics.org/plink/1.9/) format.\n\n## Plink Binary File Set\n#### .bim\n\nEach row in this file specifics a genetic variant and provides extended information on its location and alleles.\n```bash\n$ cd /corral-secure/projects/A2CPS/products/consortium-data/pre-surgery-release-2-1-0/omics/gene_variants\n$ head -5 2025-06-02_UCSD_GV_Genotypes_Runlists_1-5_QC_freeze2.bim\n```\n\n::: {.cell}\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n| CHR|VAR ID          | POS (cM)| POS (bp)|ALLELE 1 (ALT) |ALLELE 2 (REF) |\n|---:|:---------------|--------:|--------:|:--------------|:--------------|\n|   1|rs9651229       |        0|   632287|T              |C              |\n|   1|rs9701872       |        0|   632828|C              |T              |\n|   1|rs11497407      |        0|   633147|A              |G              |\n|   1|GSA-rs116587930 |        0|   792461|A              |G              |\n|   1|rs3131972       |        0|   817341|A              |G              |\n\n</div>\n:::\n:::\n\n\n- CHR = chromosome #\n- Var ID\n  - rsID = Reference SNP (single nucleotide polymorphism) ID\n  - GSA = Global Screening Array\n  - 22:24377823_CNV_GSTT1\n    - For Variants labeled as such, this ID means CHR:POS:CopyNumberVariant:Gene\n- cM (centimorgan) = measure of the frequency genetic recombination. 1 cM is a 1% chance that two markers on a chr will separate due to recombination during meiosis. Often not included.\n- bp (base-pair) = The genomic position on a given chromosome.\n- Allele 1 = reference, major allele\n- Allele 2 = alternate, minor allele\n\n#### .fam\n\nEach row in this file specifics a participant and provides extended information on its identifiers, family, and gender.\n\n```bash\n$ head -5 2025-06-02_UCSD_GV_Genotypes_Runlists_1-5_QC_freeze2.fam\n```\n\n::: {.cell}\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n| Family ID|Individual ID               | Father ID| Mother ID| Sex| Phenotype|\n|---------:|:---------------------------|---------:|---------:|---:|---------:|\n|         1|P3VO69LyyV2AZ_L27BDmybNy8zN |         0|         0|   1|        -9|\n|         2|74n6ZMnXd3WmA_L27BDmybNy8zN |         0|         0|   1|        -9|\n|         3|Px3x6X3gWBNA1_L27BDmybNy8zN |         0|         0|   2|        -9|\n|         4|eyPoDR1qoJegX_L27BDmybNy8zN |         0|         0|   1|        -9|\n|         5|74m9r0BKoMxk3_L27BDmybNy8zN |         0|         0|   1|        -9|\n\n</div>\n:::\n:::\n\n\n- Family ID (FID) = identifier for the participant's family\n- Individual ID (IID) = identifier for the participant, in the form biospecimenID_runlistID\n- Father ID (FaID) = identifier for the participant's father. A2CPS not ascertained based on family structure.\n- Mother ID (MoID) = identifier for the participant's mother. A2CPS not ascertained based on family structure.\n- Sex = 1 : M, 2 : F\n- Phenotype = 1 = Control, 2 = Case, 0/-9 if not present. Often not included.\n\n#### .bed\n\n\nA binary file, unviewable through command line commands such as \"cat\". This contains each participant's genotype data. Stored as bytes:\n\n\n00\tHomozygous for first allele in .bim file\n\n01\tMissing genotype\n\n10\tHeterozygous\n\n11\tHomozygous for second allele in .bim file\n\nTo see all files types in plink, go here: [File format reference - PLINK 1.9](https://www.cog-genomics.org/plink/1.9/formats).\n\n---\n\n### Extract Data\n\nTo access the variant data, plink2 (or plink 1.9) must be installed. Please see: [PLINK 2.0](https://www.cog-genomics.org/plink/2.0/) or  [PLINK 1.9](https://www.cog-genomics.org/plink/1.9/).\n\nHere, we are storing a set of genetic variants from our primary biomarker list in a text file called 'snps.txt'. Since we specifically probed these sites, they have longer, study-specific identifiers. By contrast, a typical SNP is assigned a reference SNP ID (rsID), which usually takes the form rs followed by a number, such as rs1, rs105, or rs123456789. \n\n\n```shell\n$ cat snps.txt \nilmnseq_rs1799971_ilmndup1,ilmnseq_rs1799971_ilmndup2,rs1799971\nilmnseq_rs6265_ilmndup1,ilmnseq_rs6265_ilmndup2,rs6265\nilmnseq_rs1491850_ilmndup1,ilmnseq_rs1491850_ilmndup2,rs1491850\n```\n\nThe `plink` command can then use that file to create a table of the minor allele frequencies for a given set of genetic loci. --bfile is a very common flag in plink, as it is the input binary files (.bim, .bed, .fam) for a given filtering step.\n\n```shell\n$ ./plink \\\n  --bfile 2025-06-02_UCSD_GV_Genotypes_Runlists_1-5_QC_freeze2 \\\n  --extract snps.txt \\\n  --freq \\\n  --out snp_frequencies \n```\n\nHere is the resulting table:\n\n\n::: {.cell}\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n| CHR|SNP                                                             |A1 |A2 |    MAF| NCHROBS|\n|---:|:---------------------------------------------------------------|:--|:--|------:|-------:|\n|   6|ilmnseq_rs1799971_ilmndup1,ilmnseq_rs1799971_ilmndup2,rs1799971 |G  |A  | 0.1182|    2750|\n|  11|ilmnseq_rs6265_ilmndup1,ilmnseq_rs6265_ilmndup2,rs6265          |T  |C  | 0.1535|    2750|\n|  11|ilmnseq_rs1491850_ilmndup1,ilmnseq_rs1491850_ilmndup2,rs1491850 |C  |T  | 0.3760|    2750|\n\n</div>\n:::\n:::\n\n\n- CHR = chromosome number\n- SNP = SNP identifier\n- A1 = minor (alternate) allele\n- A2 = major (reference) allele\n- MAF = minor allele frequency (calculated # minor allele observations / # total allele observations)\n- NCHROBS = total number of allele observations (2 * number of participants)\n\n---\n\n## Quality Control\n\nThe below procedures were performed with these data:\n\nRL1-5.bim\n\nRL1-5.fam\n\nRL1-5.bed\n\n### Overall Filters\n\n- Participants with > 2% missing genotype calls were removed. In cases of duplicated samples or sibling pairs, one individual from each pair was excluded to avoid overrepresentation of shared genotypes. The individual with lower data quality was preferentially dropped.\n\n- Variants with missing genotype calls in more than 20% of participants were excluded.\n\n- For the X and Y chromosomes, biologically impossible calls were removed — including heterozygous calls in males (who are hemizygous for these chromosomes) and non-missing Y chromosome calls in females.\n\n### Considerations while working with these data\n- We used a relatively liberal --geno 0.2 filter to retain as many variants as possible. Many studies adopt stricter thresholds (e.g., --geno 0.1 or lower), but we prioritized inclusivity of data in this stage of QC.\n\n- We intentionally did not apply a Hardy-Weinberg equilibrium (--hwe) filter. Principal component analysis (PCA) revealed population structure, and applying HWE filtering across pooled subpopulations can lead to inflated Type I error rates due to the Wahlund effect. This occurs when heterozygosity is overestimated across stratified populations (since there are actually more homozygotes in each subpopulation), causing variants to falsely appear as deviating from equilibrium. If desired, users may stratify the data by major ancestry groups and apply HWE filtering within those subsets.\n\n- We also chose not to filter on minor allele frequency (--maf) to leave this decision to the end user, depending on whether they are interested in rare or common variants. Common --maf thresholds include 0.05 or 0.01. Note that population structure can influence allele frequency distributions — a variant rare in the total sample may be common within a subpopulation.\n\n- The pseudo-autosomal region (PAR) of the X chromosome is often excluded in X chromosome-specific analyses, as it behaves more like an autosome. We leave this decision to researchers conducting such analyses. To perform this separation, a typical command is:\n```bash\n./plink --bfile path/to/x-chr --split-x hg38 --make-bed --out path/to/split-off-PAR-x-chr\n```\n\n- Many study designs, such as polygenic risk score calculations, must be cognizant of population structure. \n\n### Quality Control Code\n<details>\n<summary>Click to show Quality Control Bash Script, which utilizes Plink 1.9</summary>\n\n```bash\n\nmkdir plots\nmkdir helpers\nmkdir qc_derivatives\n\n# Step 1: Split files into individual chromosomes\nmkdir qc_derivatives/1_by_chr\nfor chr in {1..26}; do\n./plink --bfile RL1-5 --chr $chr --make-bed --out qc_derivatives/1_by_chr/RL1-5_chr${chr}\ndone\n\n# Step 2: Obtain Variant and Individual Level Summary Statistics on Each Chromosome's Data\nmkdir qc_derivatives/2_summary_stats\nfor chr in {1..22}; do \n./plink --bfile qc_derivatives/1_by_chr/RL1-5_chr${chr} --keep-allele-order --missing --freq --hardy --out qc_derivatives/2_summary_stats/RL1-5_ss_chr${chr}; \ndone\n\n# 2.1: RScript to assess which participants > 2% missingness \nRscript ./scripts/missingness.samples.r \"$USER_WD\"\n\n# Step 3: Drop individuals with high missingness\nmkdir qc_derivatives/3_ind_missingness_dropped\nfor chr in {1..22}; do \n./plink --bfile qc_derivatives/1_by_chr/RL1-5_chr${chr}  --remove helpers/A2CPS_Ind_Missingness_Drop.txt --keep-allele-order --make-bed --out qc_derivatives/3_ind_missingness_dropped/RL1-5_chr${chr}_ind_missingness_dropped; \ndone\n\n# Step 4: Variant Quality Control based on Missingness (maf filtering avoided, users choice. hwe filtering avoided, wahlund effect)\nmkdir qc_derivatives/4_variant_filtered\nfor chr in {1..22}; do \n./plink --bfile qc_derivatives/3_ind_missingness_dropped/RL1-5_chr${chr}_ind_missingness_dropped --keep-allele-order --geno 0.2 --write-snplist --make-bed --out qc_derivatives/4_variant_filtered/RL1-5_chr${chr}_variant_filtered; \ndone\n\n# Step 5 / 6: LD Pruning\nmkdir qc_derivatives/5_LD_Pruning\nfor chr in {1..22}; do \n    ./plink --bfile qc_derivatives/4_variant_filtered/RL1-5_chr${chr}_variant_filtered --indep-pairwise 100 5 0.2 --out qc_derivatives/5_LD_Pruning/RL1-5_chr${chr}_LD_Pruning; \ndone\nmkdir qc_derivatives/6_LD_Pruned\nfor chr in {1..22}; do \n    ./plink --bfile qc_derivatives/4_variant_filtered/RL1-5_chr${chr}_variant_filtered --extract qc_derivatives/5_LD_Pruning/RL1-5_chr${chr}_LD_Pruning.prune.in --make-bed --out qc_derivatives/6_LD_Pruned/RL1-5_chr${chr}_LD_Pruned; \ndone\n\n# Step 7: Merge\nmkdir qc_derivatives/7_Merged\nfor i in {1..22}; do echo qc_derivatives/6_LD_Pruned/RL1-5_chr${i}_LD_Pruned; done > helpers/RL1-5_chr_LD_Pruned_list.txt\n./plink --bfile qc_derivatives/6_LD_Pruned/RL1-5_chr1_LD_Pruned --merge-list helpers/RL1-5_chr_LD_Pruned_list.txt --make-bed --out qc_derivatives/7_Merged/RL1-5_Merged\n\n# Step 8: Heterozygosity Checks\n./plink --bfile qc_derivatives/7_Merged/RL1-5_Merged --het --out qc_derivatives/7_Merged/RL1-5_Merged_Het\n\n# Step 9: Identity by Descent Checks - if related or duplicates exist, one of the family-members (the one with worse quality) must be dropped.\n./plink --bfile qc_derivatives/7_Merged/RL1-5_Merged --genome --threads 1 --out qc_derivatives/7_Merged/RL1-5_Merged_IBD\n\n# 9.1: RScripts to identify participants to drop based on heterozygosity and poorer-quality related sample\n\nRscript ./scripts/het.genome.r \"$USER_WD\"\nRscript ./scripts/missingness.related.comparison.r \"$USER_WD\"\n\n### Step 10: Sex Typing ###\n    mkdir qc_derivatives/sex_typing\n\n    # create list of individuals to be dropped prior to sex typing, those with high missingness and poorer-quality related individuals\n    cat helpers/A2CPS_Ind_Missingness_Drop.txt helpers/A2CPS_related_drop.txt  > helpers/A2CPS_Pre_Sex_Typing_Sample_Drops.txt\n\n    # Step a: Drop Samples that did not pass QC\n    mkdir qc_derivatives/sex_typing/samples_dropped\n    ./plink --bfile qc_derivatives/1_by_chr/RL1-5_chr23 --remove helpers/A2CPS_Pre_Sex_Typing_Sample_Drops.txt --keep-allele-order --make-bed --out qc_derivatives/sex_typing/samples_dropped/RL1-5_chr23_samples_dropped; \n\n    # Step b: Split off X Chr pseudo-autosomal region (whose inheritance patterns mirror those of the autosomes) [chr25]\n    mkdir qc_derivatives/sex_typing/PAR_Removed\n    ./plink --bfile qc_derivatives/sex_typing/samples_dropped/RL1-5_chr23_samples_dropped --split-x hg38 --make-bed --out qc_derivatives/sex_typing/PAR_Removed/RL1-5_chr23_PAR_Removed\n\n    # Step c: LD Pruning \n    mkdir qc_derivatives/sex_typing/LD_Pruning\n    ./plink --bfile qc_derivatives/sex_typing/PAR_Removed/RL1-5_chr23_PAR_Removed --indep-pairphase 100 5 0.2 --out qc_derivatives/sex_typing/LD_Pruning/RL1-5_chr23_LD_Pruning\n    mkdir qc_derivatives/sex_typing/LD_Pruned\n    ./plink --bfile qc_derivatives/sex_typing/PAR_Removed/RL1-5_chr23_PAR_Removed --extract qc_derivatives/sex_typing/LD_Pruning/RL1-5_chr23_LD_Pruning.prune.in --make-bed --out qc_derivatives/sex_typing/LD_Pruned/RL1-5_chr23_LD_Pruned\n\n    # Step d: MAF Estimates\n    mkdir qc_derivatives/sex_typing/MAF\n    ./plink --bfile qc_derivatives/sex_typing/LD_Pruned/RL1-5_chr23_LD_Pruned --freq --out qc_derivatives/sex_typing/MAF/RL1-5_chr23_LD_Pruned_MAF\n\n    # Step e: Sex Check\n    ./plink --bfile qc_derivatives/sex_typing/LD_Pruned/RL1-5_chr23_LD_Pruned  --read-freq qc_derivatives/sex_typing/MAF/RL1-5_chr23_LD_Pruned_MAF.frq --check-sex 0.3 0.75 --out qc_derivatives/sex_typing/sex_check\n\n    # Step f: Create Plots and create list of participants to drop, where we were unable to resolve the sex discrepancies with REDCap or EHR data.\n    Rscript ./scripts/sex.typing.r \"$USER_WD\"\n\n# Step 11: Return to pre-LD-Pruned files and merge. \nmkdir qc_derivatives/8_Merged_Pre_LD\nfor i in {1..22}; do echo qc_derivatives/4_variant_filtered/RL1-5_chr${i}_variant_filtered; done > helpers/RL1-5_chr_Pre_LD_list.txt\n./plink --bfile qc_derivatives/4_variant_filtered/RL1-5_chr1_variant_filtered --merge-list helpers/RL1-5_chr_Pre_LD_list.txt --make-bed --out qc_derivatives/8_Merged_Pre_LD/RL1-5_Merged_Pre_LD\n\n# 11.1: Create comprehensive file with all participant drops so far\ncat helpers/A2CPS_Ind_Missingness_Drop.txt helpers/A2CPS_related_and_sex_discrepancy_drop.txt  > helpers/A2CPS_Pre_Chr_XYMT_QC_Sample_Drops.txt\n\n### X, Y, and MT QC ###\n\n### X Chromosome QC ###\nmkdir X_Chr\n    # Step a: drop samples with high missingness, higher-missingness related samples, and unrecoverable sex typing discrepancies, fix the sex discrepancies\n    mkdir X_Chr/Samples_Dropped\n    ./plink --bfile qc_derivatives/1_by_chr/RL1-5_chr23 --remove helpers/A2CPS_Pre_Chr_XYMT_QC_Sample_Drops.txt --keep-allele-order --make-bed --out X_Chr/Samples_Dropped/RL1-5_chr23_samples_dropped\n    \n    # step b: update sex\n    mkdir X_Chr/Sex_Updated\n    ./plink --bfile  X_Chr/Samples_Dropped/RL1-5_chr23_samples_dropped --update-sex helpers/A2CPS_update_sex.txt --keep-allele-order --make-bed --out X_Chr/Sex_Updated/RL1-5_chr23_Sex_Updated\n    \n    # Step c: Take summary statistics in case necessary to further remove samples\n    mkdir X_Chr/Summary_Stats\n    ./plink --bfile X_Chr/Sex_Updated/RL1-5_chr23_Sex_Updated --missing --freq --out X_Chr/Summary_Stats/RL1-5_chr23_Summary_Stats\n\n    # Step d: Filter out poor-quality variants\n    mkdir X_Chr/Variant_Filtered\n    ./plink --bfile X_Chr/Sex_Updated/RL1-5_chr23_Sex_Updated --geno 0.2 --write-snplist --keep-allele-order --make-bed --out X_Chr/Variant_Filtered/RL1-5_chr23_variant_filtered\n    awk '{print $3}' X_Chr/Variant_Filtered/RL1-5_chr23_variant_filtered.hh | sort -u > X_Chr/Variant_Filtered/hh_snps_x_to_exclude.txt\n\n    # step e: Filter out those included in the .hh file\n    grep -vFf X_Chr/Variant_Filtered/hh_snps_x_to_exclude.txt X_Chr/Variant_Filtered/RL1-5_chr23_variant_filtered.snplist > X_Chr/Variant_Filtered/RL1-5_chr23_variant_filtered.no_hh.snplist\n\n### Y Chromosome QC ###\nmkdir Y_Chr\n    # Step a: drop samples with high missingness, higher-missingness related samples, and unrecoverable sex typing discrepancies \n    mkdir Y_Chr/Samples_Dropped\n    ./plink --bfile qc_derivatives/1_by_chr/RL1-5_chr24 --remove helpers/A2CPS_Pre_Chr_XYMT_QC_Sample_Drops.txt --keep-allele-order --make-bed --out Y_Chr/Samples_Dropped/RL1-5_chr24_samples_dropped\n    \n    # step b: update sex\n    mkdir Y_Chr/Sex_Updated\n    ./plink --bfile  Y_Chr/Samples_Dropped/RL1-5_chr24_samples_dropped --update-sex helpers/A2CPS_update_sex.txt --keep-allele-order --make-bed --out Y_Chr/Sex_Updated/RL1-5_chr24_Sex_Updated\n    \n    # Step c: Take summary statistics in case necessary to further remove samples\n    mkdir Y_Chr/Summary_Stats\n    ./plink --bfile Y_Chr/Sex_Updated/RL1-5_chr24_Sex_Updated --missing --freq --out Y_Chr/Summary_Stats/RL1-5_chr24_Summary_Stats\n\n    # Step d: Filter out poor-quality variants\n    mkdir Y_Chr/Variant_Filtered\n    ./plink --bfile Y_Chr/Sex_Updated/RL1-5_chr24_Sex_Updated --geno 0.2 --keep-allele-order --write-snplist --make-bed --out Y_Chr/Variant_Filtered/RL1-5_chr24_variant_filtered\n    awk '{print $3}' Y_Chr/Variant_Filtered/RL1-5_chr24_variant_filtered.hh | sort -u > Y_Chr/Variant_Filtered/hh_snps_y_to_exclude.txt\n\n    # step e: Filter out those included in the .hh file\n    grep -vFf Y_Chr/Variant_Filtered/hh_snps_y_to_exclude.txt Y_Chr/Variant_Filtered/RL1-5_chr24_variant_filtered.snplist > Y_Chr/Variant_Filtered/RL1-5_chr24_variant_filtered.no_hh.snplist\n\n### Mitochondrial DNA ###\nmkdir MT_Chr\n    # Step a: drop samples with high missingness, higher-missingness related samples, and unrecoverable sex typing discrepancies \n    mkdir MT_Chr/Samples_Dropped\n    ./plink --bfile qc_derivatives/1_by_chr/RL1-5_chr26 --remove helpers/A2CPS_Pre_Chr_XYMT_QC_Sample_Drops.txt --keep-allele-order --make-bed --out MT_Chr/Samples_Dropped/RL1-5_chr26_samples_dropped\n\n    # step b: update sex\n    mkdir MT_Chr/Sex_Updated\n    ./plink --bfile  MT_Chr/Samples_Dropped/RL1-5_chr26_samples_dropped --update-sex helpers/A2CPS_update_sex.txt --keep-allele-order --make-bed --out MT_Chr/Sex_Updated/RL1-5_chr26_Sex_Updated\n    \n    # Step c: Take summary statistics in case necessary to further remove samples\n    mkdir MT_Chr/Summary_Stats\n    ./plink --bfile MT_Chr/Sex_Updated/RL1-5_chr26_Sex_Updated --missing --freq --out MT_Chr/Summary_Stats/RL1-5_chr26_Summary_Stats\n\n    # Step d: Filter out poor-quality variants\n    mkdir MT_Chr/Variant_Filtered\n    ./plink --bfile MT_Chr/Sex_Updated/RL1-5_chr26_Sex_Updated --geno 0.2 --keep-allele-order --write-snplist --make-bed --out MT_Chr/Variant_Filtered/RL1-5_chr26_variant_filtered\n\n## LIST OF INDIVIDUALS TO DROP ##\ncat helpers/A2CPS_Ind_Missingness_Drop.txt helpers/A2CPS_related_and_sex_discrepancy_drop.txt > A2CPS_RL1-5_Preparation_Files/A2CPS_RL1-5_Final_Sample_Drop_List.txt\n\n## LIST OF SNPs TO KEEP ##\ncat qc_derivatives/4_variant_filtered/RL1-5_chr{1..22}_variant_filtered.snplist X_Chr/Variant_Filtered/RL1-5_chr23_variant_filtered.no_hh.snplist Y_Chr/Variant_Filtered/RL1-5_chr24_variant_filtered.no_hh.snplist  MT_Chr/Variant_Filtered/RL1-5_chr26_variant_filtered.snplist > A2CPS_RL1-5_Preparation_Files/RL1-5_all_chr_variant_filtered.snplist\n\n## LIST OF SEXES TO UPDATE ##\ncp helpers/A2CPS_update_sex.txt A2CPS_RL1-5_Preparation_Files/A2CPS_RL1-5_Update_Sex_List.txt \n\n# USE THIS LINE TO OBTAIN FINAL FILES QC FIles, still with participants outside of Freeze 2 ##\nmkdir ./A2CPS_RL1-5_QCed\n./plink --bfile RL1-5 --remove A2CPS_RL1-5_Preparation_Files/A2CPS_RL1-5_Final_Sample_Drop_List.txt --extract A2CPS_RL1-5_Preparation_Files/RL1-5_all_chr_variant_filtered.snplist --update-sex A2CPS_RL1-5_Preparation_Files/A2CPS_RL1-5_Update_Sex_List.txt --keep-allele-order --make-bed --out A2CPS_RL1-5_QCed/A2CPS_RL1-5_QCed\n\n########################\n## FINAL FOR RELEASE: ##\n########################\n\n# Subset only Freeze 2 #\nRscript ./A2CPS_RL1-5_QCed/Freeze2.R \"$USER_WD\"\nmkdir Freeze_2\n./plink --bfile RL1-5 --remove A2CPS_RL1-5_Preparation_Files/A2CPS_RL1-5_Final_Sample_Drop_List_Only_Freeze_2.txt --extract A2CPS_RL1-5_Preparation_Files/RL1-5_all_chr_variant_filtered.snplist --update-sex A2CPS_RL1-5_Preparation_Files/A2CPS_RL1-5_Update_Sex_List.txt --keep-allele-order --make-bed --out Freeze_2/A2CPS_Freeze_2\n\n```\n\n</details>\n\n#### Supplementary QC Files: RScripts\n<details>\n<summary>Click to show Supplementary RScript #1: Determining High Missingness Individuals (missingness.samples.r)</summary>\n```r\nlibrary(data.table)\ncombined_data <- data.frame()\n\nargs <- commandArgs(trailingOnly = TRUE)\nuser_wd <- args[1]\nsetwd(user_wd)\n\n# read in and combine .imiss file (individual-level missingness)\nfor (i in 1:22) {\n  file_name <- sprintf(\"./qc_derivatives/2_summary_stats/RL1-5_ss_chr%d.imiss\", i)\n  current_data <- read.table(file_name, header = TRUE)\n  combined_data <- rbind(combined_data, current_data)\n}\n\n# DAT HAS EACH MISSING CALL RATE (22 per participant)\ndat <- combined_data$\"F_MISS\" \nnumber.geno <- combined_data$N_GENO # total genotyped SNPs across autosomes\nnumber.missed <- combined_data$N_MISS # total missed SNPs across autosomes across participants\nmatrix.geno <- matrix(number.geno,ncol=22)\nsummed.geno <- sum(matrix.geno[1,]) # total autosomal SNPs\nmatrix.missed <- matrix(number.missed,ncol=22)\n\nindividual.missed.percent <- rowSums(matrix.missed) / summed.geno\n\nmissingness.table <-  data.table(\n  FAMID = current_data$FID,\n  ID = current_data$IID,\n  Missingness = individual.missed.percent\n)\n\nfwrite(missingness.table, \"./helpers/A2CPS_RL1-5_Missingness.csv\")\n\n# subset those with over %2 missingness\nover.two <- which(individual.missed.percent > 0.02)\nover.two.values <- individual.missed.percent[over.two]\nover.two.missing.SNPs <- rowSums(matrix.missed)[over.two]\nsubject_ID <- combined_data$IID[over.two]\n\nhigh.ind.missingness <- data.table(\n  ID = over.two,\n  SUBJECT_ID = subject_ID,\n  MISSINGNESS = over.two.values,\n  SNPs_MISSED = over.two.missing.SNPs\n)\n\n# table with high missingness individuals for PLINK Dropping\nfor_drop <- high.ind.missingness[, .(ID, SUBJECT_ID)]\nfwrite(for_drop, \"./helpers/A2CPS_Ind_Missingness_Drop.txt\", sep = \" \", col.names = FALSE)\n\n# spaghetti plots across chromosomes\nr <- range(dat)\npdf(\"./plots/missingness.samples.perchr.spaghetti.A2CPS.pdf\",width=9,height=7)\n  par(las=1)\n  tmp <- matrix(dat,ncol=22)\n  plot(c(1,22),r,type=\"n\",xlab=\"chromosome\",ylab=\"% missing\",xaxt=\"n\")\n  axis(1,1:22)\n  for(j in 1:nrow(tmp)) lines(1:22,tmp[j,],col=\"orange\")\ndev.off()\n\n# boxplot sample average\ntmp <- matrix(dat,ncol=22) #temp is a matrix with rows as participants and columns as chr## and cells as FMISS \nz.pm <- apply(tmp,1,mean) # z.pm is a vector with the mean values of FMISS for each participant ie. what is their average FMISS rate across participants\npdf(\"./plots/missingness.samples.averages.A2CPS.pdf\",width=9,height=6)\n  par(mfrow=c(1,2),las=1)\n  boxplot(z.pm)\n  boxplot(z.pm,log=\"y\")\ndev.off()\n\n# percentile missingness plot\nn <- length(z.pm)\npdf(\"./plots/missingness.samples.percentile.A2CPS.pdf\",width=8,height=7)\n  par(mfrow=c(1,1),las=1)\n  plot(c(0.9,1),c(0,0.4),type=\"n\",xlab=\"percentile missingness\",ylab=\"% missing\")\n  abline(h=seq(0,0.1,0.01),lty=\"dotted\",col=\"lightgrey\")\n  lines((1:n)/n,sort(z.pm),type=\"b\",cex=0.5,pch=20)\ndev.off()\n```\n</details>\n\n<details>\n<summary>Click to show Supplementary RScript #2: Heterozygosity and Relatedness Checks (het.genome.r)</summary>\n```r\nlibrary(data.table)\nlibrary(ggplot2)\n\nargs <- commandArgs(trailingOnly = TRUE)\nuser_wd <- args[1]\nsetwd(user_wd)\n\n# ---------- TESTING HETEROZYGOSITY ------------\na2cps.h <- fread(\"./qc_derivatives/7_Merged/RL1-5_Merged_Het.het\", stringsAsFactors = F)\ncolnames(a2cps.h) <- c(\"FID\",\"IID\",\"O_HOM\", \"E_HOM\", \"N_NM\",  \"F\")\na2cps.h[,'Het_Rate' := (N_NM - O_HOM)/N_NM]\na2cps.h[, 'Pop' := \"A2CPS\"]\n\ndat2 <- rbind(a2cps.h)\n\np.ht <- ggplot(data=dat2, aes(x=factor(Pop, levels = c(\"A2CPS\")), y=Het_Rate, group=Pop, color=Pop)) + geom_boxplot(outlier.colour = \"red\", show.legend = F) + scale_x_discrete(name = \"Populations\") + scale_y_continuous(name = \"Het Rate\", limits = c(0.0,0.32)) + ggtitle(\"Heterozygosity Rates\") + theme_bw() + theme(axis.text.x=element_text(size=16, color=\"black\",hjust=1), axis.text.y=element_text(size=16, color = \"black\"), axis.title.x = element_text(size=18, face = \"bold\"), axis.title.y = element_text(size=18, face = \"bold\"), panel.background=element_blank(), panel.grid.minor=element_blank(), panel.grid.major=element_blank(), plot.title = element_text(hjust = 0.5, size=20, face = \"bold\"))\nggsave(\"./plots/A2CPS_RL1-5_Het.png\", p.ht, width = 8, height = 6)\n\n# ---------- TESTING PARENTAL RELATEDNESS ------------\nphilippines <- fread(\"./qc_derivatives/7_Merged/RL1-5_Merged_IBD.genome\", stringsAsFactors = F)\nphilippines <- philippines[which(philippines$Z0 != 1)]\n\npng(\"./plots/A2CPS_RL1-5_Relatedness.png\", width=3000, height=2000, res=300)\n  par(pch=16)\n  with(philippines, plot(Z0, Z1, xlim=c(0,1), ylim=c(0,1), type=\"n\", main=\"A2CPS Z1 > 0 Relatedness\"))\n  with(subset(philippines, RT == \"UN\"), points(Z0, Z1, col=1, cex=0.4))\ndev.off()\n\nrelated <- philippines[which(philippines$Z0 < 0.5), ]\nfwrite(related, \"./helpers/A2CPS_RL1-5_related.csv\")\n```\n</details>\n\n<details>\n<summary>Click to show Supplementary RScript #3: Determining which Related Participants to Drop (missingness.related.comparison.r)</summary>\n```r\nlibrary(data.table)\n\nargs <- commandArgs(trailingOnly = TRUE)\nuser_wd <- args[1]\nsetwd(user_wd)\n\nmissingness.table <- fread(\"./helpers/A2CPS_RL1-5_Missingness.csv\")\nrelated <- fread(\"./helpers/A2CPS_RL1-5_related.csv\")\n\nrelated_IDs_row1 <- related$FID1\nrelated_IDs_row2 <- related$FID2\nrelated_missingness_row1 <- missingness.table[which(missingness.table$FAMID %in% related_IDs_row1), ]\nrelated_missingness_row2 <- missingness.table[which(missingness.table$FAMID %in% related_IDs_row2), ]\n\n# Reorder to match related_IDs_row1 and related_IDs_row2\ncomp1 <- related_missingness_row1[match(related_IDs_row1, related_missingness_row1$FAMID)]\ncomp2 <- related_missingness_row2[match(related_IDs_row2, related_missingness_row2$FAMID)]\ncomplist <- list()\n  \nfor (ind in seq_len(nrow(comp1))) {\n  related_pair <- c(comp1$FAMID[ind], comp2$FAMID[ind])\n  complist[[ind]] <- related_pair\n}\n\ndrop.list <- vector()\n\nfor (pair in complist) {\n  missingness.1 <- missingness.table$Missingness[pair[1]]\n  missingness.2 <- missingness.table$Missingness[pair[2]]\n  if (missingness.1 > missingness.2) {\n    drop.list <- c(drop.list, pair[1])\n  }\n  else {\n    drop.list <- c(drop.list, pair[2])\n  }\n}\n\nIID <- missingness.table[match(drop.list, missingness.table$FAMID), ]$ID\n\ndrop.table <- data.table(\n  FAMID <- drop.list,\n  IID <- IID\n)\n\n# Drop the higher-missingness related / duplicate individual\nfwrite(drop.table, sep = \" \", col.names =  F,\"./helpers/A2CPS_related_drop.txt\")\n```\n</details>\n\n<details>\n<summary>Click to show Supplementary RScript #4: Sex Typing Discrepancy Analysis and Handling of Discrepancies (sex.typing.r)</summary>\n```r\nlibrary(data.table)\nlibrary(ggplot2)\n\nargs <- commandArgs(trailingOnly = TRUE)\nuser_wd <- args[1]\nsetwd(user_wd)\n\nst_Info <- fread(\"qc_derivatives/sex_typing/sex_check.sexcheck\")\nst_Info_df <- as.data.frame(st_Info)\n\nok_df <- st_Info_df[st_Info_df$STATUS == \"OK\", ]\nproblem_df <- st_Info_df[st_Info_df$STATUS == \"PROBLEM\", ]\n\ninfo1_4 <- fread(\"./demographic_data/2025-01-13_UCSD_GV_Genotypes_Runlists_1-4_QC.csv\")[, c(\"subject_guid\",\"individual_file_tag\")]\ninfo5 <- fread(\"./demographic_data/2025-02-11_UCSD_GV_Genotypes_Runlist_5_QC.csv\")[, c(\"subject_guid\",\"individual_file_tag\")]\ninfo_all <- rbind(info1_4, info5)\n\nproblem_IIDs <- problem_df$IID ## The subject IDs of the problematic samples\ninfo_problem_IIDs <- info_all[which(info_all$individual_file_tag %in% problem_IIDs), ]\n  \nmerged_dt <- merge(\n  problem_df, \n  info_problem_IIDs, \n  by.x = \"IID\", \n  by.y = \"individual_file_tag\", \n  all.x = TRUE  \n)\nsetDT(merged_dt)\nmerged_dt[, subject_guid := toupper(as.character(subject_guid))]\n\nredcap <- fread(\"./demographic_data/REDCap/demographics-2025-01-10 (1).csv\")\nredcap.genident <- redcap$genident\nredcap.sex <- redcap$sex\n\nsetDT(redcap)\nmerged_dt <- redcap[, .(guid, genident)][merged_dt, on = .(guid = subject_guid)]\nmerged_dt <- redcap[, .(guid, sex)][merged_dt, on = .(guid = guid)]\n\nehr1 <- fread(\"./demographic_data/EHR/reformatted_ns_clinicals_and_case_characteristics.csv\")[, c(\"guid\", \"sex_ehr\")]\nehr2 <- fread(\"./demographic_data/EHR/reformatted_ru_clinicals_and_case_characteristics.csv\")[, c(\"guid\", \"sex_ehr\")]\nehr3 <- fread(\"./demographic_data/EHR/reformatted_um_clinicals_and_case_characteristics.csv\")[, c(\"guid\", \"sex_ehr\")]\nehr <- rbind(ehr1, ehr2, ehr3)\nmerged_dt <- ehr[, .(guid, sex_ehr)][merged_dt, on = .(guid = guid)]\nsetnames(merged_dt,\n         old = c(\"sex\", \"genident\", \"sex_ehr\"),\n         new = c(\"REDCap: sex\", \"REDCap: genident\", \"EHR: sex_ehr\"))\nmerged_dt[, rescue := ifelse(\n  (SNPSEX != `REDCap: genident` & !is.na(`REDCap: genident`) & is.na(`REDCap: sex`)) |\n    (SNPSEX != `REDCap: sex` & !is.na(`REDCap: sex`) & is.na(`REDCap: genident`)) |\n    (SNPSEX != `REDCap: genident` & SNPSEX != `REDCap: sex` & !is.na(`REDCap: genident`) & !is.na(`REDCap: sex`)),\n  \"NO\",\n  \"YES\"\n)]\n\nmerged_dt_no <- merged_dt[which(merged_dt$rescue == \"NO\"), ]\nmerged_dt_yes <- merged_dt[which(merged_dt$rescue == \"YES\"), ]\n\ndrop_sex_discrepancy <- data.table(\n  ID = merged_dt_no$FID,\n  IID = merged_dt_no$IID\n)\n\nrelated_drop <- fread(\"./helpers/A2CPS_related_drop.txt\")\nsetnames(related_drop, c(\"ID\", \"IID\"))\ndrop_sex_discrepancy_and_related <- rbind(drop_sex_discrepancy, related_drop)\n\nfwrite(drop_sex_discrepancy_and_related, col.names = F, sep = \" \", \"helpers/A2CPS_related_and_sex_discrepancy_drop.txt\")\nupdate_sex <- data.table(\n  ID = merged_dt_yes$FID,\n  IID = merged_dt_yes$IID,\n  Sex = merged_dt_yes$SNPSEX\n)\nfwrite(update_sex, col.names = F, sep = \" \", \"./helpers/A2CPS_update_sex.txt\")\n\n## Graphing\nok_df$LegendStatus <- \"OK\"\nproblem_df$LegendStatus <- \"PROBLEM\"\ncombined_df <- rbind(ok_df, problem_df)\npng(\"./plots/A2CPS_RL1-5_Sex_Typing.png\", width = 3000, height = 2000, res = 300)\n  p <- ggplot() +\n    geom_point(data = ok_df, aes(x = F, y = 0, color = factor(PEDSEX), shape = \"OK\", size = \"OK\", alpha = \"OK\"),\n               position = position_jitter(width = 0, height = 0.1)) +\n    geom_point(data = problem_df, aes(x = F, y = 0, color = factor(PEDSEX), shape = \"PROBLEM\", size = \"PROBLEM\", alpha = \"PROBLEM\"),\n               position = position_jitter(width = 0, height = 0.1)) +\n    scale_color_manual(values = c(\"0\" = \"black\", \"1\" = \"blue\", \"2\" = \"magenta\")) +\n    scale_shape_manual(name = \"Status\", values = c(\"OK\" = 1, \"PROBLEM\" = 19)) +\n    scale_size_manual(name = \"Status\", values = c(\"OK\" = 1, \"PROBLEM\" = 3)) +\n    scale_alpha_manual(name = \"Status\", values = c(\"OK\" = 0.4, \"PROBLEM\" = 0.9)) +\n    labs(title = \"A2CPS Sex Discrepancies\",\n         x = \"F Statistic\",\n         y = \"\",\n         color = \"PEDSEX\") +\n    theme_minimal() +\n    theme(legend.position = \"top\",\n          axis.ticks.y = element_blank(),\n          axis.text.y = element_blank())\n  print(p)\ndev.off()\n```\n</details>\n\n<details>\n<summary>Click to show Supplementary RScript #5: Subsetting just Freeze 2 Participants (Freeze2.R)</summary>\n```r\nlibrary(data.table)\n\nargs <- commandArgs(trailingOnly = TRUE)\nuser_wd <- args[1]\nsetwd(user_wd)\nsetwd(\"./A2CPS_RL1-5_QCed/\")\n\ncurrent_biospecimen_id <- sub(\"_.*\", \"\", fread(\"A2CPS_RL1-5_QCed.fam\")$V2)\nfreeze2 <- fread(\"freeze2_ids_ucsd_gv.csv\")$biospecimen_id\n\ndrop_not_in_freeze2_list <- current_biospecimen_id[which(current_biospecimen_id %notin% freeze2)]\n\nfam.file <- fread(\"A2CPS_RL1-5_QCed.fam\")\n\nfam.file[, prefix := sub(\"_.*\", \"\", V2)]\n\nmatched_rows <- fam.file[prefix %in% drop_not_in_freeze2_list, .(V1, V2)]\n\nfwrite(matched_rows, col.names = F, sep = \" \", \"notFreeze2.txt\")\n\nprevious_drops <- fread(\"/Users/sethberke/a2cps.gv.qc.auto/A2CPS_RL1-5_Preparation_Files/A2CPS_RL1-5_Final_Sample_Drop_List.txt\")\n\ntotal_drops <- rbind(matched_rows, previous_drops)\n\nfwrite(total_drops, col.names = F, sep = \" \", \"/Users/sethberke/a2cps.gv.qc.auto/A2CPS_RL1-5_Preparation_Files/A2CPS_RL1-5_Final_Sample_Drop_List_Only_Freeze_2.txt\")\n```\n</details>\n\n---\n\n### Principal Component Analysis\n\nSystematic differences in ancestry between groups – population stratification – can lead to spurious associations with allele frequencies, and so multiethnic analyses often include genetic principal components to account for the variation imposed by population structure. Here we plotted the PCA values across two axes, and can see distinct populations, which must be accounted for in many study designs, such as polygenic risk score (PRS) calculations.\n\n<details>\n<summary>Click to show Principal Components Bash Script, which utilizes Plink 1.9</summary>\n\n```bash\n### Principal Components Analysis ###\n    mkdir principle_components_analysis\n\n    # Step a: LD Pruning window of 50kb, step size 10bp, and r^w threshold of 0.1\n    mkdir principle_components_analysis/LD_Pruning\n    ./plink --bfile ./A2CPS_Freeze_2 --double-id --allow-extra-chr --indep-pairwise 50 10 0.1 --out ./principle_components_analysis/LD_Pruning/a2cps_rl12345_LDPruned\n\n    # Step b: Extract SNPs in equilibrium\n    mkdir principle_components_analysis/LD_Pruned\n    ./plink --bfile ./A2CPS_Freeze_2 --double-id --allow-extra-chr --extract ./principle_components_analysis/LD_Pruning/a2cps_rl12345_LDPruned.prune.in --make-bed --out ./principle_components_analysis/LD_Pruned/a2cps_rl12345_LDPrunedFinal\n\n    # Step c: Derive PCA Eigenvalues and Eigenvectors\n    mkdir principle_components_analysis/PCA\n    ./plink --bfile principle_components_analysis/LD_Pruned/a2cps_rl12345_LDPrunedFinal --double-id --allow-extra-chr  --pca --out principle_components_analysis/PCA/pca_info\n\n    # Step d: Graph Scree and PCA Plots\n    Rscript ./scripts/pca.r \"$USER_WD\"\n```\n</details>\n\n\n<details>\n<summary>Click to show Supplementary RScript #6: Principal Components Analysis (pca.r)</summary>\n\n```r\n## load required packages\nlibrary(tidyverse)\nlibrary(httr)\nlibrary(writexl)\nlibrary(data.table)\n\nargs <- commandArgs(trailingOnly = TRUE)\nuser_wd <- args[1]\nsetwd(user_wd)\n\nbase_url=\"https://vbr-api.a2cps.cloud\"\nusername <- VBR_Username\npassword <- VBR_Password\nresp = POST(paste(base_url, \"/auth/token\", sep=\"\"), body = list(username=username, password=password), encode = \"form\")\naccess_token = content(resp, as=\"parsed\")$access_token\nresp = GET(paste(base_url, \"/biospecimens/private?offset=0&limit=0\", sep=\"\"), add_headers(authorization=paste(\"Bearer\", access_token)))\nbio <- jsonlite::fromJSON(content(resp, as = \"text\"))\nbioDF <- as.data.table(bio)\nfam <- read.table(\"./Freeze_2/A2CPS_Freeze_2.fam\", header = FALSE)\nbioID_PLINK <- sub(\"_.*\", \"\", fam$V2)\nbioDF_Mapping_Plink <- bioDF[which(bioDF$biospecimen_id %in% bioID_PLINK), ]\n\n# BioID and Race\nbioDF_Mapping_Cols <- bioDF_Mapping_Plink[, c(\"biospecimen_id\",\"race\")]\nfam <- read.table(\"./Freeze_2/A2CPS_Freeze_2.fam\", header = FALSE)\nfam$V2 <- sub(\"_.*\", \"\", fam$V2)\ncolnames(fam) <- c(\"Famid\", \"biospecimen_id\", \"Fatid\", \"Motid\", \"Gender\", \"Phenotype\")\nfam_with_race <- merge(fam, bioDF_Mapping_Cols, by = \"biospecimen_id\", all.x = TRUE)\n\n# PCA\nlibrary(tidyverse)\nsetwd(\"./Freeze_2/principle_components_analysis/PCA\")\npca <- read_table2(\"./pca_info.eigenvec\", col_names = FALSE)\neigenval <- scan(\"./pca_info.eigenval\")\npca$X2 <- sub(\"_.*\", \"\", pca$X2)\npca <- pca[,-1]\nnames(pca)[1] <- \"biospecimen_id\"\nnames(pca)[2:ncol(pca)] <- paste0(\"PC\",1:(ncol(pca)-1))\npca <- merge(pca, bioDF_Mapping_Cols, by = \"biospecimen_id\", all.x = TRUE)\npca <- pca[!duplicated(pca$biospecimen_id), ]\n\n# Subsetting for Graph\nrace <- rep(NA, length(pca$biospecimen_id))\nrace[grep(\"White\", pca$race)] <- \"White\"\nrace[grep(\"African-American\", pca$race)] <- \"Black or African-American\"\nrace[grep(\"Asian\", pca$race)] <- \"Asian\"\nrace[grep(\"American Indian or Alaska Native\", pca$race)] <- \"American Indian or Alaska Native\"\nrace[grep(\"Unknown\", pca$race)] <- \"Unknown\"\nrace[grep(\"Not Reported\", pca$race)] <- \"Not Reported\"\n\npca <- as.tibble(data.frame(pca, race))\npve <- data.frame(PC = 1:20, pve = eigenval/sum(eigenval)*100)\npercent_variance_explained <- pve$pve\n\nsetwd(user_wd)\n\n# Graphing\npng(\"./Freeze_2/principle_components_analysis/PCA/A2CPS_RL1-5_PCA_Scree_Plot.png\", width = 3000, height = 2000, res = 300)\n  a <- ggplot(pve, aes(PC, pve)) + geom_bar(stat = \"identity\")\n  a + ylab(\"Percentage Variance Explained\") + theme_light()\n  print(a)\ndev.off()\n\npng(\"./Freeze_2/principle_components_analysis/PCA/A2CPS_RL1-5_PCA_Plot.png\", width = 3000, height = 2000, res = 300)\nb <- ggplot(pca, aes(PC1, PC2, col = race)) +\n  geom_point(size = 0.075) +\n  coord_fixed() +\n  theme_light() +\n  ggtitle(\"PCA Genetic Ancestry\") +\n  xlab(paste0(\"PC1 (\", signif(pve$pve[1], 3), \"%)\")) + \n  ylab(paste0(\"PC2 (\", signif(pve$pve[2], 3), \"%)\")) +\n  theme(\n    aspect.ratio = 1,\n    plot.margin = margin(0, 0, 0, 0, \"cm\"),\n    axis.title.x = element_text(size = 6, family = \"Arial\"),\n    axis.title.y = element_text(size = 6, family = \"Arial\"),\n    axis.text.x = element_text(size = 4, family = \"Arial\"),\n    axis.text.y = element_text(size = 6, family = \"Arial\"),\n    plot.title = element_text(size = 10, face = \"bold\", hjust = 0.5),\n    legend.text = element_text(size = 6),\n    legend.key.size = unit(0.5, \"cm\")\n  ) +\n  scale_colour_manual(name = \"Ancestry Group\", values = c(\"red\", \"orange\", \"yellow\", \"black\", \"black\", \"purple\"))\nprint(b)\ndev.off()\n\n# PC Values for each participant\npca <- pca[, c(1,2,3,22)]\nfwrite(pca, \"./Freeze_2/principle_components_analysis/PCA/A2CPS_RL1-5_PCA_Ind_Info.csv\")\n```\n</details>\n\n\n![A2CPS PCA Scree Plot](images/A2CPS_Freeze2_PCA_Scree_Plot.png){fig-alt=\"A2CPS PCA Scree Plot\" width=500px #fig-pcascree}\n\n![A2CPS PCA Plot](images/A2CPS_Freeze2_PCA_Plot.png){fig-alt=\"A2CPS PCA Plot\" width=750px #fig-pcaplot}\n\n---\n\n### Sex Typing\n\nThis procedure confirms the gender of each participant as documented in the study by testing X Chromosome homozygosity levels. Male participants are haploid for the X chromosome whereas females are diploid, thus we expect a high deviation from the genotypes predicted by Hardy-Weinberg equilibrium (HWE) (0/0, 0/1, 1/1) with male participants, as their alleles should exclusively be either 0 or 1 (hemizygous). This deviation is captured by the F Statistic. As a general rule, an F Stat of 0.3 is the maximum seen for females and 0.75 is the minimum for males (as reflected by the chart below). This chart demonstrates the deviation from HWE as we expect ≈ 1 almost always for males, who will consistently deviate from HWE due to X chromosome hemizygosity, and we expect females to have a normal distribution close to around 0 (as they are heterozygous for the x chromosome). We used this chart to visualize sex discrepancies, and checked these against REDCap and EHR data to settle and recover as many sex discrepancies as possible. Refer to supplementary RScript \"sex.typing.r\" for the code used to generate this graph. In the graph, the blue dots are males, pink are females, and black are cases where sex was undefined in the .fam file.\n\n![A2CPS Sex Typing Plot](images/A2CPS_QC_Sex_Typing.png){fig-alt=\"A2CPS Sex Typing\" width=500px #fig-sextyping}\n\n---\n\n### Relatedness\n\nAllele-sharing percentages, determined during identity-by descent analyses, can reveal relatedness between participants, including the presence of duplicate samples. For example, full siblings are expected to share approximately 50% of their SNPs at a single allele (represented by the Z1 value: e.g., both individuals having \"A\" in genotypes AA and AB) and about 25% of their SNPs at both alleles (Z2 value: e.g., both having AA at a locus). In contrast, duplicate samples should share nearly 100% of their alleles, resulting in a Z2 value close to 1. To avoid bias in genome-wide association studies due to overrepresentation of related or duplicate individuals, we removed one individual from each identified pair, prioritizing the retention of the sample with higher genotype call quality. In the relatedness plot, sibling pairs appear around Z1 ≈ 0.5, while duplicates cluster in the bottom-left corner (Z0 ≈ 0, Z1 ≈ 0, Z2 ≈ 1). See the supplementary R script het.genome.r for the code used to generate this plot.\n\n\n![A2CPS Relatedness Plot](images/A2CPS_QC_Relatedness.png){fig-alt=\"A2CPS Relatedness\" width=500px #fig-relatedness}\n\n---\n\n### Imputation\n\nImputation is the process of statistically inferring whole genome sequences from SNP Array data using haplotype reference panels. For our imputation we used the TOPMed Imputation Server that implements the TOPMed R3 reference panel. View @sec-genomics for imputation details.\n\n### Citations\n\nIn publications or presentations including data from A2CPS, please include the following statement as attribution:\n\n> Data were provided [in part] by the A2CPS Consortium funded by the National Institutes of Health (NIH) Common Fund, which is managed by the Office of the Director (OD)/ Office of Strategic Coordination (OSC). Consortium components and their associated funding sources include Clinical Coordinating Center (U24NS112873), Data Integration and Resource Center (U54DA049110), Omics Data Generation Centers (U54DA049116, U54DA049115, U54DA049113), Multi-site Clinical Center 1 (MCC1) (UM1NS112874), and Multi-site Clinical Center 2 (MCC2) (UM1NS118922).\n\n::: {.callout-note}\nThe following published papers should be cited when referring to A2CPS Protocol and Biomarkers: @sluka_predicting_2023 @berardi_multi_2022\n:::\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}